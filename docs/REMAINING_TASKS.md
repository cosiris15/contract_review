# 剩余工作清单

**当前进度：71% (12/17 任务完成)**

---

## 🔴 必需任务

### Task 17：部署准备（30分钟）

**检查清单**：
- [ ] 确认Render环境变量（DEEPSEEK_API_KEY, GEMINI_API_KEY等）
- [ ] 触发Render重新部署（拉取最新代码commit 18d1438）
- [ ] 确认前端API地址配置正确
- [ ] 验证数据库迁移已执行（document_changes表存在）

**参考文档**：`docs/DEPLOYMENT_CHECKLIST.md`

---

### Task 15：SSE事件推送测试（30分钟，部署后）

**测试步骤**：
1. 创建测试任务（小文档<50段落）
2. 进入交互式审阅
3. 输入："请修改第1段，把'甲方'改成'我方'"
4. 验证：
   - [ ] 浏览器Console显示 `Tool called: modify_paragraph`
   - [ ] ElMessage显示 "AI已执行操作"
   - [ ] Supabase document_changes表有新记录

---

### Task 16：端到端集成测试（1小时，部署后）

**测试场景**：
1. **基础工具调用**
   - [ ] modify_paragraph（修改段落）
   - [ ] batch_replace_text（批量替换）
   - [ ] insert_clause（插入条款）

2. **变更管理API**
   - [ ] GET /api/tasks/{id}/changes（查询变更）
   - [ ] POST .../changes/{id}/apply（应用变更）
   - [ ] POST .../changes/{id}/revert（回滚变更）

3. **边界情况**
   - [ ] AI使用无效paragraph_id（应被拦截）
   - [ ] 并发修改同一段落

---

## 🟢 可选任务（UI增强）

### Task 12：DiffView.vue增强（2-3小时）
**优先级：低**
**建议**：等核心功能测试通过后再实施

功能：
- Git风格的diff显示（original vs draft）
- 高亮新增/删除/修改的行
- "应用"/"撤销"按钮

需要：`npm install diff`

---

### Task 13：DocumentViewer.vue段落高亮（1-2小时）
**优先级：低**
**建议**：等核心功能测试通过后再实施

功能：
- 高亮显示被AI修改的段落
- 段落级别的变更标记
- 点击查看变更历史

---

## 📋 执行顺序建议

### 阶段1：立即执行（部署前）
1. **部署准备** (Task 17)
   - 检查环境变量
   - 触发Render部署
   - 等待部署完成（3-5分钟）

### 阶段2：部署后测试（当天）
2. **SSE事件测试** (Task 15)
   - 快速验证工具调用是否工作

3. **端到端测试** (Task 16)
   - 全面测试各种场景
   - 记录问题和优化建议

### 阶段3：可选优化（视情况而定）
4. **UI增强** (Task 12-13)
   - 仅在核心功能稳定后考虑
   - 可分期实施

---

## 🎯 最小可用版本（MVP）

完成 Task 15-16 后，即可视为MVP完成，具备以下能力：

✅ **核心功能**：
- AI能理解用户意图并调用工具修改文档
- 所有修改记录到数据库，支持版本控制
- 前端可接收SSE事件并显示工具调用状态
- 支持查询、应用、回滚变更

✅ **质量保证**：
- 防AI幻觉机制（文档结构注入Prompt）
- 错误处理和用户提示
- 完整的SSE协议支持

---

## 📊 工作量预估

| 任务 | 预计时间 | 优先级 | 状态 |
|------|---------|--------|------|
| Task 17: 部署准备 | 30分钟 | 🔴 必需 | 待执行 |
| Task 15: SSE测试 | 30分钟 | 🔴 必需 | 待执行 |
| Task 16: 端到端测试 | 1小时 | 🔴 必需 | 待执行 |
| Task 12: DiffView | 2-3小时 | 🟢 可选 | 待定 |
| Task 13: DocumentViewer | 1-2小时 | 🟢 可选 | 待定 |

**MVP总时长**：约2小时（不含UI增强）

---

## 🚨 风险提示

1. **SSE在Nginx后可能需要配置**
   - 如果测试发现SSE事件不推送
   - 需要设置 `X-Accel-Buffering: no`

2. **首次部署可能需要调试**
   - 环境变量配置错误
   - 数据库连接问题
   - 建议预留调试时间

3. **AI工具调用成功率**
   - 取决于Prompt质量和AI模型表现
   - 可能需要微调Prompt或文档结构格式

---

## 📞 需要帮助？

如果测试遇到问题，请提供：
1. 浏览器Console完整错误信息
2. 后端日志（Render Logs）
3. 具体的测试步骤和预期vs实际结果

我可以帮助诊断和修复问题。

---

**下一步行动**：
1. 阅读 `docs/DEPLOYMENT_CHECKLIST.md`
2. 执行部署
3. 进行测试
4. 反馈测试结果
