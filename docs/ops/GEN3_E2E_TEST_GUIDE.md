# Gen3 手把手测试指引（E2E）

## 0. 测试前准备
1. 配置环境变量
- `backend/.env` 中填入有效 `DEEPSEEK_API_KEY`。

2. 启动服务
- 启动后端与前端服务（按项目现有方式）。

3. 准备测试文档
- `primary`：建议使用真实合同 `DOCX`（导出红线要求 primary 为 docx）。
- 可选 `reference`：参考材料（DOCX/PDF/TXT）。
- 可选 `criteria`：审核标准 `xlsx`。

---

## 1. 初始化任务（验证领域审阅入口）
1. 进入 Gen3 页面。
2. 配置：
- 领域：`fidic`
- 我方身份：如“承包商”
- 语言：中文/英文
3. 点击 `初始化审阅`。

预期结果：
- 生成任务 ID。
- 进入上传阶段。

---

## 2. 上传文档（验证多角色输入）
1. 上传 `primary`（必传）。
2. 可选上传：`reference`、`criteria`。

预期结果：
- 上传成功提示。
- 文档列表显示角色与文件名。
- 主文档上传后可进入“开始审阅”。

---

## 3. 启动审阅（验证自动分析与 SSE 进度）
1. 点击 `开始审阅`。

预期结果：
- 状态进入 reviewing。
- 出现处理进度（转圈 + 进度文案 + 当前条款 ID）。

---

## 4. 审批建议（覆盖 DiffCard 主流能力）
当出现待审批 diff：

1. 内联高亮
- 默认 unified 视图可见新增/删除高亮。

2. 分栏查看
- 切换 split 视图查看原文与建议文本。

3. 编辑建议
- 在建议文本 textarea 修改内容。
- 出现“已修改”标识。

4. 查看上下文
- 点击“查看上下文”加载条款全文。
- 原始片段高亮定位。

5. 审批动作
- `批准`：应携带用户编辑后的建议文本。
- `拒绝`：建议进入拒绝记录。

预期结果：
- diff 从 pending 移出。
- 列表按条款分组更新。
- 决策历史可回看。

---

## 5. 恢复流程（验证审批闭环）
1. 待审批项清空后，点击 `继续审阅`。

预期结果：
- 若存在未决策 diff：提示 400 warning（不能继续）。
- 若全部已决策：成功恢复，进入下一轮分析。

---

## 6. 完成与导出（验证可交付产物）
1. 审阅结束后进入 complete。
2. 点击导出红线。

预期结果：
- 可下载 `redline_*.docx`。
- 已批准修改被写入文档；若批准前编辑过建议文本，应体现编辑后的内容。

注意：
- primary 不是 `.docx` 时，导出会失败（当前设计行为）。

---

## 7. 一次性覆盖主流能力的最短演示路径
1. 初始化 `fidic` 任务。
2. 上传 `primary.docx`。
3. （可选）上传 `criteria.xlsx`。
4. 开始审阅。
5. 第一批 diff：看高亮、切分栏、编辑一条、看上下文、批准一条、拒绝一条。
6. 点击继续审阅。
7. 下一批可用“全部批准”。
8. 完成后导出 DOCX 红线。

