import{_ as mt,a4 as ft,u as vt,r as V,q as L,o as _t,x as N,a5 as $,at as gt,a6 as ee,y as yt,K as bt,c as k,a as d,e as s,f as l,N as _e,O as Ie,b as x,h as ht,w as a,g as u,k as kt,t as o,E as xt,d as S,R as wt,au as Et,ah as Tt,ai as Rt,ag as Ct,aq as Vt,ad as Dt,L as Mt,an as Ut,a3 as At,a9 as Lt,J as St,ar as It,av as Pt,aw as Ht,al as Nt,am as zt,ax as Ot,ay as Bt,P as $t,az as jt,F as Ft,M as qt,aA as Jt,aB as Wt,G as Gt,H as Kt}from"./index-LNbvnzbl.js";/* empty css                 *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                *//* empty css                  *//* empty css               *//* empty css                   *//* empty css                  *//* empty css                         *//* empty css                 */import{u as Zt}from"./index-Uf0I8LME.js";const Qt={class:"result-view"},Xt={class:"result-header"},Yt={class:"header-info"},el={class:"header-meta"},tl={class:"header-actions"},ll={key:0,class:"redline-dialog-content"},al={class:"persisted-info"},ol={key:0},sl={key:1,class:"redline-dialog-content"},nl={class:"export-option"},il={class:"option-header"},ul={class:"option-count"},rl={class:"export-option"},dl={class:"option-header"},cl={key:0,class:"option-count"},pl={key:2,class:"export-progress"},ml={class:"progress-header"},fl={key:0,class:"export-result"},vl={key:0},_l={key:1,class:"export-error"},gl={class:"stat-value"},yl={class:"stat-label"},bl={class:"stat-detail"},hl={class:"stat-value"},kl={class:"stat-label"},xl={class:"stat-detail"},wl={class:"stat-value"},El={class:"stat-label"},Tl={class:"stat-detail"},Rl={class:"stat-value"},Cl={class:"stat-label"},Vl={class:"stat-detail"},Dl={class:"text-ellipsis"},Ml={key:1},Ul={class:"modification-list"},Al={class:"mod-header"},Ll={class:"mod-reason"},Sl={class:"mod-actions"},Il={class:"text-label"},Pl=["innerHTML"],Hl={key:1,class:"text-box original"},Nl={class:"text-label"},zl=["innerHTML"],Ol={key:1,class:"text-box suggested"},Bl={__name:"ResultView",setup($l){const Pe=ft(),He=vt(),Z=Zt(),ge=V(!1),ke=V("risks"),T=L(()=>Pe.params.taskId),te=V(!1),w=V(null),re=V(!1),le=V(!1),b=V(null),Q=V(!1);let U=null;const z=V(null),ae=V({}),oe=V(!1),ye=V(!1),be=V(null),C=V({description:"",action_type:"",urgency:"normal",responsible_party:"",deadline_suggestion:""}),y=L(()=>Z.reviewResult),O=L(()=>{var t;return((t=y.value)==null?void 0:t.summary)||{total_risks:0,high_risks:0,medium_risks:0,low_risks:0,total_modifications:0,must_modify:0,should_modify:0,total_actions:0,immediate_actions:0}}),Ne=L(()=>{var t;return((t=y.value)==null?void 0:t.language)||"zh-CN"}),K=L(()=>Ne.value==="en"),n=L(()=>K.value?{materialType:{contract:"Contract",marketing:"Marketing Material"},riskLevel:{high:"High",medium:"Medium",low:"Low"},priority:{must:"Must",should:"Should",may:"May"},urgency:{immediate:"Immediate",soon:"Soon",normal:"Normal"},labels:{back:"Back",reviewResult:"Review Result",ourParty:"Our Party:",reviewTime:"Review Time:",exportRedline:"Export Redline Word",export:"Export",totalRisks:"Total Risks",highRisks:"High Risks",priorityNeeded:"Priority needed",modifications:"Modifications",actions:"Actions",risks:"Risks",highDetail:"H",mediumDetail:"M",lowDetail:"L",mustModify:"must",shouldModify:"should",immediateActions:"immediate",riskLevelCol:"Risk Level",riskType:"Risk Type",riskDescription:"Description",reason:"Reason",originalText:"Original Text",urgencyCol:"Urgency",actionType:"Action Type",specificAction:"Specific Action",responsibleParty:"Responsible Party",deadline:"Deadline",operation:"Operation",confirm:"Confirm",edit:"Edit",currentText:"Current Text",suggestedText:"Suggested Modification",save:"Save",confirmAdopt:"Confirm",diff:"Diff",fullText:"Full",noModifications:"No modification suggestions",noActions:"No action recommendations"}}:{materialType:{contract:"合同",marketing:"营销材料"},riskLevel:{high:"高",medium:"中",low:"低"},priority:{must:"必须",should:"应该",may:"可以"},urgency:{immediate:"立即",soon:"尽快",normal:"一般"},labels:{back:"返回",reviewResult:"审阅结果",ourParty:"我方:",reviewTime:"审阅时间:",exportRedline:"导出修订版 Word",export:"导出",totalRisks:"风险总数",highRisks:"高风险",priorityNeeded:"需优先处理",modifications:"修改建议",actions:"行动建议",risks:"风险点",highDetail:"高",mediumDetail:"中",lowDetail:"低",mustModify:"必须",shouldModify:"应该",immediateActions:"立即处理",riskLevelCol:"风险等级",riskType:"风险类型",riskDescription:"风险描述",reason:"判定理由",originalText:"原文摘录",urgencyCol:"紧急程度",actionType:"行动类型",specificAction:"具体行动",responsibleParty:"负责方",deadline:"建议时限",operation:"操作",confirm:"确认",edit:"编辑",currentText:"当前文本",suggestedText:"建议修改为",save:"保存",confirmAdopt:"确认采纳",diff:"差异",fullText:"全文",noModifications:"无修改建议",noActions:"无行动建议"}}),ze=L(()=>{var e;const t=(e=y.value)==null?void 0:e.material_type;return n.value.materialType[t]||t}),de=L(()=>{var t;return(t=y.value)!=null&&t.modifications?y.value.modifications.filter(e=>e.user_confirmed).length:0}),Oe=L(()=>{var t;return(t=y.value)!=null&&t.actions?y.value.actions.filter(e=>e.user_confirmed).length:0}),ce=L(()=>{var t;return((t=w.value)==null?void 0:t.commentable_actions)>0}),xe=L(()=>!(w.value&&!w.value.can_export||de.value===0&&!ce.value)),Be=L(()=>{var t;return(t=w.value)!=null&&t.reason?w.value.reason:de.value===0&&!ce.value?"请先确认至少一条修改建议或行动建议":""});function D(t){var e,p;if(!ae.value[t]){const f=(p=(e=y.value)==null?void 0:e.modifications)==null?void 0:p.find(c=>c.id===t);ae.value[t]={showDiff:!0,isEditing:!1,editText:(f==null?void 0:f.user_modified_text)||(f==null?void 0:f.suggested_text)||""}}return ae.value[t]}function $e(){var t;(t=y.value)!=null&&t.modifications&&y.value.modifications.forEach(e=>{ae.value[e.id]||(ae.value[e.id]={showDiff:!0,isEditing:!1,editText:e.user_modified_text||e.suggested_text||""})})}_t(async()=>{if(T.value){ge.value=!0;try{await Z.loadResult(T.value),$e(),await Promise.all([pe(),we()])}catch{N.error("加载结果失败")}finally{ge.value=!1}}});async function pe(){try{const t=await $.getRedlinePreview(T.value);w.value=t.data}catch(t){console.error("获取 Redline 预览失败:",t)}}async function we(){try{const t=await $.getRedlineInfo(T.value);t.data.exists?z.value=t.data:z.value=null}catch(t){console.error("获取 Redline 信息失败:",t),z.value=null}}async function je(){var t;Q.value=!0;try{const e=await $.downloadPersistedRedline(T.value),p=e.headers["content-disposition"];let f=((t=z.value)==null?void 0:t.filename)||"document_redline.docx";if(p){const R=p.match(/filename\*=UTF-8''([^;\s]+)/);if(R)f=decodeURIComponent(R[1]);else{const q=p.match(/filename="?([^"]+)"?/);q&&(f=q[1])}}const c=new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),v=window.URL.createObjectURL(c),h=document.createElement("a");h.href=v,h.download=f,document.body.appendChild(h),h.click(),document.body.removeChild(h),window.URL.revokeObjectURL(v),N.success("文件下载成功"),me()}catch(e){console.error("下载失败:",e),N.error(e.message||"下载失败，请重试")}finally{Q.value=!1}}function Fe(){He.push("/")}function Ee(t){if(!t)return"-";const e=new Date(t),p=K.value?"en-US":"zh-CN";return e.toLocaleString(p)}function qe(t){return{high:"danger",medium:"warning",low:"info"}[t]||"info"}function Je(t){return n.value.riskLevel[t]||t}function We(t){return{must:"danger",should:"warning",may:"info"}[t]||"info"}function Ge(t){return n.value.priority[t]||t}function Ke(t){return{immediate:"danger",soon:"warning",normal:"info"}[t]||"info"}function Ze(t){return n.value.urgency[t]||t}function Qe(t,e){if(!t||!e)return{originalHtml:t||"",modifiedHtml:e||""};if(t===e)return{originalHtml:t,modifiedHtml:e};const p=m=>{const g=[];let M="",ie=null;for(const F of m){const J=/[\u4e00-\u9fa5]/.test(F),W=/[a-zA-Z0-9]/.test(F),fe=/\s/.test(F);let A;J?A="cn":W?A="en":fe?A="space":A="punct",A==="cn"?(M&&g.push(M),g.push(F),M="",ie=null):A===ie&&A==="en"?M+=F:(M&&g.push(M),M=F,ie=A)}return M&&g.push(M),g},f=p(t),c=p(e),v=f.length,h=c.length,R=Array(v+1).fill(null).map(()=>Array(h+1).fill(0));for(let m=1;m<=v;m++)for(let g=1;g<=h;g++)f[m-1]===c[g-1]?R[m][g]=R[m-1][g-1]+1:R[m][g]=Math.max(R[m-1][g],R[m][g-1]);const q=[];let B=v,j=h;for(;B>0&&j>0;)f[B-1]===c[j-1]?(q.unshift({origIdx:B-1,modIdx:j-1,token:f[B-1]}),B--,j--):R[B-1][j]>R[B][j-1]?B--:j--;const I=m=>m.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");let X="",se=-1;for(const m of q){for(let g=se+1;g<m.origIdx;g++)X+=`<del class="diff-del">${I(f[g])}</del>`;X+=I(m.token),se=m.origIdx}for(let m=se+1;m<v;m++)X+=`<del class="diff-del">${I(f[m])}</del>`;let Y="",ne=-1;for(const m of q){for(let g=ne+1;g<m.modIdx;g++)Y+=`<ins class="diff-ins">${I(c[g])}</ins>`;Y+=I(m.token),ne=m.modIdx}for(let m=ne+1;m<h;m++)Y+=`<ins class="diff-ins">${I(c[m])}</ins>`;return{originalHtml:X,modifiedHtml:Y}}function Te(t){const e=t.original_text||"",f=D(t.id).editText||t.user_modified_text||t.suggested_text||"";return Qe(e,f)}async function Xe(t){var p,f;const e=D(t.id);try{await Z.updateModification(T.value,t.id,{user_modified_text:e.editText,user_confirmed:!0}),e.isEditing=!1,t.user_confirmed=!0,t.user_modified_text=e.editText,N.success("保存成功"),pe()}catch(c){console.error("保存失败详情:",c),N.error("保存失败: "+(((f=(p=c==null?void 0:c.response)==null?void 0:p.data)==null?void 0:f.detail)||c.message||"请检查网络连接"))}}async function Ye(t,e){try{await Z.updateModification(T.value,t.id,e)}catch{N.error("更新失败")}}async function et(t,e){t.user_confirmed=e;try{await Z.updateAction(T.value,t.id,e),pe()}catch{t.user_confirmed=!e,N.error("更新失败")}}function tt(t){be.value=t.id,C.value={description:t.description||"",action_type:t.action_type||"",urgency:t.urgency||"normal",responsible_party:t.responsible_party||"",deadline_suggestion:t.deadline_suggestion||""},oe.value=!0}async function lt(){var t,e,p,f;ye.value=!0;try{await Z.updateAction(T.value,be.value,{...C.value,user_confirmed:!0});const c=(e=(t=y.value)==null?void 0:t.actions)==null?void 0:e.find(v=>v.id===be.value);c&&(Object.assign(c,C.value),c.user_confirmed=!0),oe.value=!1,N.success("保存成功"),pe()}catch(c){console.error("保存失败详情:",c),N.error("保存失败: "+(((f=(p=c==null?void 0:c.response)==null?void 0:p.data)==null?void 0:f.detail)||c.message||"请检查网络连接"))}finally{ye.value=!1}}function at(t){const p={excel:$.exportExcel(T.value),csv:$.exportCsv(T.value),json:$.exportJson(T.value),report:$.exportReport(T.value)}[t];p&&window.open(p,"_blank")}function me(){U&&(clearInterval(U),U=null),re.value=!1,setTimeout(()=>{b.value=null},300)}async function ot(){try{const t=await $.getRedlineExportStatus(T.value);b.value=t.data,(t.data.status==="completed"||t.data.status==="failed")&&(U&&(clearInterval(U),U=null),te.value=!1)}catch(t){console.error("获取导出状态失败:",t)}}async function st(){te.value=!0,b.value={status:"pending",progress:0,message:"正在启动导出..."};try{const t=await $.startRedlineExport(T.value,null,le.value);b.value=t.data,U&&clearInterval(U),U=setInterval(ot,1e3)}catch(t){console.error("启动导出失败:",t),b.value={status:"failed",progress:0,message:"启动失败",error:t.message},te.value=!1}}gt(()=>{U&&(clearInterval(U),U=null)});async function nt(){Q.value=!0;try{const t=await $.downloadRedlineExport(T.value),e=t.headers["content-disposition"];let p="document_redline.docx";if(e){const h=e.match(/filename\*=UTF-8''([^;\s]+)/);if(h)p=decodeURIComponent(h[1]);else{const R=e.match(/filename="?([^"]+)"?/);R&&(p=R[1])}}const f=new Blob([t.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),c=window.URL.createObjectURL(f),v=document.createElement("a");v.href=c,v.download=p,document.body.appendChild(v),v.click(),document.body.removeChild(v),window.URL.revokeObjectURL(c),N.success("文件下载成功"),await we(),me()}catch(t){console.error("下载失败:",t),N.error(t.message||"下载失败，请重试")}finally{Q.value=!1}}return(t,e)=>{var De,Me,Ue,Ae;const p=ht,f=ee("ArrowLeft"),c=kt,v=xt,h=wt,R=ee("EditPen"),q=Et,B=ee("Download"),j=ee("ArrowDown"),I=Rt,X=Tt,se=Ct,Y=Vt,ne=ee("Document"),m=Dt,g=ee("ChatLineSquare"),M=Mt,ie=Ut,F=At,J=St,W=Lt,fe=It,A=Bt,P=zt,it=Ot,Re=Nt,he=Ht,ut=jt,ve=Ft,Ce=qt,rt=Pt,ue=Wt,G=Kt,Ve=Gt,dt=Jt,ct=bt;return yt((d(),k("div",Qt,[(d(!0),k(_e,null,Ie(((De=y.value)==null?void 0:De.notices)||[],(i,_)=>(d(),x(p,{key:_,title:i,type:"info","show-icon":"",closable:!0,style:{"margin-bottom":"12px"}},null,8,["title"]))),128)),s("div",Xt,[s("div",Yt,[l(v,{text:"",onClick:Fe},{default:a(()=>[l(c,null,{default:a(()=>[l(f)]),_:1}),u(" "+o(n.value.labels.back),1)]),_:1}),s("h2",null,o(((Me=y.value)==null?void 0:Me.document_name)||n.value.labels.reviewResult),1),s("div",el,[l(h,null,{default:a(()=>[u(o(ze.value),1)]),_:1}),K.value?(d(),x(h,{key:0,type:"success",size:"small"},{default:a(()=>[...e[11]||(e[11]=[u("EN",-1)])]),_:1})):S("",!0),s("span",null,o(n.value.labels.ourParty)+" "+o((Ue=y.value)==null?void 0:Ue.our_party),1),s("span",null,o(n.value.labels.reviewTime)+" "+o(Ee((Ae=y.value)==null?void 0:Ae.reviewed_at)),1)])]),s("div",tl,[l(q,{content:Be.value,disabled:xe.value,placement:"bottom"},{default:a(()=>[s("span",null,[l(v,{type:"success",onClick:e[0]||(e[0]=i=>re.value=!0),disabled:!xe.value},{default:a(()=>[l(c,null,{default:a(()=>[l(R)]),_:1}),u(" "+o(n.value.labels.exportRedline),1)]),_:1},8,["disabled"])])]),_:1},8,["content","disabled"]),l(se,{onCommand:at},{dropdown:a(()=>[l(X,null,{default:a(()=>[l(I,{command:"excel"},{default:a(()=>[u(o(K.value?"Export Excel":"导出 Excel"),1)]),_:1}),l(I,{command:"csv"},{default:a(()=>[u(o(K.value?"Export CSV":"导出 CSV"),1)]),_:1}),l(I,{command:"json"},{default:a(()=>[u(o(K.value?"Export JSON":"导出 JSON"),1)]),_:1}),l(I,{command:"report"},{default:a(()=>[u(o(K.value?"Export Report":"导出报告"),1)]),_:1})]),_:1})]),default:a(()=>[l(v,{type:"primary"},{default:a(()=>[l(c,null,{default:a(()=>[l(B)]),_:1}),u(" "+o(n.value.labels.export)+" ",1),l(c,{class:"el-icon--right"},{default:a(()=>[l(j)]),_:1})]),_:1})]),_:1})])]),l(F,{modelValue:re.value,"onUpdate:modelValue":e[2]||(e[2]=i=>re.value=i),title:"导出修订版 Word",width:"500px"},{footer:a(()=>{var i;return[z.value?(d(),k(_e,{key:0},[l(v,{onClick:me},{default:a(()=>[...e[25]||(e[25]=[u("关闭",-1)])]),_:1}),l(v,{type:"primary",onClick:je,loading:Q.value},{default:a(()=>[...e[26]||(e[26]=[u(" 下载文件 ",-1)])]),_:1},8,["loading"])],64)):(d(),k(_e,{key:1},[l(v,{onClick:me},{default:a(()=>{var _;return[u(o(((_=b.value)==null?void 0:_.status)==="completed"?"关闭":"取消"),1)]}),_:1}),((i=b.value)==null?void 0:i.status)==="completed"?(d(),x(v,{key:0,type:"success",onClick:nt,loading:Q.value},{default:a(()=>[...e[27]||(e[27]=[u(" 下载文件 ",-1)])]),_:1},8,["loading"])):(d(),x(v,{key:1,type:"primary",onClick:st,loading:te.value,disabled:de.value===0&&(!le.value||!ce.value)},{default:a(()=>[u(o(te.value?"正在导出...":"开始导出"),1)]),_:1},8,["loading","disabled"]))],64))]}),default:a(()=>{var i,_,H,r,E,Le,Se;return[z.value?(d(),k("div",ll,[l(Y,{icon:"success",title:"修订版文档已生成","sub-title":`生成时间：${Ee(z.value.generated_at)}`},{extra:a(()=>[s("div",al,[s("p",null,[e[12]||(e[12]=u("应用 ",-1)),s("strong",null,o(z.value.applied_count||0),1),e[13]||(e[13]=u(" 条修改",-1))]),z.value.comments_count?(d(),k("p",ol,[e[14]||(e[14]=u("添加 ",-1)),s("strong",null,o(z.value.comments_count),1),e[15]||(e[15]=u(" 条批注",-1))])):S("",!0)])]),_:1},8,["sub-title"])])):(d(),k("div",sl,[!((i=w.value)!=null&&i.can_export)&&((_=w.value)!=null&&_.reason)?(d(),x(p,{key:0,title:w.value.reason,type:"warning","show-icon":"",closable:!1,style:{"margin-bottom":"16px"}},null,8,["title"])):S("",!0),b.value?S("",!0):(d(),x(p,{key:1,title:"提示：生成修订版文档预计需要 2-3 分钟，请耐心等待",type:"info","show-icon":"",closable:!1,style:{"margin-bottom":"16px"}})),s("div",nl,[s("div",il,[l(c,null,{default:a(()=>[l(ne)]),_:1}),e[16]||(e[16]=s("span",null,"修改建议（修订标记）",-1))]),e[18]||(e[18]=s("div",{class:"option-desc"}," 将已确认的修改建议以删除线和插入标记形式显示 ",-1)),s("div",ul,[e[17]||(e[17]=u(" 已确认 ",-1)),s("strong",null,o(de.value),1),u(" 条 / 共 "+o(((H=w.value)==null?void 0:H.total_modifications)||0)+" 条 ",1)])]),l(m),s("div",rl,[s("div",dl,[l(M,{modelValue:le.value,"onUpdate:modelValue":e[1]||(e[1]=pt=>le.value=pt),disabled:!ce.value},{default:a(()=>[l(c,null,{default:a(()=>[l(g)]),_:1}),e[19]||(e[19]=s("span",null,"行动建议（批注）",-1))]),_:1},8,["modelValue","disabled"])]),e[22]||(e[22]=s("div",{class:"option-desc"}," 将已确认的行动建议作为批注添加到对应风险点的文本位置 ",-1)),w.value?(d(),k("div",cl,[e[20]||(e[20]=u(" 已确认 ",-1)),s("strong",null,o(Oe.value),1),e[21]||(e[21]=u(" 条，可添加 ",-1)),s("strong",null,o(w.value.commentable_actions||0),1),u(" 条批注 / 共 "+o(w.value.total_actions||0)+" 条行动建议 ",1)])):S("",!0),((r=w.value)==null?void 0:r.confirmed_actions)>0&&((E=w.value)==null?void 0:E.commentable_actions)===0?(d(),x(p,{key:1,title:"已确认的行动建议未关联风险点原文，无法生成批注",type:"info","show-icon":"",closable:!1,style:{"margin-top":"8px"}})):((Le=w.value)==null?void 0:Le.total_actions)>0&&(((Se=w.value)==null?void 0:Se.confirmed_actions)||0)===0?(d(),x(p,{key:2,title:"请先在行动建议列表中勾选确认要导出的建议",type:"info","show-icon":"",closable:!1,style:{"margin-top":"8px"}})):S("",!0)]),b.value?(d(),k("div",pl,[l(m),s("div",ml,[s("span",null,o(b.value.message),1),b.value.status==="completed"?(d(),x(h,{key:0,type:"success",size:"small"},{default:a(()=>[...e[23]||(e[23]=[u("完成",-1)])]),_:1})):b.value.status==="failed"?(d(),x(h,{key:1,type:"danger",size:"small"},{default:a(()=>[...e[24]||(e[24]=[u("失败",-1)])]),_:1})):(d(),x(h,{key:2,type:"info",size:"small"},{default:a(()=>[u(o(b.value.progress)+"%",1)]),_:1}))]),l(ie,{percentage:b.value.progress,status:b.value.status==="completed"?"success":b.value.status==="failed"?"exception":"","stroke-width":10,style:{"margin-top":"8px"}},null,8,["percentage","status"]),b.value.status==="completed"?(d(),k("div",fl,[s("p",null,"应用 "+o(b.value.applied_count)+" 条修改，跳过 "+o(b.value.skipped_count)+" 条",1),le.value?(d(),k("p",vl,"添加 "+o(b.value.comments_added)+" 条批注",1)):S("",!0)])):S("",!0),b.value.status==="failed"?(d(),k("div",_l,[l(p,{title:b.value.error||"导出失败",type:"error","show-icon":"",closable:!1},null,8,["title"])])):S("",!0)])):S("",!0)]))]}),_:1},8,["modelValue"]),l(fe,{gutter:16,class:"stat-cards"},{default:a(()=>[l(W,{span:6},{default:a(()=>[l(J,{class:"stat-card danger"},{default:a(()=>[s("div",gl,o(O.value.total_risks),1),s("div",yl,o(n.value.labels.totalRisks),1),s("div",bl,o(n.value.labels.highDetail)+" "+o(O.value.high_risks)+" / "+o(n.value.labels.mediumDetail)+" "+o(O.value.medium_risks)+" / "+o(n.value.labels.lowDetail)+" "+o(O.value.low_risks),1)]),_:1})]),_:1}),l(W,{span:6},{default:a(()=>[l(J,{class:"stat-card warning"},{default:a(()=>[s("div",hl,o(O.value.high_risks),1),s("div",kl,o(n.value.labels.highRisks),1),s("div",xl,o(n.value.labels.priorityNeeded),1)]),_:1})]),_:1}),l(W,{span:6},{default:a(()=>[l(J,{class:"stat-card primary"},{default:a(()=>[s("div",wl,o(O.value.total_modifications),1),s("div",El,o(n.value.labels.modifications),1),s("div",Tl,o(n.value.labels.mustModify)+" "+o(O.value.must_modify)+" / "+o(n.value.labels.shouldModify)+" "+o(O.value.should_modify),1)]),_:1})]),_:1}),l(W,{span:6},{default:a(()=>[l(J,{class:"stat-card success"},{default:a(()=>[s("div",Rl,o(O.value.total_actions),1),s("div",Cl,o(n.value.labels.actions),1),s("div",Vl,o(n.value.labels.immediateActions)+" "+o(O.value.immediate_actions),1)]),_:1})]),_:1})]),_:1}),l(J,{class:"content-card"},{default:a(()=>[l(rt,{modelValue:ke.value,"onUpdate:modelValue":e[3]||(e[3]=i=>ke.value=i)},{default:a(()=>[l(he,{label:n.value.labels.risks,name:"risks"},{label:a(()=>{var i,_;return[s("span",null,[u(o(n.value.labels.risks)+" ",1),l(A,{value:((_=(i=y.value)==null?void 0:i.risks)==null?void 0:_.length)||0,type:"danger"},null,8,["value"])])]}),default:a(()=>{var i;return[l(Re,{data:((i=y.value)==null?void 0:i.risks)||[],stripe:"",border:""},{default:a(()=>[l(P,{label:n.value.labels.riskLevelCol,width:"100",align:"center"},{default:a(({row:_})=>[l(h,{type:qe(_.risk_level)},{default:a(()=>[u(o(Je(_.risk_level)),1)]),_:2},1032,["type"])]),_:1},8,["label"]),l(P,{prop:"risk_type",label:n.value.labels.riskType,width:"120"},null,8,["label"]),l(P,{prop:"description",label:n.value.labels.riskDescription,"min-width":"200"},null,8,["label"]),l(P,{prop:"reason",label:n.value.labels.reason,"min-width":"200"},null,8,["label"]),l(P,{label:n.value.labels.originalText,width:"200"},{default:a(({row:_})=>{var H;return[(H=_.location)!=null&&H.original_text?(d(),x(it,{key:0,trigger:"hover",width:"400",placement:"top"},{reference:a(()=>[s("span",Dl,o(_.location.original_text.slice(0,50))+"... ",1)]),default:a(()=>[s("div",null,o(_.location.original_text),1)]),_:2},1024)):(d(),k("span",Ml,"-"))]}),_:1},8,["label"])]),_:1},8,["data"])]}),_:1},8,["label"]),l(he,{label:n.value.labels.modifications,name:"modifications"},{label:a(()=>{var i,_;return[s("span",null,[u(o(n.value.labels.modifications)+" ",1),l(A,{value:((_=(i=y.value)==null?void 0:i.modifications)==null?void 0:_.length)||0,type:"primary"},null,8,["value"])])]}),default:a(()=>{var i,_,H;return[s("div",Ul,[(d(!0),k(_e,null,Ie(((i=y.value)==null?void 0:i.modifications)||[],r=>(d(),x(J,{key:r.id,class:$t(["modification-card",{confirmed:r.user_confirmed}])},{default:a(()=>[s("div",Al,[l(h,{type:We(r.priority)},{default:a(()=>[u(o(Ge(r.priority)),1)]),_:2},1032,["type"]),s("span",Ll,o(r.modification_reason),1),s("div",Sl,[l(ut,{modelValue:D(r.id).showDiff,"onUpdate:modelValue":E=>D(r.id).showDiff=E,"active-text":n.value.labels.diff,"inactive-text":n.value.labels.fullText,size:"small",style:{"margin-right":"12px"}},null,8,["modelValue","onUpdate:modelValue","active-text","inactive-text"]),l(M,{modelValue:r.user_confirmed,"onUpdate:modelValue":E=>r.user_confirmed=E,onChange:E=>Ye(r,{user_confirmed:E})},{default:a(()=>[u(o(n.value.labels.confirmAdopt),1)]),_:1},8,["modelValue","onUpdate:modelValue","onChange"])])]),l(fe,{gutter:20,class:"mod-content"},{default:a(()=>[l(W,{span:12},{default:a(()=>[s("div",Il,o(n.value.labels.currentText),1),D(r.id).showDiff?(d(),k("div",{key:0,class:"text-box diff-view",innerHTML:Te(r).originalHtml},null,8,Pl)):(d(),k("div",Hl,o(r.original_text),1))]),_:2},1024),l(W,{span:12},{default:a(()=>[s("div",Nl,[u(o(n.value.labels.suggestedText)+" ",1),D(r.id).isEditing?(d(),x(v,{key:1,type:"success",link:"",size:"small",onClick:E=>Xe(r)},{default:a(()=>[u(o(n.value.labels.save),1)]),_:1},8,["onClick"])):(d(),x(v,{key:0,type:"primary",link:"",size:"small",onClick:E=>D(r.id).isEditing=!0},{default:a(()=>[u(o(n.value.labels.edit),1)]),_:1},8,["onClick"]))]),D(r.id).showDiff&&!D(r.id).isEditing?(d(),k("div",{key:0,class:"text-box diff-view suggested",innerHTML:Te(r).modifiedHtml},null,8,zl)):D(r.id).isEditing?(d(),x(ve,{key:2,type:"textarea",rows:4,modelValue:D(r.id).editText,"onUpdate:modelValue":E=>D(r.id).editText=E},null,8,["modelValue","onUpdate:modelValue"])):(d(),k("div",Ol,o(D(r.id).editText||r.suggested_text),1))]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"]))),128)),(H=(_=y.value)==null?void 0:_.modifications)!=null&&H.length?S("",!0):(d(),x(Ce,{key:0,description:n.value.labels.noModifications},null,8,["description"]))])]}),_:1},8,["label"]),l(he,{label:n.value.labels.actions,name:"actions"},{label:a(()=>{var i,_;return[s("span",null,[u(o(n.value.labels.actions)+" ",1),l(A,{value:((_=(i=y.value)==null?void 0:i.actions)==null?void 0:_.length)||0,type:"success"},null,8,["value"])])]}),default:a(()=>{var i,_,H;return[l(Re,{data:((i=y.value)==null?void 0:i.actions)||[],stripe:"",border:""},{default:a(()=>[l(P,{label:n.value.labels.urgencyCol,width:"100",align:"center"},{default:a(({row:r})=>[l(h,{type:Ke(r.urgency)},{default:a(()=>[u(o(Ze(r.urgency)),1)]),_:2},1032,["type"])]),_:1},8,["label"]),l(P,{prop:"action_type",label:n.value.labels.actionType,width:"120"},null,8,["label"]),l(P,{prop:"description",label:n.value.labels.specificAction,"min-width":"250"},null,8,["label"]),l(P,{prop:"responsible_party",label:n.value.labels.responsibleParty,width:"100"},null,8,["label"]),l(P,{prop:"deadline_suggestion",label:n.value.labels.deadline,width:"120"},{default:a(({row:r})=>[u(o(r.deadline_suggestion||"-"),1)]),_:1},8,["label"]),l(P,{label:n.value.labels.operation,width:"130",align:"center"},{default:a(({row:r})=>[l(M,{modelValue:r.user_confirmed,"onUpdate:modelValue":E=>r.user_confirmed=E,onChange:E=>et(r,E),style:{"margin-right":"8px"}},{default:a(()=>[u(o(n.value.labels.confirm),1)]),_:1},8,["modelValue","onUpdate:modelValue","onChange"]),l(v,{type:"primary",link:"",size:"small",onClick:E=>tt(r)},{default:a(()=>[u(o(n.value.labels.edit),1)]),_:1},8,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"]),(H=(_=y.value)==null?void 0:_.actions)!=null&&H.length?S("",!0):(d(),x(Ce,{key:0,description:n.value.labels.noActions},null,8,["description"]))]}),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1}),l(F,{modelValue:oe.value,"onUpdate:modelValue":e[10]||(e[10]=i=>oe.value=i),title:"编辑行动建议",width:"500px","close-on-click-modal":!1},{footer:a(()=>[l(v,{onClick:e[9]||(e[9]=i=>oe.value=!1)},{default:a(()=>[...e[28]||(e[28]=[u("取消",-1)])]),_:1}),l(v,{type:"primary",onClick:lt,loading:ye.value},{default:a(()=>[...e[29]||(e[29]=[u(" 保存 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(dt,{model:C.value,"label-width":"80px"},{default:a(()=>[l(ue,{label:"具体行动"},{default:a(()=>[l(ve,{modelValue:C.value.description,"onUpdate:modelValue":e[4]||(e[4]=i=>C.value.description=i),type:"textarea",rows:3,placeholder:"请输入具体行动描述"},null,8,["modelValue"])]),_:1}),l(ue,{label:"行动类型"},{default:a(()=>[l(Ve,{modelValue:C.value.action_type,"onUpdate:modelValue":e[5]||(e[5]=i=>C.value.action_type=i),style:{width:"100%"}},{default:a(()=>[l(G,{label:"沟通协商",value:"沟通协商"}),l(G,{label:"补充材料",value:"补充材料"}),l(G,{label:"法务确认",value:"法务确认"}),l(G,{label:"内部审批",value:"内部审批"}),l(G,{label:"核实信息",value:"核实信息"})]),_:1},8,["modelValue"])]),_:1}),l(ue,{label:"紧急程度"},{default:a(()=>[l(Ve,{modelValue:C.value.urgency,"onUpdate:modelValue":e[6]||(e[6]=i=>C.value.urgency=i),style:{width:"100%"}},{default:a(()=>[l(G,{label:"立即处理",value:"immediate"}),l(G,{label:"尽快处理",value:"soon"}),l(G,{label:"一般",value:"normal"})]),_:1},8,["modelValue"])]),_:1}),l(ue,{label:"负责方"},{default:a(()=>[l(ve,{modelValue:C.value.responsible_party,"onUpdate:modelValue":e[7]||(e[7]=i=>C.value.responsible_party=i),placeholder:"请输入负责方"},null,8,["modelValue"])]),_:1}),l(ue,{label:"建议时限"},{default:a(()=>[l(ve,{modelValue:C.value.deadline_suggestion,"onUpdate:modelValue":e[8]||(e[8]=i=>C.value.deadline_suggestion=i),placeholder:"如：签署前、3个工作日内"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])),[[ct,ge.value]])}}},la=mt(Bl,[["__scopeId","data-v-6538a06e"]]);export{la as default};
