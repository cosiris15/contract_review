import{_ as pe,u as me,r as p,q as g,v as ge,o as he,x as z,c as m,a as d,e as s,f as l,d as h,y as ye,b as D,w as n,g as i,k as we,i as r,z as K,t as v,E as Ce,p as Te,A as j,B as Ve,C as be,D as ke,F as xe,s as Ee,G as ze,H as Se,I as Ie,J as $e,K as De,L as Le,M as Ne,N as Ue,O as Be,P as Me,Q as N,R as Pe,S as Re,T as Fe,U as Oe,l as Ae,V as Ke,W as q}from"./index-LNbvnzbl.js";/* empty css                 *//* empty css                  *//* empty css                */import{u as je}from"./index-Uf0I8LME.js";const qe={class:"documents-view"},Ge={class:"page-header"},He={class:"header-actions"},Je={class:"stats-cards"},Qe={class:"stat-card"},We={class:"stat-icon total"},Xe={class:"stat-info"},Ye={class:"stat-value"},Ze={class:"stat-card"},et={class:"stat-icon completed"},tt={class:"stat-info"},lt={class:"stat-value completed"},at={class:"stat-card"},st={class:"stat-icon in-progress"},nt={class:"stat-info"},ot={class:"stat-value in-progress"},ut={class:"stat-card"},it={class:"stat-icon failed"},dt={class:"stat-info"},rt={class:"stat-value failed"},ct={class:"filter-row"},vt={key:0,class:"filter-results"},ft={class:"documents-list"},_t={key:0,class:"select-all-row"},pt=["onClick"],mt={class:"document-icon"},gt={class:"document-info"},ht={class:"document-name"},yt={class:"document-meta"},wt={key:0},Ct={key:1,class:"meta-sep"},Tt={class:"document-actions"},Vt={key:1,class:"pagination-wrapper"},U=10,bt={__name:"DocumentsView",setup(kt){const L=me(),y=je(),b=p(!1),f=p([]),k=p(""),w=p(""),C=p(""),T=p("created_at"),V=p("desc"),x=p(1),u=p([]);let B=null;const S=g(()=>{let t=[...f.value];if(k.value){const e=k.value.toLowerCase();t=t.filter(a=>(a.document_filename||"").toLowerCase().includes(e)||(a.name||"").toLowerCase().includes(e)||(a.our_party||"").toLowerCase().includes(e))}return w.value&&(t=t.filter(e=>e.status===w.value)),C.value&&(t=t.filter(e=>e.material_type===C.value)),t.sort((e,a)=>{let c,E;return T.value==="name"?(c=(e.document_filename||e.name||"").toLowerCase(),E=(a.document_filename||a.name||"").toLowerCase()):(c=new Date(e[T.value]||0).getTime(),E=new Date(a[T.value]||0).getTime()),V.value==="desc"?c>E?-1:1:c<E?-1:1}),t}),I=g(()=>{const t=(x.value-1)*U,e=t+U;return S.value.slice(t,e)}),G=g(()=>f.value.length),H=g(()=>f.value.filter(t=>t.status==="completed").length),J=g(()=>f.value.filter(t=>t.status==="reviewing"||t.status==="created"||t.status==="uploading").length),Q=g(()=>f.value.filter(t=>t.status==="failed").length),R=g({get:()=>{const t=I.value.map(e=>e.id);return t.length>0&&t.every(e=>u.value.includes(e))},set:()=>{}}),W=g(()=>{const t=I.value.map(a=>a.id),e=t.filter(a=>u.value.includes(a));return e.length>0&&e.length<t.length});ge([w,C,T,V],()=>{x.value=1}),he(async()=>{await X()});async function X(){var t;b.value=!0;try{await y.fetchTasks(),f.value=y.tasks}catch(e){z.error(((t=e.errorInfo)==null?void 0:t.message)||"获取任务列表失败")}finally{b.value=!1}}function Y(){B&&clearTimeout(B),B=setTimeout(()=>{x.value=1},300)}function Z(){V.value=V.value==="desc"?"asc":"desc"}function ee(){k.value="",w.value="",C.value="",T.value="created_at",V.value="desc",x.value=1}function te(){window.scrollTo({top:0,behavior:"smooth"})}function le(t,e){e?u.value.push(t):u.value=u.value.filter(a=>a!==t)}function ae(t){const e=I.value.map(a=>a.id);t?e.forEach(a=>{u.value.includes(a)||u.value.push(a)}):u.value=u.value.filter(a=>!e.includes(a))}async function se(){try{await q.confirm(`确定要删除选中的 ${u.value.length} 个文档吗？此操作不可恢复。`,"批量删除",{type:"warning"}),b.value=!0;let t=0,e=0;for(const a of u.value)try{await y.deleteTask(a),t++}catch{e++}f.value=y.tasks,u.value=[],e===0?z.success(`成功删除 ${t} 个文档`):z.warning(`删除完成：成功 ${t} 个，失败 ${e} 个`)}catch(t){t!=="cancel"&&z.error("删除失败")}finally{b.value=!1}}async function ne(t){try{await q.confirm(`确定要删除 "${t.document_filename||t.name}" 吗？`,"确认删除",{type:"warning"}),await y.deleteTask(t.id),f.value=y.tasks,u.value=u.value.filter(e=>e!==t.id),z.success("删除成功")}catch(e){e!=="cancel"&&z.error("删除失败")}}function F(){y.resetState(),L.push("/review")}function O(t){t.status==="completed"?L.push(`/interactive/${t.id}`):L.push(`/review/${t.id}`)}function oe(t){L.push(`/interactive/${t.id}`)}function ue(t){return{created:"info",uploading:"info",reviewing:"warning",completed:"success",failed:"danger"}[t]||"info"}function ie(t){return{created:"已创建",uploading:"上传中",reviewing:"审阅中",completed:"已完成",failed:"失败"}[t]||t}function de(t){return t==="contract"?"合同":"营销材料"}function re(t){return t?new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}return(t,e)=>{const a=we,c=Ce,E=xe,_=Se,M=ze,ce=$e,A=Le,ve=Ne,P=Pe,fe=Ke,_e=De;return d(),m("div",qe,[s("div",Ge,[e[8]||(e[8]=s("div",{class:"header-left"},[s("h1",null,"文档管理"),s("p",{class:"subtitle"},"管理所有审阅任务和文档")],-1)),s("div",He,[u.value.length>0?(d(),D(c,{key:0,type:"danger",onClick:se},{default:n(()=>[l(a,null,{default:n(()=>[l(r(K))]),_:1}),i(" 删除选中 ("+v(u.value.length)+") ",1)]),_:1})):h("",!0),l(c,{type:"primary",onClick:F},{default:n(()=>[l(a,null,{default:n(()=>[l(r(Te))]),_:1}),e[7]||(e[7]=i(" 新建审阅任务 ",-1))]),_:1})])]),s("div",Je,[s("div",Qe,[s("div",We,[l(a,{size:24},{default:n(()=>[l(r(j))]),_:1})]),s("div",Xe,[s("div",Ye,v(G.value),1),e[9]||(e[9]=s("div",{class:"stat-label"},"文档总数",-1))])]),s("div",Ze,[s("div",et,[l(a,{size:24},{default:n(()=>[l(r(Ve))]),_:1})]),s("div",tt,[s("div",lt,v(H.value),1),e[10]||(e[10]=s("div",{class:"stat-label"},"已完成",-1))])]),s("div",at,[s("div",st,[l(a,{size:24},{default:n(()=>[l(r(be))]),_:1})]),s("div",nt,[s("div",ot,v(J.value),1),e[11]||(e[11]=s("div",{class:"stat-label"},"进行中",-1))])]),s("div",ut,[s("div",it,[l(a,{size:24},{default:n(()=>[l(r(ke))]),_:1})]),s("div",dt,[s("div",rt,v(Q.value),1),e[12]||(e[12]=s("div",{class:"stat-label"},"失败",-1))])])]),l(ce,{class:"filter-card"},{default:n(()=>[s("div",ct,[l(E,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=o=>k.value=o),placeholder:"搜索文档名称、我方身份...",clearable:"",style:{width:"280px"},onInput:Y},{prefix:n(()=>[l(a,null,{default:n(()=>[l(r(Ee))]),_:1})]),_:1},8,["modelValue"]),l(M,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=o=>w.value=o),placeholder:"状态",clearable:"",style:{width:"130px"}},{default:n(()=>[l(_,{label:"已创建",value:"created"}),l(_,{label:"审阅中",value:"reviewing"}),l(_,{label:"已完成",value:"completed"}),l(_,{label:"失败",value:"failed"})]),_:1},8,["modelValue"]),l(M,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=o=>C.value=o),placeholder:"材料类型",clearable:"",style:{width:"130px"}},{default:n(()=>[l(_,{label:"合同",value:"contract"}),l(_,{label:"营销材料",value:"marketing"})]),_:1},8,["modelValue"]),l(M,{modelValue:T.value,"onUpdate:modelValue":e[3]||(e[3]=o=>T.value=o),placeholder:"排序",style:{width:"140px"}},{default:n(()=>[l(_,{label:"创建时间",value:"created_at"}),l(_,{label:"更新时间",value:"updated_at"}),l(_,{label:"文档名称",value:"name"})]),_:1},8,["modelValue"]),l(c,{icon:V.value==="desc"?"SortDown":"SortUp",onClick:Z},{default:n(()=>[i(v(V.value==="desc"?"降序":"升序"),1)]),_:1},8,["icon"]),l(c,{text:"",onClick:ee},{default:n(()=>[l(a,null,{default:n(()=>[l(r(Ie))]),_:1}),e[13]||(e[13]=i(" 重置 ",-1))]),_:1})])]),_:1}),f.value.length>0&&(k.value||w.value||C.value)?(d(),m("div",vt,[s("span",null,"筛选结果：共 "+v(S.value.length)+" 个文档",1)])):h("",!0),ye((d(),m("div",ft,[I.value.length>0?(d(),m("div",_t,[l(A,{modelValue:R.value,"onUpdate:modelValue":e[4]||(e[4]=o=>R.value=o),indeterminate:W.value,onChange:ae},{default:n(()=>[...e[14]||(e[14]=[i(" 全选当前页 ",-1)])]),_:1},8,["modelValue","indeterminate"])])):h("",!0),S.value.length===0&&!b.value?(d(),D(ve,{key:1,description:"暂无文档"},{default:n(()=>[l(c,{type:"primary",onClick:F},{default:n(()=>[...e[15]||(e[15]=[i("创建第一个任务",-1)])]),_:1})]),_:1})):h("",!0),(d(!0),m(Ue,null,Be(I.value,o=>(d(),m("div",{key:o.id,class:Me(["document-card",{selected:u.value.includes(o.id)}])},[l(A,{"model-value":u.value.includes(o.id),onChange:$=>le(o.id,$),class:"document-checkbox",onClick:e[5]||(e[5]=N(()=>{},["stop"]))},null,8,["model-value","onChange"]),s("div",{class:"document-card-main",onClick:$=>O(o)},[s("div",mt,[l(a,{size:24},{default:n(()=>[l(r(j))]),_:1})]),s("div",gt,[s("div",ht,[i(v(o.document_filename||o.name)+" ",1),l(P,{type:ue(o.status),size:"small"},{default:n(()=>[i(v(ie(o.status)),1)]),_:2},1032,["type"]),l(P,{type:"info",size:"small"},{default:n(()=>[i(v(de(o.material_type)),1)]),_:2},1024)]),s("div",yt,[o.our_party?(d(),m("span",wt,[l(a,null,{default:n(()=>[l(r(Re))]),_:1}),i(" "+v(o.our_party),1)])):h("",!0),e[17]||(e[17]=s("span",{class:"meta-sep"},"|",-1)),s("span",null,[l(a,null,{default:n(()=>[l(r(Fe))]),_:1}),i(" "+v(re(o.created_at)),1)]),o.language==="en"?(d(),m("span",Ct,"|")):h("",!0),o.language==="en"?(d(),D(P,{key:2,size:"small",type:"success"},{default:n(()=>[...e[16]||(e[16]=[i("EN",-1)])]),_:1})):h("",!0)])])],8,pt),s("div",Tt,[o.status==="completed"?(d(),D(c,{key:0,text:"",type:"primary",onClick:N($=>oe(o),["stop"])},{default:n(()=>[l(a,null,{default:n(()=>[l(r(Oe))]),_:1}),e[18]||(e[18]=i(" 查看结果 ",-1))]),_:1},8,["onClick"])):(d(),D(c,{key:1,text:"",type:"primary",onClick:N($=>O(o),["stop"])},{default:n(()=>[l(a,null,{default:n(()=>[l(r(Ae))]),_:1}),e[19]||(e[19]=i(" 继续审阅 ",-1))]),_:1},8,["onClick"])),l(c,{text:"",type:"danger",onClick:N($=>ne(o),["stop"])},{default:n(()=>[l(a,null,{default:n(()=>[l(r(K))]),_:1}),e[20]||(e[20]=i(" 删除 ",-1))]),_:1},8,["onClick"])])],2))),128))])),[[_e,b.value]]),S.value.length>U?(d(),m("div",Vt,[l(fe,{"current-page":x.value,"onUpdate:currentPage":e[6]||(e[6]=o=>x.value=o),"page-size":U,total:S.value.length,layout:"prev, pager, next, jumper",onCurrentChange:te},null,8,["current-page","total"])])):h("",!0)])}}},$t=pe(bt,[["__scopeId","data-v-9f51f526"]]);export{$t as default};
