import{_ as q,r as _,n as F,q as T,a as R,c as p,b as f,f as i,g as y,h as D,w as k,i as C,z as J,t as L,d as $,e as I,F as z,G,H as Q,B as H,N as S,af as X,aa as Y,A as Z,ag as ee,x as A,ah as K,a7 as j,I as E,ai as W,aj as te,ak as se}from"./index-BxL5DJ8Y.js";const ne={class:"document-header"},ae={class:"document-title"},ie={class:"paragraph-count"},oe=["id"],le={class:"para-number"},de={class:"para-text"},re={key:1,class:"loading-state"},ce={__name:"DocumentViewer",props:{documentName:{type:String,default:""},paragraphs:{type:Array,default:()=>[]},highlightText:{type:String,default:""},loading:{type:Boolean,default:!1}},setup(a,{expose:s}){const t=a,e=_(null),l=_(null),d=_(-1),c=F(()=>{if(!t.highlightText||t.paragraphs.length===0)return-1;const u=t.highlightText.slice(0,80);let r=t.paragraphs.findIndex(h=>h.text.includes(u));if(r===-1&&u.length>40){const h=u.slice(0,40);r=t.paragraphs.findIndex(o=>o.text.includes(h))}if(r===-1&&u.length>20){const h=u.slice(0,20);r=t.paragraphs.findIndex(o=>o.text.includes(h))}return r});function g(){c.value!==-1&&S(()=>{const u=document.getElementById(`para-${c.value}`);u&&l.value&&(u.scrollIntoView({behavior:"smooth",block:"center"}),d.value=c.value,setTimeout(()=>{d.value=-1},2e3))})}function m(u){if(!u||t.paragraphs.length===0)return!1;const r=u.slice(0,80);let h=t.paragraphs.findIndex(o=>o.text.includes(r));if(h===-1&&r.length>40){const o=r.slice(0,40);h=t.paragraphs.findIndex(n=>n.text.includes(o))}return h===-1?!1:(S(()=>{const o=document.getElementById(`para-${h}`);o&&(o.scrollIntoView({behavior:"smooth",block:"center"}),d.value=h,setTimeout(()=>{d.value=-1},2e3))}),!0)}return T(()=>t.highlightText,u=>{u&&g()}),s({scrollToHighlight:g,scrollToText:m}),(u,r)=>{const h=R("el-icon"),o=R("el-empty");return f(),p("div",{class:"document-viewer",ref_key:"containerRef",ref:e},[i("div",ne,[i("h3",ae,[y(h,null,{default:k(()=>[y(C(J))]),_:1}),D(" "+L(a.documentName||"合同文档"),1)]),i("span",ie,"共 "+L(a.paragraphs.length)+" 段",1)]),i("div",{class:"document-content",ref_key:"contentRef",ref:l},[(f(!0),p(z,null,G(a.paragraphs,n=>(f(),p("div",{key:n.index,id:`para-${n.index}`,class:Q(["paragraph",{highlighted:c.value===n.index,pulse:d.value===n.index}])},[i("span",le,L(n.index+1),1),i("span",de,L(n.text),1)],10,oe))),128)),a.paragraphs.length===0&&!a.loading?(f(),$(o,{key:0,description:"暂无文档内容"})):I("",!0),a.loading?(f(),p("div",re,[y(h,{class:"is-loading",size:32},{default:k(()=>[y(C(H))]),_:1}),r[0]||(r[0]=i("span",null,"正在加载文档...",-1))])):I("",!0)],512)],512)}}},tt=q(ce,[["__scopeId","data-v-ac022b6e"]]),ue={class:"message-avatar"},fe={key:0,class:"avatar ai"},me={key:1,class:"avatar user"},ge={class:"message-content"},he={class:"message-header"},ve={class:"sender-name"},pe=["innerHTML"],ye={key:1,class:"suggestion-update"},xe={class:"update-content"},be={__name:"ChatMessage",props:{message:{type:Object,required:!0},showLocateBtn:{type:Boolean,default:!1}},emits:["locate"],setup(a){function s(t){if(!t)return"";const e=t.split(`
`),l=[];let d=!1,c=[];for(const m of e)m.startsWith("> ")?(d=!0,c.push(m.slice(2))):(d&&(l.push(`<blockquote>${c.join("<br>")}</blockquote>`),c=[],d=!1),l.push(m));return d&&l.push(`<blockquote>${c.join("<br>")}</blockquote>`),l.join(`
`).replace(/&(?!amp;|lt;|gt;)/g,"&amp;").replace(/<(?!\/?blockquote>|br>)/g,"&lt;").replace(new RegExp("(?<!blockquote|br)>","g"),"&gt;").replace(/\n/g,"<br>").replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/「(.+?)」/g,'<span class="cn-quote">$1</span>')}return(t,e)=>(f(),p("div",{class:Q(["chat-message",[a.message.role,{streaming:a.message.isStreaming,error:a.message.isError}]])},[i("div",ue,[a.message.role==="assistant"?(f(),p("div",fe,[...e[1]||(e[1]=[i("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"18",height:"18"},[i("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"})],-1)])])):(f(),p("div",me,[...e[2]||(e[2]=[i("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"18",height:"18"},[i("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})],-1)])]))]),i("div",ge,[i("div",he,[i("span",ve,L(a.message.role==="assistant"?"十行":"您"),1)]),i("div",{class:"message-text",innerHTML:s(a.message.content)},null,8,pe),a.message.isContext||a.showLocateBtn?(f(),p("button",{key:0,class:"locate-btn",onClick:e[0]||(e[0]=l=>t.$emit("locate"))},[...e[3]||(e[3]=[i("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"14",height:"14"},[i("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})],-1),D(" 在文档中定位 ",-1)])])):I("",!0),a.message.role==="assistant"&&a.message.suggestion_snapshot?(f(),p("div",ye,[e[4]||(e[4]=i("div",{class:"update-header"},[i("span",{class:"update-icon"},"✨"),i("span",null,"建议已更新")],-1)),i("div",xe,L(a.message.suggestion_snapshot),1)])):I("",!0)])],2))}},ke=q(be,[["__scopeId","data-v-f9c56b44"]]);class Ce{diff(s,t,e={}){let l;typeof e=="function"?(l=e,e={}):"callback"in e&&(l=e.callback);const d=this.castInput(s,e),c=this.castInput(t,e),g=this.removeEmpty(this.tokenize(d,e)),m=this.removeEmpty(this.tokenize(c,e));return this.diffWithOptionsObj(g,m,e,l)}diffWithOptionsObj(s,t,e,l){var d;const c=v=>{if(v=this.postProcess(v,e),l){setTimeout(function(){l(v)},0);return}else return v},g=t.length,m=s.length;let u=1,r=g+m;e.maxEditLength!=null&&(r=Math.min(r,e.maxEditLength));const h=(d=e.timeout)!==null&&d!==void 0?d:1/0,o=Date.now()+h,n=[{oldPos:-1,lastComponent:void 0}];let x=this.extractCommon(n[0],t,s,0,e);if(n[0].oldPos+1>=m&&x+1>=g)return c(this.buildValues(n[0].lastComponent,t,s));let V=-1/0,P=1/0;const b=()=>{for(let v=Math.max(V,-u);v<=Math.min(P,u);v+=2){let w;const B=n[v-1],M=n[v+1];B&&(n[v-1]=void 0);let N=!1;if(M){const U=M.oldPos-v;N=M&&0<=U&&U<g}const O=B&&B.oldPos+1<m;if(!N&&!O){n[v]=void 0;continue}if(!O||N&&B.oldPos<M.oldPos?w=this.addToPath(M,!0,!1,0,e):w=this.addToPath(B,!1,!0,1,e),x=this.extractCommon(w,t,s,v,e),w.oldPos+1>=m&&x+1>=g)return c(this.buildValues(w.lastComponent,t,s))||!0;n[v]=w,w.oldPos+1>=m&&(P=Math.min(P,v-1)),x+1>=g&&(V=Math.max(V,v+1))}u++};if(l)(function v(){setTimeout(function(){if(u>r||Date.now()>o)return l(void 0);b()||v()},0)})();else for(;u<=r&&Date.now()<=o;){const v=b();if(v)return v}}addToPath(s,t,e,l,d){const c=s.lastComponent;return c&&!d.oneChangePerToken&&c.added===t&&c.removed===e?{oldPos:s.oldPos+l,lastComponent:{count:c.count+1,added:t,removed:e,previousComponent:c.previousComponent}}:{oldPos:s.oldPos+l,lastComponent:{count:1,added:t,removed:e,previousComponent:c}}}extractCommon(s,t,e,l,d){const c=t.length,g=e.length;let m=s.oldPos,u=m-l,r=0;for(;u+1<c&&m+1<g&&this.equals(e[m+1],t[u+1],d);)u++,m++,r++,d.oneChangePerToken&&(s.lastComponent={count:1,previousComponent:s.lastComponent,added:!1,removed:!1});return r&&!d.oneChangePerToken&&(s.lastComponent={count:r,previousComponent:s.lastComponent,added:!1,removed:!1}),s.oldPos=m,u}equals(s,t,e){return e.comparator?e.comparator(s,t):s===t||!!e.ignoreCase&&s.toLowerCase()===t.toLowerCase()}removeEmpty(s){const t=[];for(let e=0;e<s.length;e++)s[e]&&t.push(s[e]);return t}castInput(s,t){return s}tokenize(s,t){return Array.from(s)}join(s){return s.join("")}postProcess(s,t){return s}get useLongestToken(){return!1}buildValues(s,t,e){const l=[];let d;for(;s;)l.push(s),d=s.previousComponent,delete s.previousComponent,s=d;l.reverse();const c=l.length;let g=0,m=0,u=0;for(;g<c;g++){const r=l[g];if(r.removed)r.value=this.join(e.slice(u,u+r.count)),u+=r.count;else{if(!r.added&&this.useLongestToken){let h=t.slice(m,m+r.count);h=h.map(function(o,n){const x=e[u+n];return x.length>o.length?x:o}),r.value=this.join(h)}else r.value=this.join(t.slice(m,m+r.count));m+=r.count,r.added||(u+=r.count)}}return l}}class $e extends Ce{}const we=new $e;function Ie(a,s,t){return we.diff(a,s,t)}const _e={class:"diff-view"},Pe=["innerHTML"],Te={__name:"DiffView",props:{original:{type:String,default:""},modified:{type:String,default:""}},setup(a){const s=a,t=F(()=>!s.original&&!s.modified?'<span class="no-diff">暂无内容</span>':s.original?s.modified?Ie(s.original,s.modified).map(d=>{const c=e(d.value);return d.added?`<span class="diff-added">${c}</span>`:d.removed?`<span class="diff-removed">${c}</span>`:c}).join(""):`<span class="diff-removed">${e(s.original)}</span>`:`<span class="diff-added">${e(s.modified)}</span>`);function e(l){const d=document.createElement("div");return d.textContent=l,d.innerHTML.replace(/\n/g,"<br>")}return(l,d)=>(f(),p("div",_e,[d[0]||(d[0]=X('<div class="diff-header" data-v-e2099530><span class="diff-title" data-v-e2099530>修改对比</span><div class="diff-legend" data-v-e2099530><span class="legend-item removed" data-v-e2099530>删除</span><span class="legend-item added" data-v-e2099530>新增</span></div></div>',1)),i("div",{class:"diff-content",innerHTML:t.value},null,8,Pe)]))}},Le=q(Te,[["__scopeId","data-v-e2099530"]]),Ve={class:"chat-panel"},Be={key:0,class:"empty-chat"},Me={key:1,class:"streaming-indicator"},ze={key:0,class:"input-area"},De={key:0,class:"completed-banner"},Se={key:1,class:"skipped-banner"},je={class:"input-container"},Ee=["onKeydown","disabled"],He=["disabled"],Re={class:"input-footer"},qe={class:"action-buttons"},Ne=["disabled"],Ae=["disabled"],Ke={class:"modification-editor"},Oe={class:"editor-label"},Ue=["disabled"],We={class:"input-container secondary"},Fe=["onKeydown","disabled"],Ge=["disabled"],Qe={class:"input-footer"},Je={class:"action-buttons"},Xe=["disabled"],Ye=["disabled"],Ze={__name:"ChatPanel",props:{items:{type:Array,default:()=>[]},activeItem:{type:Object,default:null},messages:{type:Array,default:()=>[]},currentSuggestion:{type:String,default:""},loading:{type:Boolean,default:!1},streaming:{type:Boolean,default:!1},confirmingRisk:{type:Boolean,default:!1}},emits:["select-item","send-message","complete","locate","confirm-risk","skip"],setup(a,{emit:s}){const t=a,e=s,l=_(""),d=_(null),c=_(null),g=_("");T(()=>t.currentSuggestion,o=>{g.value=o},{immediate:!0}),T(()=>{var o;return(o=t.activeItem)==null?void 0:o.id},()=>{var o;(o=t.activeItem)!=null&&o.suggested_text?g.value=t.activeItem.suggested_text:t.currentSuggestion?g.value=t.currentSuggestion:g.value=""});function m(){const o=c.value;o&&(o.style.height="auto",o.style.height=Math.min(o.scrollHeight,120)+"px")}function u(){S(()=>{d.value&&(d.value.scrollTop=d.value.scrollHeight)})}T(()=>t.messages.length,u),T(()=>t.streaming,u),T(()=>{var o;return(o=t.activeItem)==null?void 0:o.id},()=>{S(()=>{d.value&&(d.value.scrollTop=0)})});function r(o){o.shiftKey||(o.preventDefault(),h())}function h(){!l.value.trim()||t.loading||(e("send-message",l.value.trim()),l.value="",S(()=>{c.value&&(c.value.style.height="auto")}))}return(o,n)=>{var P;const x=R("el-icon"),V=R("el-tag");return f(),p("div",Ve,[i("div",{class:"chat-history",ref_key:"chatHistoryRef",ref:d},[a.activeItem?I("",!0):(f(),p("div",Be,[y(x,{size:48},{default:k(()=>[y(C(Y))]),_:1}),n[8]||(n[8]=i("span",null,"请选择一个条目开始审阅",-1))])),(f(!0),p(z,null,G(a.messages,(b,v)=>(f(),$(ke,{key:v,message:b,"show-locate-btn":v===0,onLocate:n[0]||(n[0]=w=>o.$emit("locate"))},null,8,["message","show-locate-btn"]))),128)),a.streaming?(f(),p("div",Me,[...n[9]||(n[9]=[i("span",{class:"typing-cursor"},null,-1)])])):I("",!0)],512),a.activeItem?(f(),p("div",ze,[a.activeItem.chat_status==="completed"?(f(),p("div",De,[y(x,null,{default:k(()=>[y(C(Z))]),_:1}),n[10]||(n[10]=i("span",null,"此条目已审阅完成",-1))])):a.activeItem.is_skipped||a.activeItem.chat_status==="skipped"?(f(),p("div",Se,[y(x,null,{default:k(()=>[y(C(ee))]),_:1}),n[11]||(n[11]=i("span",null,"此风险点已跳过",-1))])):(f(),p(z,{key:2},[a.activeItem.has_modification?(f(),p(z,{key:1},[(P=a.activeItem)!=null&&P.original_text&&g.value?(f(),$(Le,{key:0,original:a.activeItem.original_text,modified:g.value},null,8,["original","modified"])):I("",!0),i("div",Ke,[i("div",Oe,[n[15]||(n[15]=i("span",null,"修改建议（可编辑）",-1)),y(V,{size:"small",type:"success"},{default:k(()=>[...n[14]||(n[14]=[D("已生成",-1)])]),_:1})]),A(i("textarea",{"onUpdate:modelValue":n[4]||(n[4]=b=>g.value=b),class:"suggestion-textarea",rows:"4",disabled:a.loading},null,8,Ue),[[K,g.value]])]),i("div",We,[A(i("textarea",{ref_key:"inputRef",ref:c,"onUpdate:modelValue":n[5]||(n[5]=b=>l.value=b),class:"chat-input",placeholder:"如有问题，可继续讨论...",rows:"1",onInput:m,onKeydown:[j(E(r,["exact"]),["enter"]),j(E(()=>{},["shift","exact"]),["enter"])],disabled:a.loading},null,40,Fe),[[K,l.value]]),i("button",{class:"send-btn",onClick:h,disabled:!l.value.trim()||a.loading},[a.loading?(f(),$(x,{key:0,class:"is-loading"},{default:k(()=>[y(C(H))]),_:1})):(f(),$(x,{key:1},{default:k(()=>[y(C(W))]),_:1}))],8,Ge)]),i("div",Qe,[n[17]||(n[17]=i("span",{class:"phase-hint"},"修改阶段 - 确认建议后提交",-1)),i("div",Je,[i("button",{class:"skip-btn",onClick:n[6]||(n[6]=b=>o.$emit("skip")),disabled:a.loading}," 跳过 ",8,Xe),i("button",{class:"submit-btn",onClick:n[7]||(n[7]=b=>o.$emit("complete",g.value)),disabled:a.loading},[y(x,null,{default:k(()=>[y(C(se))]),_:1}),n[16]||(n[16]=D(" 提交修改 ",-1))],8,Ye)])])],64)):(f(),p(z,{key:0},[i("div",je,[A(i("textarea",{ref_key:"inputRef",ref:c,"onUpdate:modelValue":n[1]||(n[1]=b=>l.value=b),class:"chat-input",placeholder:"与AI讨论这个风险点...",rows:"1",onInput:m,onKeydown:[j(E(r,["exact"]),["enter"]),j(E(()=>{},["shift","exact"]),["enter"])],disabled:a.loading},null,40,Ee),[[K,l.value]]),i("button",{class:"send-btn",onClick:h,disabled:!l.value.trim()||a.loading},[a.loading?(f(),$(x,{key:0,class:"is-loading"},{default:k(()=>[y(C(H))]),_:1})):(f(),$(x,{key:1},{default:k(()=>[y(C(W))]),_:1}))],8,He)]),i("div",Re,[n[13]||(n[13]=i("span",{class:"phase-hint"},"讨论阶段 - 点击生成修改建议",-1)),i("div",qe,[i("button",{class:"skip-btn",onClick:n[2]||(n[2]=b=>o.$emit("skip")),disabled:a.loading}," 跳过 ",8,Ne),i("button",{class:"confirm-btn",onClick:n[3]||(n[3]=b=>o.$emit("confirm-risk")),disabled:a.loading},[a.confirmingRisk?(f(),$(x,{key:0,class:"is-loading"},{default:k(()=>[y(C(H))]),_:1})):(f(),$(x,{key:1},{default:k(()=>[y(C(te))]),_:1})),n[12]||(n[12]=D(" 修改建议 ",-1))],8,Ae)])])],64))],64))])):I("",!0)])}}},st=q(Ze,[["__scopeId","data-v-85bf06a7"]]);export{st as C,tt as D};
