import{_ as ft,Q as mt,u as vt,r as E,q as L,o as _t,E as N,R as j,a as p,x as gt,y as yt,c as x,b as d,f as s,g as l,G as _e,H as Ie,d as w,w as a,h as u,t as o,e as S,I as bt}from"./index-CQyTNtbu.js";import{u as ht}from"./index-CIjsTOlM.js";const kt={class:"result-view"},xt={class:"result-header"},wt={class:"header-info"},Rt={class:"header-meta"},Tt={class:"header-actions"},Ct={key:0,class:"redline-dialog-content"},Vt={class:"persisted-info"},Dt={key:0},Et={key:1,class:"redline-dialog-content"},Ut={class:"export-option"},Mt={class:"option-header"},At={class:"option-count"},Lt={class:"export-option"},St={class:"option-header"},It={key:0,class:"option-count"},Pt={key:2,class:"export-progress"},Ht={class:"progress-header"},Nt={key:0,class:"export-result"},zt={key:0},Ot={key:1,class:"export-error"},$t={class:"stat-value"},jt={class:"stat-label"},Bt={class:"stat-detail"},Ft={class:"stat-value"},qt={class:"stat-label"},Wt={class:"stat-detail"},Jt={class:"stat-value"},Gt={class:"stat-label"},Qt={class:"stat-detail"},Zt={class:"stat-value"},Kt={class:"stat-label"},Xt={class:"stat-detail"},Yt={class:"text-ellipsis"},el={key:1},tl={class:"modification-list"},ll={class:"mod-header"},al={class:"mod-reason"},ol={class:"mod-actions"},sl={class:"text-label"},nl=["innerHTML"],il={key:1,class:"text-box original"},ul={class:"text-label"},rl=["innerHTML"],dl={key:1,class:"text-box suggested"},cl={__name:"ResultView",setup(pl){const Pe=mt(),He=vt(),K=ht(),ge=E(!1),ke=E("risks"),C=L(()=>Pe.params.taskId),te=E(!1),R=E(null),re=E(!1),le=E(!1),h=E(null),X=E(!1);let B=null;const z=E(null),ae=E({}),oe=E(!1),ye=E(!1),be=E(null),D=E({description:"",action_type:"",urgency:"normal",responsible_party:"",deadline_suggestion:""}),b=L(()=>K.reviewResult),O=L(()=>{var t;return((t=b.value)==null?void 0:t.summary)||{total_risks:0,high_risks:0,medium_risks:0,low_risks:0,total_modifications:0,must_modify:0,should_modify:0,total_actions:0,immediate_actions:0}}),Ne=L(()=>{var t;return((t=b.value)==null?void 0:t.language)||"zh-CN"}),Z=L(()=>Ne.value==="en"),n=L(()=>Z.value?{materialType:{contract:"Contract",marketing:"Marketing Material"},riskLevel:{high:"High",medium:"Medium",low:"Low"},priority:{must:"Must",should:"Should",may:"May"},urgency:{immediate:"Immediate",soon:"Soon",normal:"Normal"},labels:{back:"Back",reviewResult:"Review Result",ourParty:"Our Party:",reviewTime:"Review Time:",exportRedline:"Export Redline Word",export:"Export",totalRisks:"Total Risks",highRisks:"High Risks",priorityNeeded:"Priority needed",modifications:"Modifications",actions:"Actions",risks:"Risks",highDetail:"H",mediumDetail:"M",lowDetail:"L",mustModify:"must",shouldModify:"should",immediateActions:"immediate",riskLevelCol:"Risk Level",riskType:"Risk Type",riskDescription:"Description",reason:"Reason",originalText:"Original Text",urgencyCol:"Urgency",actionType:"Action Type",specificAction:"Specific Action",responsibleParty:"Responsible Party",deadline:"Deadline",operation:"Operation",confirm:"Confirm",edit:"Edit",currentText:"Current Text",suggestedText:"Suggested Modification",save:"Save",confirmAdopt:"Confirm",diff:"Diff",fullText:"Full",noModifications:"No modification suggestions",noActions:"No action recommendations"}}:{materialType:{contract:"合同",marketing:"营销材料"},riskLevel:{high:"高",medium:"中",low:"低"},priority:{must:"必须",should:"应该",may:"可以"},urgency:{immediate:"立即",soon:"尽快",normal:"一般"},labels:{back:"返回",reviewResult:"审阅结果",ourParty:"我方:",reviewTime:"审阅时间:",exportRedline:"导出修订版 Word",export:"导出",totalRisks:"风险总数",highRisks:"高风险",priorityNeeded:"需优先处理",modifications:"修改建议",actions:"行动建议",risks:"风险点",highDetail:"高",mediumDetail:"中",lowDetail:"低",mustModify:"必须",shouldModify:"应该",immediateActions:"立即处理",riskLevelCol:"风险等级",riskType:"风险类型",riskDescription:"风险描述",reason:"判定理由",originalText:"原文摘录",urgencyCol:"紧急程度",actionType:"行动类型",specificAction:"具体行动",responsibleParty:"负责方",deadline:"建议时限",operation:"操作",confirm:"确认",edit:"编辑",currentText:"当前文本",suggestedText:"建议修改为",save:"保存",confirmAdopt:"确认采纳",diff:"差异",fullText:"全文",noModifications:"无修改建议",noActions:"无行动建议"}}),ze=L(()=>{var e;const t=(e=b.value)==null?void 0:e.material_type;return n.value.materialType[t]||t}),de=L(()=>{var t;return(t=b.value)!=null&&t.modifications?b.value.modifications.filter(e=>e.user_confirmed).length:0}),Oe=L(()=>{var t;return(t=b.value)!=null&&t.actions?b.value.actions.filter(e=>e.user_confirmed).length:0}),ce=L(()=>{var t;return((t=R.value)==null?void 0:t.commentable_actions)>0}),xe=L(()=>!(R.value&&!R.value.can_export||de.value===0&&!ce.value)),$e=L(()=>{var t;return(t=R.value)!=null&&t.reason?R.value.reason:de.value===0&&!ce.value?"请先确认至少一条修改建议或行动建议":""});function U(t){var e,f;if(!ae.value[t]){const v=(f=(e=b.value)==null?void 0:e.modifications)==null?void 0:f.find(c=>c.id===t);ae.value[t]={showDiff:!0,isEditing:!1,editText:(v==null?void 0:v.user_modified_text)||(v==null?void 0:v.suggested_text)||""}}return ae.value[t]}function je(){var t;(t=b.value)!=null&&t.modifications&&b.value.modifications.forEach(e=>{ae.value[e.id]||(ae.value[e.id]={showDiff:!0,isEditing:!1,editText:e.user_modified_text||e.suggested_text||""})})}_t(async()=>{if(C.value){ge.value=!0;try{await K.loadResult(C.value),je(),await Promise.all([pe(),we()])}catch{N.error("加载结果失败")}finally{ge.value=!1}}});async function pe(){try{const t=await j.getRedlinePreview(C.value);R.value=t.data}catch(t){console.error("获取 Redline 预览失败:",t)}}async function we(){try{const t=await j.getRedlineInfo(C.value);t.data.exists?z.value=t.data:z.value=null}catch(t){console.error("获取 Redline 信息失败:",t),z.value=null}}async function Be(){var t;X.value=!0;try{const e=await j.downloadPersistedRedline(C.value),f=e.headers["content-disposition"];let v=((t=z.value)==null?void 0:t.filename)||"document_redline.docx";if(f){const V=f.match(/filename\*=UTF-8''([^;\s]+)/);if(V)v=decodeURIComponent(V[1]);else{const W=f.match(/filename="?([^"]+)"?/);W&&(v=W[1])}}const c=new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),_=window.URL.createObjectURL(c),k=document.createElement("a");k.href=_,k.download=v,document.body.appendChild(k),k.click(),document.body.removeChild(k),window.URL.revokeObjectURL(_),N.success("文件下载成功"),fe()}catch(e){console.error("下载失败:",e),N.error(e.message||"下载失败，请重试")}finally{X.value=!1}}function Fe(){He.push("/")}function Re(t){if(!t)return"-";const e=new Date(t),f=Z.value?"en-US":"zh-CN";return e.toLocaleString(f)}function qe(t){return{high:"danger",medium:"warning",low:"info"}[t]||"info"}function We(t){return n.value.riskLevel[t]||t}function Je(t){return{must:"danger",should:"warning",may:"info"}[t]||"info"}function Ge(t){return n.value.priority[t]||t}function Qe(t){return{immediate:"danger",soon:"warning",normal:"info"}[t]||"info"}function Ze(t){return n.value.urgency[t]||t}function Ke(t,e){if(!t||!e)return{originalHtml:t||"",modifiedHtml:e||""};if(t===e)return{originalHtml:t,modifiedHtml:e};const f=m=>{const y=[];let M="",ie=null;for(const q of m){const J=/[\u4e00-\u9fa5]/.test(q),G=/[a-zA-Z0-9]/.test(q),me=/\s/.test(q);let A;J?A="cn":G?A="en":me?A="space":A="punct",A==="cn"?(M&&y.push(M),y.push(q),M="",ie=null):A===ie&&A==="en"?M+=q:(M&&y.push(M),M=q,ie=A)}return M&&y.push(M),y},v=f(t),c=f(e),_=v.length,k=c.length,V=Array(_+1).fill(null).map(()=>Array(k+1).fill(0));for(let m=1;m<=_;m++)for(let y=1;y<=k;y++)v[m-1]===c[y-1]?V[m][y]=V[m-1][y-1]+1:V[m][y]=Math.max(V[m-1][y],V[m][y-1]);const W=[];let $=_,F=k;for(;$>0&&F>0;)v[$-1]===c[F-1]?(W.unshift({origIdx:$-1,modIdx:F-1,token:v[$-1]}),$--,F--):V[$-1][F]>V[$][F-1]?$--:F--;const I=m=>m.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");let Y="",se=-1;for(const m of W){for(let y=se+1;y<m.origIdx;y++)Y+=`<del class="diff-del">${I(v[y])}</del>`;Y+=I(m.token),se=m.origIdx}for(let m=se+1;m<_;m++)Y+=`<del class="diff-del">${I(v[m])}</del>`;let ee="",ne=-1;for(const m of W){for(let y=ne+1;y<m.modIdx;y++)ee+=`<ins class="diff-ins">${I(c[y])}</ins>`;ee+=I(m.token),ne=m.modIdx}for(let m=ne+1;m<k;m++)ee+=`<ins class="diff-ins">${I(c[m])}</ins>`;return{originalHtml:Y,modifiedHtml:ee}}function Te(t){const e=t.original_text||"",v=U(t.id).editText||t.user_modified_text||t.suggested_text||"";return Ke(e,v)}async function Xe(t){var f,v;const e=U(t.id);try{await K.updateModification(C.value,t.id,{user_modified_text:e.editText,user_confirmed:!0}),e.isEditing=!1,t.user_confirmed=!0,t.user_modified_text=e.editText,N.success("保存成功"),pe()}catch(c){console.error("保存失败详情:",c),N.error("保存失败: "+(((v=(f=c==null?void 0:c.response)==null?void 0:f.data)==null?void 0:v.detail)||c.message||"请检查网络连接"))}}async function Ye(t,e){try{await K.updateModification(C.value,t.id,e)}catch{N.error("更新失败")}}async function et(t,e){t.user_confirmed=e;try{await K.updateAction(C.value,t.id,e),pe()}catch{t.user_confirmed=!e,N.error("更新失败")}}function tt(t){be.value=t.id,D.value={description:t.description||"",action_type:t.action_type||"",urgency:t.urgency||"normal",responsible_party:t.responsible_party||"",deadline_suggestion:t.deadline_suggestion||""},oe.value=!0}async function lt(){var t,e,f,v;ye.value=!0;try{await K.updateAction(C.value,be.value,{...D.value,user_confirmed:!0});const c=(e=(t=b.value)==null?void 0:t.actions)==null?void 0:e.find(_=>_.id===be.value);c&&(Object.assign(c,D.value),c.user_confirmed=!0),oe.value=!1,N.success("保存成功"),pe()}catch(c){console.error("保存失败详情:",c),N.error("保存失败: "+(((v=(f=c==null?void 0:c.response)==null?void 0:f.data)==null?void 0:v.detail)||c.message||"请检查网络连接"))}finally{ye.value=!1}}function at(t){const f={excel:j.exportExcel(C.value),csv:j.exportCsv(C.value),json:j.exportJson(C.value),report:j.exportReport(C.value)}[t];f&&window.open(f,"_blank")}function fe(){B&&(clearInterval(B),B=null),re.value=!1,setTimeout(()=>{h.value=null},300)}async function ot(){try{const t=await j.getRedlineExportStatus(C.value);h.value=t.data,(t.data.status==="completed"||t.data.status==="failed")&&(B&&(clearInterval(B),B=null),te.value=!1)}catch(t){console.error("获取导出状态失败:",t)}}async function st(){te.value=!0,h.value={status:"pending",progress:0,message:"正在启动导出..."};try{const t=await j.startRedlineExport(C.value,null,le.value);h.value=t.data,B&&clearInterval(B),B=setInterval(ot,1e3)}catch(t){console.error("启动导出失败:",t),h.value={status:"failed",progress:0,message:"启动失败",error:t.message},te.value=!1}}async function nt(){X.value=!0;try{const t=await j.downloadRedlineExport(C.value),e=t.headers["content-disposition"];let f="document_redline.docx";if(e){const k=e.match(/filename\*=UTF-8''([^;\s]+)/);if(k)f=decodeURIComponent(k[1]);else{const V=e.match(/filename="?([^"]+)"?/);V&&(f=V[1])}}const v=new Blob([t.data],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),c=window.URL.createObjectURL(v),_=document.createElement("a");_.href=c,_.download=f,document.body.appendChild(_),_.click(),document.body.removeChild(_),window.URL.revokeObjectURL(c),N.success("文件下载成功"),await we(),fe()}catch(t){console.error("下载失败:",t),N.error(t.message||"下载失败，请重试")}finally{X.value=!1}}return(t,e)=>{var Ee,Ue,Me,Ae;const f=p("el-alert"),v=p("ArrowLeft"),c=p("el-icon"),_=p("el-button"),k=p("el-tag"),V=p("EditPen"),W=p("el-tooltip"),$=p("Download"),F=p("ArrowDown"),I=p("el-dropdown-item"),Y=p("el-dropdown-menu"),se=p("el-dropdown"),ee=p("el-result"),ne=p("Document"),m=p("el-divider"),y=p("ChatLineSquare"),M=p("el-checkbox"),ie=p("el-progress"),q=p("el-dialog"),J=p("el-card"),G=p("el-col"),me=p("el-row"),A=p("el-badge"),P=p("el-table-column"),it=p("el-popover"),Ce=p("el-table"),he=p("el-tab-pane"),ut=p("el-switch"),ve=p("el-input"),Ve=p("el-empty"),rt=p("el-tabs"),ue=p("el-form-item"),Q=p("el-option"),De=p("el-select"),dt=p("el-form"),ct=gt("loading");return yt((d(),x("div",kt,[(d(!0),x(_e,null,Ie(((Ee=b.value)==null?void 0:Ee.notices)||[],(i,g)=>(d(),w(f,{key:g,title:i,type:"info","show-icon":"",closable:!0,style:{"margin-bottom":"12px"}},null,8,["title"]))),128)),s("div",xt,[s("div",wt,[l(_,{text:"",onClick:Fe},{default:a(()=>[l(c,null,{default:a(()=>[l(v)]),_:1}),u(" "+o(n.value.labels.back),1)]),_:1}),s("h2",null,o(((Ue=b.value)==null?void 0:Ue.document_name)||n.value.labels.reviewResult),1),s("div",Rt,[l(k,null,{default:a(()=>[u(o(ze.value),1)]),_:1}),Z.value?(d(),w(k,{key:0,type:"success",size:"small"},{default:a(()=>[...e[11]||(e[11]=[u("EN",-1)])]),_:1})):S("",!0),s("span",null,o(n.value.labels.ourParty)+" "+o((Me=b.value)==null?void 0:Me.our_party),1),s("span",null,o(n.value.labels.reviewTime)+" "+o(Re((Ae=b.value)==null?void 0:Ae.reviewed_at)),1)])]),s("div",Tt,[l(W,{content:$e.value,disabled:xe.value,placement:"bottom"},{default:a(()=>[s("span",null,[l(_,{type:"success",onClick:e[0]||(e[0]=i=>re.value=!0),disabled:!xe.value},{default:a(()=>[l(c,null,{default:a(()=>[l(V)]),_:1}),u(" "+o(n.value.labels.exportRedline),1)]),_:1},8,["disabled"])])]),_:1},8,["content","disabled"]),l(se,{onCommand:at},{dropdown:a(()=>[l(Y,null,{default:a(()=>[l(I,{command:"excel"},{default:a(()=>[u(o(Z.value?"Export Excel":"导出 Excel"),1)]),_:1}),l(I,{command:"csv"},{default:a(()=>[u(o(Z.value?"Export CSV":"导出 CSV"),1)]),_:1}),l(I,{command:"json"},{default:a(()=>[u(o(Z.value?"Export JSON":"导出 JSON"),1)]),_:1}),l(I,{command:"report"},{default:a(()=>[u(o(Z.value?"Export Report":"导出报告"),1)]),_:1})]),_:1})]),default:a(()=>[l(_,{type:"primary"},{default:a(()=>[l(c,null,{default:a(()=>[l($)]),_:1}),u(" "+o(n.value.labels.export)+" ",1),l(c,{class:"el-icon--right"},{default:a(()=>[l(F)]),_:1})]),_:1})]),_:1})])]),l(q,{modelValue:re.value,"onUpdate:modelValue":e[2]||(e[2]=i=>re.value=i),title:"导出修订版 Word",width:"500px"},{footer:a(()=>{var i;return[z.value?(d(),x(_e,{key:0},[l(_,{onClick:fe},{default:a(()=>[...e[25]||(e[25]=[u("关闭",-1)])]),_:1}),l(_,{type:"primary",onClick:Be,loading:X.value},{default:a(()=>[...e[26]||(e[26]=[u(" 下载文件 ",-1)])]),_:1},8,["loading"])],64)):(d(),x(_e,{key:1},[l(_,{onClick:fe},{default:a(()=>{var g;return[u(o(((g=h.value)==null?void 0:g.status)==="completed"?"关闭":"取消"),1)]}),_:1}),((i=h.value)==null?void 0:i.status)==="completed"?(d(),w(_,{key:0,type:"success",onClick:nt,loading:X.value},{default:a(()=>[...e[27]||(e[27]=[u(" 下载文件 ",-1)])]),_:1},8,["loading"])):(d(),w(_,{key:1,type:"primary",onClick:st,loading:te.value,disabled:de.value===0&&(!le.value||!ce.value)},{default:a(()=>[u(o(te.value?"正在导出...":"开始导出"),1)]),_:1},8,["loading","disabled"]))],64))]}),default:a(()=>{var i,g,H,r,T,Le,Se;return[z.value?(d(),x("div",Ct,[l(ee,{icon:"success",title:"修订版文档已生成","sub-title":`生成时间：${Re(z.value.generated_at)}`},{extra:a(()=>[s("div",Vt,[s("p",null,[e[12]||(e[12]=u("应用 ",-1)),s("strong",null,o(z.value.applied_count||0),1),e[13]||(e[13]=u(" 条修改",-1))]),z.value.comments_count?(d(),x("p",Dt,[e[14]||(e[14]=u("添加 ",-1)),s("strong",null,o(z.value.comments_count),1),e[15]||(e[15]=u(" 条批注",-1))])):S("",!0)])]),_:1},8,["sub-title"])])):(d(),x("div",Et,[!((i=R.value)!=null&&i.can_export)&&((g=R.value)!=null&&g.reason)?(d(),w(f,{key:0,title:R.value.reason,type:"warning","show-icon":"",closable:!1,style:{"margin-bottom":"16px"}},null,8,["title"])):S("",!0),h.value?S("",!0):(d(),w(f,{key:1,title:"提示：生成修订版文档预计需要 2-3 分钟，请耐心等待",type:"info","show-icon":"",closable:!1,style:{"margin-bottom":"16px"}})),s("div",Ut,[s("div",Mt,[l(c,null,{default:a(()=>[l(ne)]),_:1}),e[16]||(e[16]=s("span",null,"修改建议（修订标记）",-1))]),e[18]||(e[18]=s("div",{class:"option-desc"}," 将已确认的修改建议以删除线和插入标记形式显示 ",-1)),s("div",At,[e[17]||(e[17]=u(" 已确认 ",-1)),s("strong",null,o(de.value),1),u(" 条 / 共 "+o(((H=R.value)==null?void 0:H.total_modifications)||0)+" 条 ",1)])]),l(m),s("div",Lt,[s("div",St,[l(M,{modelValue:le.value,"onUpdate:modelValue":e[1]||(e[1]=pt=>le.value=pt),disabled:!ce.value},{default:a(()=>[l(c,null,{default:a(()=>[l(y)]),_:1}),e[19]||(e[19]=s("span",null,"行动建议（批注）",-1))]),_:1},8,["modelValue","disabled"])]),e[22]||(e[22]=s("div",{class:"option-desc"}," 将已确认的行动建议作为批注添加到对应风险点的文本位置 ",-1)),R.value?(d(),x("div",It,[e[20]||(e[20]=u(" 已确认 ",-1)),s("strong",null,o(Oe.value),1),e[21]||(e[21]=u(" 条，可添加 ",-1)),s("strong",null,o(R.value.commentable_actions||0),1),u(" 条批注 / 共 "+o(R.value.total_actions||0)+" 条行动建议 ",1)])):S("",!0),((r=R.value)==null?void 0:r.confirmed_actions)>0&&((T=R.value)==null?void 0:T.commentable_actions)===0?(d(),w(f,{key:1,title:"已确认的行动建议未关联风险点原文，无法生成批注",type:"info","show-icon":"",closable:!1,style:{"margin-top":"8px"}})):((Le=R.value)==null?void 0:Le.total_actions)>0&&(((Se=R.value)==null?void 0:Se.confirmed_actions)||0)===0?(d(),w(f,{key:2,title:"请先在行动建议列表中勾选确认要导出的建议",type:"info","show-icon":"",closable:!1,style:{"margin-top":"8px"}})):S("",!0)]),h.value?(d(),x("div",Pt,[l(m),s("div",Ht,[s("span",null,o(h.value.message),1),h.value.status==="completed"?(d(),w(k,{key:0,type:"success",size:"small"},{default:a(()=>[...e[23]||(e[23]=[u("完成",-1)])]),_:1})):h.value.status==="failed"?(d(),w(k,{key:1,type:"danger",size:"small"},{default:a(()=>[...e[24]||(e[24]=[u("失败",-1)])]),_:1})):(d(),w(k,{key:2,type:"info",size:"small"},{default:a(()=>[u(o(h.value.progress)+"%",1)]),_:1}))]),l(ie,{percentage:h.value.progress,status:h.value.status==="completed"?"success":h.value.status==="failed"?"exception":"","stroke-width":10,style:{"margin-top":"8px"}},null,8,["percentage","status"]),h.value.status==="completed"?(d(),x("div",Nt,[s("p",null,"应用 "+o(h.value.applied_count)+" 条修改，跳过 "+o(h.value.skipped_count)+" 条",1),le.value?(d(),x("p",zt,"添加 "+o(h.value.comments_added)+" 条批注",1)):S("",!0)])):S("",!0),h.value.status==="failed"?(d(),x("div",Ot,[l(f,{title:h.value.error||"导出失败",type:"error","show-icon":"",closable:!1},null,8,["title"])])):S("",!0)])):S("",!0)]))]}),_:1},8,["modelValue"]),l(me,{gutter:16,class:"stat-cards"},{default:a(()=>[l(G,{span:6},{default:a(()=>[l(J,{class:"stat-card danger"},{default:a(()=>[s("div",$t,o(O.value.total_risks),1),s("div",jt,o(n.value.labels.totalRisks),1),s("div",Bt,o(n.value.labels.highDetail)+" "+o(O.value.high_risks)+" / "+o(n.value.labels.mediumDetail)+" "+o(O.value.medium_risks)+" / "+o(n.value.labels.lowDetail)+" "+o(O.value.low_risks),1)]),_:1})]),_:1}),l(G,{span:6},{default:a(()=>[l(J,{class:"stat-card warning"},{default:a(()=>[s("div",Ft,o(O.value.high_risks),1),s("div",qt,o(n.value.labels.highRisks),1),s("div",Wt,o(n.value.labels.priorityNeeded),1)]),_:1})]),_:1}),l(G,{span:6},{default:a(()=>[l(J,{class:"stat-card primary"},{default:a(()=>[s("div",Jt,o(O.value.total_modifications),1),s("div",Gt,o(n.value.labels.modifications),1),s("div",Qt,o(n.value.labels.mustModify)+" "+o(O.value.must_modify)+" / "+o(n.value.labels.shouldModify)+" "+o(O.value.should_modify),1)]),_:1})]),_:1}),l(G,{span:6},{default:a(()=>[l(J,{class:"stat-card success"},{default:a(()=>[s("div",Zt,o(O.value.total_actions),1),s("div",Kt,o(n.value.labels.actions),1),s("div",Xt,o(n.value.labels.immediateActions)+" "+o(O.value.immediate_actions),1)]),_:1})]),_:1})]),_:1}),l(J,{class:"content-card"},{default:a(()=>[l(rt,{modelValue:ke.value,"onUpdate:modelValue":e[3]||(e[3]=i=>ke.value=i)},{default:a(()=>[l(he,{label:n.value.labels.risks,name:"risks"},{label:a(()=>{var i,g;return[s("span",null,[u(o(n.value.labels.risks)+" ",1),l(A,{value:((g=(i=b.value)==null?void 0:i.risks)==null?void 0:g.length)||0,type:"danger"},null,8,["value"])])]}),default:a(()=>{var i;return[l(Ce,{data:((i=b.value)==null?void 0:i.risks)||[],stripe:"",border:""},{default:a(()=>[l(P,{label:n.value.labels.riskLevelCol,width:"100",align:"center"},{default:a(({row:g})=>[l(k,{type:qe(g.risk_level)},{default:a(()=>[u(o(We(g.risk_level)),1)]),_:2},1032,["type"])]),_:1},8,["label"]),l(P,{prop:"risk_type",label:n.value.labels.riskType,width:"120"},null,8,["label"]),l(P,{prop:"description",label:n.value.labels.riskDescription,"min-width":"200"},null,8,["label"]),l(P,{prop:"reason",label:n.value.labels.reason,"min-width":"200"},null,8,["label"]),l(P,{label:n.value.labels.originalText,width:"200"},{default:a(({row:g})=>{var H;return[(H=g.location)!=null&&H.original_text?(d(),w(it,{key:0,trigger:"hover",width:"400",placement:"top"},{reference:a(()=>[s("span",Yt,o(g.location.original_text.slice(0,50))+"... ",1)]),default:a(()=>[s("div",null,o(g.location.original_text),1)]),_:2},1024)):(d(),x("span",el,"-"))]}),_:1},8,["label"])]),_:1},8,["data"])]}),_:1},8,["label"]),l(he,{label:n.value.labels.modifications,name:"modifications"},{label:a(()=>{var i,g;return[s("span",null,[u(o(n.value.labels.modifications)+" ",1),l(A,{value:((g=(i=b.value)==null?void 0:i.modifications)==null?void 0:g.length)||0,type:"primary"},null,8,["value"])])]}),default:a(()=>{var i,g,H;return[s("div",tl,[(d(!0),x(_e,null,Ie(((i=b.value)==null?void 0:i.modifications)||[],r=>(d(),w(J,{key:r.id,class:bt(["modification-card",{confirmed:r.user_confirmed}])},{default:a(()=>[s("div",ll,[l(k,{type:Je(r.priority)},{default:a(()=>[u(o(Ge(r.priority)),1)]),_:2},1032,["type"]),s("span",al,o(r.modification_reason),1),s("div",ol,[l(ut,{modelValue:U(r.id).showDiff,"onUpdate:modelValue":T=>U(r.id).showDiff=T,"active-text":n.value.labels.diff,"inactive-text":n.value.labels.fullText,size:"small",style:{"margin-right":"12px"}},null,8,["modelValue","onUpdate:modelValue","active-text","inactive-text"]),l(M,{modelValue:r.user_confirmed,"onUpdate:modelValue":T=>r.user_confirmed=T,onChange:T=>Ye(r,{user_confirmed:T})},{default:a(()=>[u(o(n.value.labels.confirmAdopt),1)]),_:1},8,["modelValue","onUpdate:modelValue","onChange"])])]),l(me,{gutter:20,class:"mod-content"},{default:a(()=>[l(G,{span:12},{default:a(()=>[s("div",sl,o(n.value.labels.currentText),1),U(r.id).showDiff?(d(),x("div",{key:0,class:"text-box diff-view",innerHTML:Te(r).originalHtml},null,8,nl)):(d(),x("div",il,o(r.original_text),1))]),_:2},1024),l(G,{span:12},{default:a(()=>[s("div",ul,[u(o(n.value.labels.suggestedText)+" ",1),U(r.id).isEditing?(d(),w(_,{key:1,type:"success",link:"",size:"small",onClick:T=>Xe(r)},{default:a(()=>[u(o(n.value.labels.save),1)]),_:1},8,["onClick"])):(d(),w(_,{key:0,type:"primary",link:"",size:"small",onClick:T=>U(r.id).isEditing=!0},{default:a(()=>[u(o(n.value.labels.edit),1)]),_:1},8,["onClick"]))]),U(r.id).showDiff&&!U(r.id).isEditing?(d(),x("div",{key:0,class:"text-box diff-view suggested",innerHTML:Te(r).modifiedHtml},null,8,rl)):U(r.id).isEditing?(d(),w(ve,{key:2,type:"textarea",rows:4,modelValue:U(r.id).editText,"onUpdate:modelValue":T=>U(r.id).editText=T},null,8,["modelValue","onUpdate:modelValue"])):(d(),x("div",dl,o(U(r.id).editText||r.suggested_text),1))]),_:2},1024)]),_:2},1024)]),_:2},1032,["class"]))),128)),(H=(g=b.value)==null?void 0:g.modifications)!=null&&H.length?S("",!0):(d(),w(Ve,{key:0,description:n.value.labels.noModifications},null,8,["description"]))])]}),_:1},8,["label"]),l(he,{label:n.value.labels.actions,name:"actions"},{label:a(()=>{var i,g;return[s("span",null,[u(o(n.value.labels.actions)+" ",1),l(A,{value:((g=(i=b.value)==null?void 0:i.actions)==null?void 0:g.length)||0,type:"success"},null,8,["value"])])]}),default:a(()=>{var i,g,H;return[l(Ce,{data:((i=b.value)==null?void 0:i.actions)||[],stripe:"",border:""},{default:a(()=>[l(P,{label:n.value.labels.urgencyCol,width:"100",align:"center"},{default:a(({row:r})=>[l(k,{type:Qe(r.urgency)},{default:a(()=>[u(o(Ze(r.urgency)),1)]),_:2},1032,["type"])]),_:1},8,["label"]),l(P,{prop:"action_type",label:n.value.labels.actionType,width:"120"},null,8,["label"]),l(P,{prop:"description",label:n.value.labels.specificAction,"min-width":"250"},null,8,["label"]),l(P,{prop:"responsible_party",label:n.value.labels.responsibleParty,width:"100"},null,8,["label"]),l(P,{prop:"deadline_suggestion",label:n.value.labels.deadline,width:"120"},{default:a(({row:r})=>[u(o(r.deadline_suggestion||"-"),1)]),_:1},8,["label"]),l(P,{label:n.value.labels.operation,width:"130",align:"center"},{default:a(({row:r})=>[l(M,{modelValue:r.user_confirmed,"onUpdate:modelValue":T=>r.user_confirmed=T,onChange:T=>et(r,T),style:{"margin-right":"8px"}},{default:a(()=>[u(o(n.value.labels.confirm),1)]),_:1},8,["modelValue","onUpdate:modelValue","onChange"]),l(_,{type:"primary",link:"",size:"small",onClick:T=>tt(r)},{default:a(()=>[u(o(n.value.labels.edit),1)]),_:1},8,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"]),(H=(g=b.value)==null?void 0:g.actions)!=null&&H.length?S("",!0):(d(),w(Ve,{key:0,description:n.value.labels.noActions},null,8,["description"]))]}),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1}),l(q,{modelValue:oe.value,"onUpdate:modelValue":e[10]||(e[10]=i=>oe.value=i),title:"编辑行动建议",width:"500px","close-on-click-modal":!1},{footer:a(()=>[l(_,{onClick:e[9]||(e[9]=i=>oe.value=!1)},{default:a(()=>[...e[28]||(e[28]=[u("取消",-1)])]),_:1}),l(_,{type:"primary",onClick:lt,loading:ye.value},{default:a(()=>[...e[29]||(e[29]=[u(" 保存 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(dt,{model:D.value,"label-width":"80px"},{default:a(()=>[l(ue,{label:"具体行动"},{default:a(()=>[l(ve,{modelValue:D.value.description,"onUpdate:modelValue":e[4]||(e[4]=i=>D.value.description=i),type:"textarea",rows:3,placeholder:"请输入具体行动描述"},null,8,["modelValue"])]),_:1}),l(ue,{label:"行动类型"},{default:a(()=>[l(De,{modelValue:D.value.action_type,"onUpdate:modelValue":e[5]||(e[5]=i=>D.value.action_type=i),style:{width:"100%"}},{default:a(()=>[l(Q,{label:"沟通协商",value:"沟通协商"}),l(Q,{label:"补充材料",value:"补充材料"}),l(Q,{label:"法务确认",value:"法务确认"}),l(Q,{label:"内部审批",value:"内部审批"}),l(Q,{label:"核实信息",value:"核实信息"})]),_:1},8,["modelValue"])]),_:1}),l(ue,{label:"紧急程度"},{default:a(()=>[l(De,{modelValue:D.value.urgency,"onUpdate:modelValue":e[6]||(e[6]=i=>D.value.urgency=i),style:{width:"100%"}},{default:a(()=>[l(Q,{label:"立即处理",value:"immediate"}),l(Q,{label:"尽快处理",value:"soon"}),l(Q,{label:"一般",value:"normal"})]),_:1},8,["modelValue"])]),_:1}),l(ue,{label:"负责方"},{default:a(()=>[l(ve,{modelValue:D.value.responsible_party,"onUpdate:modelValue":e[7]||(e[7]=i=>D.value.responsible_party=i),placeholder:"请输入负责方"},null,8,["modelValue"])]),_:1}),l(ue,{label:"建议时限"},{default:a(()=>[l(ve,{modelValue:D.value.deadline_suggestion,"onUpdate:modelValue":e[8]||(e[8]=i=>D.value.deadline_suggestion=i),placeholder:"如：签署前、3个工作日内"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])),[[ct,ge.value]])}}},vl=ft(cl,[["__scopeId","data-v-50921fd9"]]);export{vl as default};
