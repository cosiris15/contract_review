import{_ as Be,r as d,q as W,o as he,a as c,x as ze,c as V,b as r,g as l,G as I,f as o,y as ie,w as a,h as u,i as C,p as ue,s as de,d as k,e as L,H as X,U as $e,t as g,M as Ne,J as Y,l as re,z as Ee,a5 as qe,R as b,E as p,N as ve}from"./index-CQyTNtbu.js";const De={class:"business-view"},Te={class:"page-header"},Fe={class:"header-actions"},Me={class:"filter-row"},Ke={class:"lines-list"},Pe=["onClick"],Se={class:"line-icon"},Ae={class:"line-info"},Ie={class:"line-name"},Ge={class:"line-desc"},He={class:"line-meta"},Je={key:0,class:"meta-sep"},Re={key:1},je={class:"line-actions"},Oe={class:"detail-header"},Qe={class:"detail-title"},We={class:"detail-tags"},Xe={class:"info-grid"},Ye={class:"info-block"},Ze={class:"info-block-value"},el={class:"info-block stats"},ll={class:"stat-box"},tl={class:"stat-number"},al={class:"stat-box"},sl={class:"stat-number"},ol={class:"filter-row"},nl={class:"table-footer"},il={__name:"BusinessView",setup(ul){const Z=d([]),J=d(!1),N=d(""),G=d(""),i=d(null),x=d([]),R=d(!1),B=d(""),E=d(""),q=d(""),D=d([]),T=d(!1),F=d(!1),h=d(!1),n=d({name:"",description:"",industry:"",language:"zh-CN"}),m=d({category:"core_focus",item:"",description:"",priority:"medium"}),M=d(null),K=d(null),z=d(!1),j=d(!1),ee=W(()=>Z.value.filter(s=>!N.value||s.name.toLowerCase().includes(N.value.toLowerCase())||s.description&&s.description.toLowerCase().includes(N.value.toLowerCase()))),le=W(()=>x.value.filter(s=>{const e=!B.value||s.item.toLowerCase().includes(B.value.toLowerCase())||s.description.toLowerCase().includes(B.value.toLowerCase()),f=!E.value||s.category===E.value,v=!q.value||s.priority===q.value;return e&&f&&v})),pe=W(()=>{const s=new Set(x.value.map(e=>e.category));return Array.from(s)});async function P(){J.value=!0;try{const s={include_preset:!0};G.value&&(s.language=G.value);const e=await b.getBusinessLines(s);Z.value=e.data}catch(s){p.error("加载业务条线失败: "+s.message)}finally{J.value=!1}}async function me(){try{const s=await b.getBusinessCategories();D.value=s.data}catch(s){console.error("加载分类失败:",s),D.value=[{id:"core_focus",name:"核心关注点"},{id:"typical_risks",name:"典型风险"},{id:"compliance",name:"合规要求"},{id:"business_practices",name:"业务惯例"},{id:"negotiation_priorities",name:"谈判要点"}]}}async function te(s){i.value=s,R.value=!0;try{const e=await b.getBusinessLine(s.id);i.value=e.data,x.value=e.data.contexts||[]}catch(e){p.error("加载业务条线详情失败: "+e.message)}finally{R.value=!1}}function fe(){i.value=null,x.value=[],B.value="",E.value="",q.value=""}async function ce(){if(!n.value.name){p.warning("请输入业务条线名称");return}z.value=!0;try{await b.createBusinessLine(n.value),p.success("创建成功"),T.value=!1,se(),P()}catch(s){p.error("创建失败: "+s.message)}finally{z.value=!1}}function ae(s){M.value=s.id,n.value={name:s.name,description:s.description||"",industry:s.industry||"",language:s.language||"zh-CN"},F.value=!0}async function ye(){if(!n.value.name){p.warning("请输入业务条线名称");return}z.value=!0;try{await b.updateBusinessLine(M.value,{name:n.value.name,description:n.value.description,industry:n.value.industry}),p.success("保存成功"),F.value=!1,P(),i.value&&i.value.id===M.value&&(i.value.name=n.value.name,i.value.description=n.value.description,i.value.industry=n.value.industry),M.value=null}catch(s){p.error("保存失败: "+s.message)}finally{z.value=!1}}async function ge(s){try{await ve.confirm(`确定要删除业务条线「${s.name}」吗？这将同时删除所有相关的背景信息。`,"确认删除",{type:"warning"}),await b.deleteBusinessLine(s.id),p.success("删除成功"),P()}catch(e){e!=="cancel"&&p.error("删除失败: "+e.message)}}function se(){n.value={name:"",description:"",industry:"",language:"zh-CN"},M.value=null}function _e(s){K.value=s,m.value={category:s.category,item:s.item,description:s.description,priority:s.priority},h.value=!0}async function be(){if(!m.value.item||!m.value.description){p.warning("请填写必填字段");return}j.value=!0;try{K.value?(await b.updateBusinessContext(K.value.id,m.value),p.success("更新成功")):(await b.addBusinessContext(i.value.id,m.value),p.success("添加成功")),h.value=!1,oe();const s=await b.getBusinessLine(i.value.id);x.value=s.data.contexts||[],i.value.context_count=x.value.length}catch(s){p.error("保存失败: "+s.message)}finally{j.value=!1}}async function we(s){try{await ve.confirm(`确定要删除「${s.item}」吗？`,"确认删除",{type:"warning"}),await b.deleteBusinessContext(s.id),p.success("删除成功");const e=await b.getBusinessLine(i.value.id);x.value=e.data.contexts||[],i.value.context_count=x.value.length}catch(e){e!=="cancel"&&p.error("删除失败: "+e.message)}}function oe(){m.value={category:"core_focus",item:"",description:"",priority:"medium"},K.value=null}function Ve(s){const e=D.value.find(f=>f.id===s);return e?e.name:s}function Ce(s){return{core_focus:"primary",typical_risks:"danger",compliance:"warning",business_practices:"info",negotiation_priorities:"success"}[s]||""}function xe(s){return{high:"danger",medium:"warning",low:"info"}[s]||""}function ke(s){return{high:"高",medium:"中",low:"低"}[s]||s}return he(()=>{P(),me()}),(s,e)=>{const f=c("el-icon"),v=c("el-button"),w=c("el-input"),y=c("el-option"),$=c("el-select"),H=c("el-card"),Le=c("el-empty"),U=c("el-tag"),S=c("el-table-column"),Ue=c("el-table"),_=c("el-form-item"),O=c("el-form"),Q=c("el-dialog"),ne=ze("loading");return r(),V("div",De,[i.value?(r(),V(I,{key:1},[o("div",Oe,[l(v,{text:"",onClick:fe},{default:a(()=>[l(f,null,{default:a(()=>[l(C(qe))]),_:1}),e[32]||(e[32]=u(" 返回列表 ",-1))]),_:1}),o("div",Qe,[o("h2",null,g(i.value.name),1),o("div",We,[i.value.is_preset?(r(),k(U,{key:0,size:"small",type:"info"},{default:a(()=>[...e[33]||(e[33]=[u("系统预设",-1)])]),_:1})):L("",!0),i.value.language==="en"?(r(),k(U,{key:1,size:"small",type:"success"},{default:a(()=>[...e[34]||(e[34]=[u("EN",-1)])]),_:1})):L("",!0),i.value.industry?(r(),k(U,{key:2,size:"small"},{default:a(()=>[u(g(i.value.industry),1)]),_:1})):L("",!0)])]),l(v,{type:"primary",text:"",onClick:e[3]||(e[3]=t=>ae(i.value)),disabled:i.value.is_preset},{default:a(()=>[l(f,null,{default:a(()=>[l(C(re))]),_:1}),e[35]||(e[35]=u(" 编辑信息 ",-1))]),_:1},8,["disabled"])]),l(H,{class:"line-info-card"},{default:a(()=>[o("div",Xe,[o("div",Ye,[e[36]||(e[36]=o("div",{class:"info-block-label"},"业务描述",-1)),o("div",Ze,g(i.value.description||"暂无描述"),1)]),o("div",el,[o("div",ll,[o("div",tl,g(x.value.length),1),e[37]||(e[37]=o("div",{class:"stat-text"},"背景信息",-1))]),o("div",al,[o("div",sl,g(pe.value.length),1),e[38]||(e[38]=o("div",{class:"stat-text"},"分类",-1))])])])]),_:1}),l(H,{class:"filter-card"},{default:a(()=>[o("div",ol,[l(w,{modelValue:B.value,"onUpdate:modelValue":e[4]||(e[4]=t=>B.value=t),placeholder:"搜索背景信息...",clearable:"",style:{width:"300px"}},{prefix:a(()=>[l(f,null,{default:a(()=>[l(C(de))]),_:1})]),_:1},8,["modelValue"]),l($,{modelValue:E.value,"onUpdate:modelValue":e[5]||(e[5]=t=>E.value=t),placeholder:"选择分类",clearable:"",style:{width:"200px"}},{default:a(()=>[(r(!0),V(I,null,X(D.value,t=>(r(),k(y,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l($,{modelValue:q.value,"onUpdate:modelValue":e[6]||(e[6]=t=>q.value=t),placeholder:"重要程度",clearable:"",style:{width:"150px"}},{default:a(()=>[l(y,{label:"高",value:"high"}),l(y,{label:"中",value:"medium"}),l(y,{label:"低",value:"low"})]),_:1},8,["modelValue"]),l(v,{type:"primary",onClick:e[7]||(e[7]=t=>h.value=!0),disabled:i.value.is_preset},{default:a(()=>[l(f,null,{default:a(()=>[l(C(ue))]),_:1}),e[39]||(e[39]=u(" 添加背景信息 ",-1))]),_:1},8,["disabled"])])]),_:1}),l(H,{class:"table-card"},{default:a(()=>[ie((r(),k(Ue,{data:le.value,stripe:"",style:{width:"100%"}},{default:a(()=>[l(S,{label:"分类",width:"140"},{default:a(({row:t})=>[l(U,{type:Ce(t.category),size:"small"},{default:a(()=>[u(g(Ve(t.category)),1)]),_:2},1032,["type"])]),_:1}),l(S,{prop:"item",label:"要点","min-width":"180"}),l(S,{prop:"description",label:"详细说明","min-width":"280","show-overflow-tooltip":""}),l(S,{label:"重要程度",width:"100",align:"center"},{default:a(({row:t})=>[l(U,{type:xe(t.priority),size:"small"},{default:a(()=>[u(g(ke(t.priority)),1)]),_:2},1032,["type"])]),_:1}),l(S,{label:"操作",width:"150",fixed:"right"},{default:a(({row:t})=>[l(v,{type:"primary",text:"",size:"small",onClick:A=>_e(t),disabled:i.value.is_preset},{default:a(()=>[...e[40]||(e[40]=[u(" 编辑 ",-1)])]),_:1},8,["onClick","disabled"]),l(v,{type:"danger",text:"",size:"small",onClick:A=>we(t),disabled:i.value.is_preset},{default:a(()=>[...e[41]||(e[41]=[u(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[ne,R.value]]),o("div",nl,[o("span",null,"共 "+g(le.value.length)+" 条背景信息",1)])]),_:1})],64)):(r(),V(I,{key:0},[o("div",Te,[e[26]||(e[26]=o("div",{class:"header-left"},[o("h1",null,"业务条线管理"),o("p",{class:"subtitle"},"管理业务背景信息，在审阅时提供业务上下文")],-1)),o("div",Fe,[l(v,{type:"primary",onClick:e[0]||(e[0]=t=>T.value=!0)},{default:a(()=>[l(f,null,{default:a(()=>[l(C(ue))]),_:1}),e[25]||(e[25]=u(" 新建业务条线 ",-1))]),_:1})])]),l(H,{class:"filter-card"},{default:a(()=>[o("div",Me,[l(w,{modelValue:N.value,"onUpdate:modelValue":e[1]||(e[1]=t=>N.value=t),placeholder:"搜索业务条线...",clearable:"",style:{width:"300px"}},{prefix:a(()=>[l(f,null,{default:a(()=>[l(C(de))]),_:1})]),_:1},8,["modelValue"]),l($,{modelValue:G.value,"onUpdate:modelValue":e[2]||(e[2]=t=>G.value=t),placeholder:"语言",clearable:"",style:{width:"150px"},onChange:P},{default:a(()=>[l(y,{label:"中文",value:"zh-CN"}),l(y,{label:"English",value:"en"})]),_:1},8,["modelValue"])])]),_:1}),ie((r(),V("div",Ke,[ee.value.length===0?(r(),k(Le,{key:0,description:"暂无业务条线"})):L("",!0),(r(!0),V(I,null,X(ee.value,t=>(r(),V("div",{key:t.id,class:"line-card"},[o("div",{class:"line-card-main",onClick:A=>te(t)},[o("div",Se,[l(f,{size:24},{default:a(()=>[l(C($e))]),_:1})]),o("div",Ae,[o("div",Ie,[u(g(t.name)+" ",1),t.is_preset?(r(),k(U,{key:0,size:"small",type:"info"},{default:a(()=>[...e[27]||(e[27]=[u("系统预设",-1)])]),_:1})):L("",!0),t.language==="en"?(r(),k(U,{key:1,size:"small",type:"success"},{default:a(()=>[...e[28]||(e[28]=[u("EN",-1)])]),_:1})):L("",!0)]),o("div",Ge,g(t.description||"暂无描述"),1),o("div",He,[o("span",null,g(t.context_count)+" 条背景信息",1),t.industry?(r(),V("span",Je,"|")):L("",!0),t.industry?(r(),V("span",Re,g(t.industry),1)):L("",!0)])])],8,Pe),o("div",je,[l(v,{text:"",type:"primary",onClick:Y(A=>te(t),["stop"])},{default:a(()=>[l(f,null,{default:a(()=>[l(C(Ne))]),_:1}),e[29]||(e[29]=u(" 查看 ",-1))]),_:1},8,["onClick"]),l(v,{text:"",type:"primary",onClick:Y(A=>ae(t),["stop"]),disabled:t.is_preset},{default:a(()=>[l(f,null,{default:a(()=>[l(C(re))]),_:1}),e[30]||(e[30]=u(" 编辑 ",-1))]),_:1},8,["onClick","disabled"]),l(v,{text:"",type:"danger",onClick:Y(A=>ge(t),["stop"]),disabled:t.is_preset},{default:a(()=>[l(f,null,{default:a(()=>[l(C(Ee))]),_:1}),e[31]||(e[31]=u(" 删除 ",-1))]),_:1},8,["onClick","disabled"])])]))),128))])),[[ne,J.value]])],64)),l(Q,{modelValue:T.value,"onUpdate:modelValue":e[13]||(e[13]=t=>T.value=t),title:"创建业务条线",width:"500px",onClose:se},{footer:a(()=>[l(v,{onClick:e[12]||(e[12]=t=>T.value=!1)},{default:a(()=>[...e[42]||(e[42]=[u("取消",-1)])]),_:1}),l(v,{type:"primary",onClick:ce,loading:z.value},{default:a(()=>[...e[43]||(e[43]=[u(" 创建 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(O,{model:n.value,"label-width":"100px"},{default:a(()=>[l(_,{label:"条线名称",required:""},{default:a(()=>[l(w,{modelValue:n.value.name,"onUpdate:modelValue":e[8]||(e[8]=t=>n.value.name=t),placeholder:"如：科技业务线、电商平台业务线"},null,8,["modelValue"])]),_:1}),l(_,{label:"业务描述"},{default:a(()=>[l(w,{modelValue:n.value.description,"onUpdate:modelValue":e[9]||(e[9]=t=>n.value.description=t),type:"textarea",rows:3,placeholder:"描述该业务条线的主要特点和关注点"},null,8,["modelValue"])]),_:1}),l(_,{label:"所属行业"},{default:a(()=>[l(w,{modelValue:n.value.industry,"onUpdate:modelValue":e[10]||(e[10]=t=>n.value.industry=t),placeholder:"如：科技、电商、金融"},null,8,["modelValue"])]),_:1}),l(_,{label:"语言"},{default:a(()=>[l($,{modelValue:n.value.language,"onUpdate:modelValue":e[11]||(e[11]=t=>n.value.language=t),style:{width:"100%"}},{default:a(()=>[l(y,{label:"中文",value:"zh-CN"}),l(y,{label:"English",value:"en"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(Q,{modelValue:F.value,"onUpdate:modelValue":e[18]||(e[18]=t=>F.value=t),title:"编辑业务条线",width:"500px"},{footer:a(()=>[l(v,{onClick:e[17]||(e[17]=t=>F.value=!1)},{default:a(()=>[...e[44]||(e[44]=[u("取消",-1)])]),_:1}),l(v,{type:"primary",onClick:ye,loading:z.value},{default:a(()=>[...e[45]||(e[45]=[u(" 保存 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(O,{model:n.value,"label-width":"100px"},{default:a(()=>[l(_,{label:"条线名称",required:""},{default:a(()=>[l(w,{modelValue:n.value.name,"onUpdate:modelValue":e[14]||(e[14]=t=>n.value.name=t),placeholder:"如：科技业务线、电商平台业务线"},null,8,["modelValue"])]),_:1}),l(_,{label:"业务描述"},{default:a(()=>[l(w,{modelValue:n.value.description,"onUpdate:modelValue":e[15]||(e[15]=t=>n.value.description=t),type:"textarea",rows:3,placeholder:"描述该业务条线的主要特点和关注点"},null,8,["modelValue"])]),_:1}),l(_,{label:"所属行业"},{default:a(()=>[l(w,{modelValue:n.value.industry,"onUpdate:modelValue":e[16]||(e[16]=t=>n.value.industry=t),placeholder:"如：科技、电商、金融"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(Q,{modelValue:h.value,"onUpdate:modelValue":e[24]||(e[24]=t=>h.value=t),title:K.value?"编辑背景信息":"添加背景信息",width:"600px",onClose:oe},{footer:a(()=>[l(v,{onClick:e[23]||(e[23]=t=>h.value=!1)},{default:a(()=>[...e[46]||(e[46]=[u("取消",-1)])]),_:1}),l(v,{type:"primary",onClick:be,loading:j.value},{default:a(()=>[...e[47]||(e[47]=[u(" 保存 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(O,{model:m.value,"label-width":"100px"},{default:a(()=>[l(_,{label:"分类",required:""},{default:a(()=>[l($,{modelValue:m.value.category,"onUpdate:modelValue":e[19]||(e[19]=t=>m.value.category=t),style:{width:"100%"}},{default:a(()=>[(r(!0),V(I,null,X(D.value,t=>(r(),k(y,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(_,{label:"要点名称",required:""},{default:a(()=>[l(w,{modelValue:m.value.item,"onUpdate:modelValue":e[20]||(e[20]=t=>m.value.item=t),placeholder:"简要描述该要点"},null,8,["modelValue"])]),_:1}),l(_,{label:"详细说明",required:""},{default:a(()=>[l(w,{modelValue:m.value.description,"onUpdate:modelValue":e[21]||(e[21]=t=>m.value.description=t),type:"textarea",rows:4,placeholder:"详细描述该要点的具体内容和注意事项"},null,8,["modelValue"])]),_:1}),l(_,{label:"重要程度"},{default:a(()=>[l($,{modelValue:m.value.priority,"onUpdate:modelValue":e[22]||(e[22]=t=>m.value.priority=t),style:{width:"100%"}},{default:a(()=>[l(y,{label:"高",value:"high"}),l(y,{label:"中",value:"medium"}),l(y,{label:"低",value:"low"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},rl=Be(il,[["__scopeId","data-v-773f2a7b"]]);export{rl as default};
