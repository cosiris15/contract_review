import{_ as Ke,q as D,r as _,v as Ze,a as p,d as z,b as n,w as l,f as a,c,G as F,H as J,I as j,g as t,i as f,O as Oe,P as Qe,e as y,t as r,h as o,Q as el,u as tl,o as ll,R as Q,E as g,x as sl,T as We,C as Ge,S as al,J as nl,U as He,y as Je,B as me,V as ol,s as Xe,p as Ye,W as il,X as we,Y as rl}from"./index-CQyTNtbu.js";import{u as ul}from"./index-CIjsTOlM.js";const dl={class:"party-select-content"},cl={class:"party-list"},pl=["onClick"],vl={class:"party-radio"},ml={class:"party-info"},_l={class:"party-role"},fl={class:"party-name"},gl={key:0,class:"party-desc"},yl={class:"party-radio"},kl={class:"party-info"},wl={__name:"PartySelectDialog",props:{modelValue:{type:Boolean,default:!1},parties:{type:Array,default:()=>[]}},emits:["update:modelValue","confirm","cancel"],setup(_e,{emit:te}){const T=_e,u=te,W=D({get:()=>T.modelValue,set:B=>u("update:modelValue",B)}),m=_(0),V=_("");Ze(()=>T.modelValue,B=>{B&&(m.value=T.parties.length>0?0:-1,V.value="")});const M=D(()=>m.value===-1?V.value.trim().length>0:m.value>=0&&m.value<T.parties.length);function G(){let B="";if(m.value===-1)B=V.value.trim();else if(T.parties[m.value]){const x=T.parties[m.value];B=x.name!=="未指明"?x.name:x.role}u("confirm",B),W.value=!1}function O(){u("cancel"),W.value=!1}return(B,x)=>{const E=p("el-icon"),X=p("el-input"),b=p("el-button"),R=p("el-dialog");return n(),z(R,{modelValue:W.value,"onUpdate:modelValue":x[2]||(x[2]=$=>W.value=$),title:"选择您的身份",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{footer:l(()=>[t(b,{onClick:O},{default:l(()=>[...x[5]||(x[5]=[o("取消",-1)])]),_:1}),t(b,{type:"primary",disabled:!M.value,onClick:G},{default:l(()=>[...x[6]||(x[6]=[o(" 确认 ",-1)])]),_:1},8,["disabled"])]),default:l(()=>[a("div",dl,[x[4]||(x[4]=a("p",{class:"hint-text"}," 系统已识别出文档中的各方，请选择您代表的一方： ",-1)),a("div",cl,[(n(!0),c(F,null,J(_e.parties,($,N)=>(n(),c("div",{key:N,class:j(["party-item",{selected:m.value===N}]),onClick:Y=>m.value=N},[a("div",vl,[m.value===N?(n(),z(E,{key:0,color:"#409eff",size:20},{default:l(()=>[t(f(Oe))]),_:1})):(n(),z(E,{key:1,color:"#c0c4cc",size:20},{default:l(()=>[t(f(Qe))]),_:1}))]),a("div",ml,[a("div",_l,r($.role),1),a("div",fl,r($.name),1),$.description?(n(),c("div",gl,r($.description),1)):y("",!0)])],10,pl))),128))]),a("div",{class:j(["party-item manual-input",{selected:m.value===-1}]),onClick:x[1]||(x[1]=$=>m.value=-1)},[a("div",yl,[m.value===-1?(n(),z(E,{key:0,color:"#409eff",size:20},{default:l(()=>[t(f(Oe))]),_:1})):(n(),z(E,{key:1,color:"#c0c4cc",size:20},{default:l(()=>[t(f(Qe))]),_:1}))]),a("div",kl,[x[3]||(x[3]=a("div",{class:"party-role"},"其他（手动输入）",-1)),m.value===-1?(n(),z(X,{key:0,modelValue:V.value,"onUpdate:modelValue":x[0]||(x[0]=$=>V.value=$),placeholder:"请输入您的身份",size:"small",style:{"margin-top":"8px"}},null,8,["modelValue"])):y("",!0)])],2)])]),_:1},8,["modelValue"])}}},hl=Ke(wl,[["__scopeId","data-v-6f7e2add"]]),Cl={class:"review-view"},bl={key:0,class:"ai-processing-overlay"},xl={class:"ai-processing-card"},zl={class:"ai-icon-wrapper"},Rl={key:0,class:"operation-status-bar"},Sl={key:0,class:"quota-exceeded-alert"},Vl={class:"quota-icon"},$l={class:"quota-content"},Ll={class:"quota-actions"},Il={class:"card-header"},Tl={class:"upload-section"},Dl={key:0,class:"preprocessing-status"},Bl={key:1,class:"uploaded-file"},Ul={class:"uploaded-file-actions"},ql={key:2,class:"upload-placeholder"},Pl={key:0,class:"recognized-info"},Ml={key:1,class:"task-requirements-section"},El={class:"requirement-selection-entry"},Nl={key:0,class:"selected-standards-section"},Al={class:"selected-header"},Fl={class:"selected-tags"},jl={key:0,class:"more-count"},Ol={class:"special-content"},Ql={key:0,class:"special-mode-selection"},Wl={key:1,class:"special-footer"},Gl={key:2,class:"special-footer direct-mode"},Hl={key:1,class:"applied-standard"},Jl={key:2,class:"interactive-mode-hint"},Xl={key:0},Yl={class:"recommend-list"},Kl=["onClick"],Zl={class:"recommend-content"},es={class:"recommend-header"},ts={class:"recommend-title"},ls={class:"recommend-reason"},ss={class:"recommend-desc"},as={class:"library-selector"},ns={class:"selector-header"},os={key:0,class:"recommendation-section"},is={class:"recommendation-header"},rs={class:"recommendation-list"},us=["onClick"],ds={class:"rec-header"},cs={class:"rec-name"},ps={class:"rec-reason"},vs={class:"rec-meta"},ms={class:"collection-list"},_s=["onClick"],fs={class:"collection-card-header"},gs={class:"collection-info"},ys={class:"collection-name"},ks={class:"collection-meta"},ws={key:0,class:"collection-desc"},hs={key:1,class:"selection-summary"},Cs={class:"merge-preview"},bs={class:"merge-summary"},xs={class:"summary-stats"},zs={class:"merge-standards-list"},Rs={class:"standard-change-badge"},Ss={class:"standard-content"},Vs={class:"standard-header"},$s={class:"standard-category"},Ls={class:"standard-item"},Is={class:"standard-desc"},Ts={key:0,class:"change-reason"},Ds={class:"business-selector"},Bs={class:"selector-header"},Us={class:"business-line-list"},qs=["onClick"],Ps={class:"business-line-header"},Ms={class:"business-line-info"},Es={class:"business-line-name"},Ns={class:"business-line-meta"},As={key:0,class:"business-line-desc"},Fs={key:0,class:"selection-summary"},js={key:0,class:"waiting-state"},Os={key:1,class:"progress-state"},Qs={class:"progress-content"},Ws={class:"progress-info"},Gs={class:"progress-steps"},Hs={key:2,class:"completed-state"},Js={key:0},Xs={key:3,class:"failed-state"},Ys={__name:"ReviewView",setup(_e){const te=el(),T=tl(),u=ul();_(null);const W=_(null),m=_(te.params.taskId||null),V=D(()=>te.query.mode==="interactive"),M=_({name:"",our_party:"",material_type:"contract",language:"zh-CN"});_(null),_(0);const G=_(!1),O=_(!1),B=_([]),x=_(null),E=_(null),X=_([]),b=_(null),R=_([]),$=_(!1),N=_(""),Y=_(!1),le=_(!1),ie=_(!1),U=_(""),se=_("direct"),re=_(!1),ae=_(!1),q=_(null);_(!1);const fe=_(!1),he=_([]),et=_([]),ge=_(!1),K=_([]),Z=_(!1),ne=_(""),ee=_([]),ue=_(!1),A=_(null),P=_(null),tt=D(()=>A.value?ee.value.find(s=>s.id===A.value):null),ye=D(()=>P.value?ee.value.find(s=>s.id===P.value):null),Ce=D(()=>{if(!ne.value)return ee.value;const s=ne.value.toLowerCase();return ee.value.filter(e=>e.name.toLowerCase().includes(s)||e.description&&e.description.toLowerCase().includes(s)||e.industry&&e.industry.toLowerCase().includes(s))}),w=D(()=>u.currentTask),be=D(()=>{var s;return((s=w.value)==null?void 0:s.status)==="completed"}),lt=D(()=>{var s;return((s=w.value)==null?void 0:s.status)==="failed"}),st=D(()=>{var s;return m.value?V.value?(s=w.value)==null?void 0:s.document_filename:u.canStartReview:!1}),at=D(()=>({idle:"准备中",analyzing:"分析文档",generating:"生成建议",completed:"已完成"})[u.progress.stage]||"处理中"),nt=D(()=>{const s=u.progress.stage;return s==="idle"?0:s==="analyzing"?1:s==="generating"?2:s==="completed"?4:1});ll(async()=>{try{const s=await Q.getCollections();X.value=s.data.map(e=>({id:e.id,name:e.name,description:e.description,material_type:e.material_type,standard_count:e.standard_count,is_preset:e.is_preset,standards:[]}))}catch(s){console.error("加载标准集合失败:",s)}if(ze(),m.value)try{await u.loadTask(m.value),M.value={name:w.value.name,our_party:w.value.our_party,material_type:w.value.material_type},w.value.status==="reviewing"&&(u.isReviewing=!0,u.startPolling(m.value))}catch{g.error("加载任务失败"),T.push("/")}}),Ze(()=>te.params.taskId,async s=>{s&&s!==m.value&&(m.value=s,await u.loadTask(s))});async function ot(s){if(E.value=s.raw,!m.value)try{const e=await u.createTask({name:"正在分析...",our_party:"待确认",material_type:M.value.material_type||"contract",language:"zh-CN"});m.value=e.id;const k=V.value?"?mode=interactive":"";T.replace(`/review/${e.id}${k}`)}catch{g.error("创建任务失败"),E.value=null;return}try{await u.uploadDocument(m.value,s.raw)}catch(e){g.error(e.message||"上传失败"),E.value=null;return}await it()}async function it(){if(m.value){G.value=!0;try{const s=await Q.preprocessDocument(m.value);x.value=s.data,B.value=s.data.parties||[],B.value.length>0||g.warning("未能识别合同各方，请手动选择您的身份"),O.value=!0}catch(s){console.error("预处理失败:",s),g.warning("文档分析失败，请手动输入信息"),O.value=!0}finally{G.value=!1}}}async function rt(s){var d,v;if(!m.value)return;const e=((d=x.value)==null?void 0:d.suggested_name)||"未命名文档",k=((v=x.value)==null?void 0:v.language)||"zh-CN";try{await Q.updateTask(m.value,{name:e,our_party:s,language:k}),w.value&&(w.value.name=e,w.value.our_party=s,w.value.language=k),M.value.name=e,M.value.our_party=s,M.value.language=k,g.success("已确认您的身份"),E.value=null}catch(I){console.error("更新任务失败:",I),g.error("保存失败，请重试")}}function ut(){g.info("请选择您在合同中的身份以继续"),setTimeout(()=>{O.value=!0},500)}function dt(){w.value&&(w.value.document_filename=null,w.value.document_storage_name=null)}async function ct(){var s;if(!((s=w.value)!=null&&s.document_filename)){g.warning("请先上传文档");return}ge.value=!0;try{const e=u.documentText||`文档名称: ${w.value.document_filename}`,k=await Q.recommendCollections({document_text:e.slice(0,1e3),material_type:M.value.material_type});K.value=k.data||[],K.value.length===0?g.info("没有找到匹配的标准集合推荐"):g.success(`推荐了 ${K.value.length} 个标准集合`)}catch(e){console.error("获取推荐失败:",e),g.error("获取推荐失败: "+(e.message||"请重试"))}finally{ge.value=!1}}async function pt(s){let e=X.value.find(k=>k.id===s.collection_id);if(e){if(!e.standards||e.standards.length===0)try{const k=await Q.getCollection(e.id);e.standards=k.data.standards||[],e.standard_count=e.standards.length}catch(k){console.error("获取集合详情失败:",k),g.error("获取标准详情失败");return}b.value=e}}const xe=D(()=>{if(!N.value)return X.value;const s=N.value.toLowerCase();return X.value.filter(e=>e.name.toLowerCase().includes(s)||e.description&&e.description.toLowerCase().includes(s))});function vt(){b.value=null,$.value=!0}function mt(){$.value=!1,T.push({name:"standards"})}async function _t(s){var e;if(((e=b.value)==null?void 0:e.id)===s.id)b.value=null;else{if(!s.standards||s.standards.length===0)try{const k=await Q.getCollection(s.id);s.standards=k.data.standards||[],s.standard_count=s.standards.length}catch(k){console.error("获取集合详情失败:",k),g.error("获取标准详情失败");return}b.value=s}}async function ft(){if(!m.value){g.warning("请先上传文档");return}if(!b.value){g.warning("请先选择标准");return}R.value=b.value.standards.map(s=>({id:s.id,category:s.category,item:s.item,description:s.description,risk_level:s.risk_level,applicable_to:s.applicable_to||["contract"]})),$.value=!1,await gt(R.value)}async function gt(s){Y.value=!0;try{const e=["审核分类,审核要点,详细说明,风险等级,适用材料类型",...s.map(I=>`"${I.category}","${I.item}","${I.description}","${I.risk_level==="high"?"高":I.risk_level==="medium"?"中":"低"}","${(I.applicable_to||["contract"]).join(",")}"`)].join(`
`),k=new Blob([e],{type:"text/csv;charset=utf-8"}),d=b.value?`${b.value.name}.csv`:"selected_standards.csv",v=new File([k],d,{type:"text/csv"});await u.uploadStandard(m.value,v),g.success(`已应用 ${s.length} 条审核标准`)}catch(e){g.error("应用标准失败: "+e.message)}finally{Y.value=!1}}function yt(s){var e,k;if(s==="upload"){const d=(k=(e=W.value)==null?void 0:e.$el)==null?void 0:k.querySelector('input[type="file"]');d&&d.click()}else s==="ai"&&($.value=!1,T.push({name:"Standards",query:{action:"ai-create"}}))}async function kt(s){if(!m.value){g.warning("请先上传文档");return}try{await u.uploadStandard(m.value,s.raw),selectedPresetTemplate.value=null,R.value=[],g.success("审核标准上传成功")}catch(e){g.error(e.message||"上传失败")}}function wt(){b.value=null,R.value=[],U.value=""}async function ht(){if(!m.value){g.warning("请先完成配置");return}try{if(V.value){await Ct();return}const s=se.value==="direct"&&U.value.trim()?U.value.trim():null;await u.startReview(m.value,A.value,s)}catch(s){g.error(s.message||"启动审阅失败")}}async function Ct(){u.isReviewing=!0,u.progress={stage:"analyzing",percentage:10,message:"正在进行快速初审..."};try{await rl.startQuickReview(m.value,"deepseek"),bt()}catch(s){u.isReviewing=!1,u.progress={stage:"idle",percentage:0,message:""},g.error(s.message||"启动快速初审失败")}}async function bt(){const s=setInterval(async()=>{try{await u.loadTask(m.value);const e=w.value;if(e.status==="completed")clearInterval(s),u.isReviewing=!1,u.progress={stage:"completed",percentage:100,message:"快速初审完成"},setTimeout(()=>{T.push(`/interactive/${m.value}`)},1e3);else if(e.status==="failed")clearInterval(s),u.isReviewing=!1,u.progress={stage:"idle",percentage:0,message:""},g.error(e.message||"快速初审失败");else if(e.status==="reviewing"){const k=e.progress||50;u.progress={stage:"analyzing",percentage:k,message:e.message||"正在分析文档..."}}}catch(e){console.error("轮询状态失败:",e)}},2e3);setTimeout(()=>{clearInterval(s),u.isReviewing&&(u.isReviewing=!1,u.progress={stage:"idle",percentage:0,message:""},g.error("审阅超时，请重试"))},5*60*1e3)}async function ze(){ue.value=!0;try{const s=await Q.getBusinessLines({include_preset:!0});ee.value=s.data}catch(s){console.error("加载业务条线失败:",s)}finally{ue.value=!1}}function xt(){P.value=A.value,ne.value="",Z.value=!0,ee.value.length===0&&ze()}function zt(s){P.value===s.id?P.value=null:P.value=s.id}function Rt(){var s;A.value=P.value,Z.value=!1,A.value&&g.success(`已选择业务条线: ${(s=tt.value)==null?void 0:s.name}`)}function St(){A.value=null,P.value=null,Z.value=!1,g.info("已清除业务条线选择")}function Vt(){u.progress={stage:"idle",percentage:0,message:""},w.value&&(w.value.status="created")}function $t(){T.push(`/result/${m.value}`)}function Re(){u.operationState.lastError=null}function Lt(){window.location.href="mailto:support@example.com"}function Se(s){return{high:"danger",medium:"warning",low:"success"}[s]||"info"}function Ve(s){return{high:"高",medium:"中",low:"低"}[s]||s}function It(s){return{added:"success",modified:"warning",removed:"danger",unchanged:"info"}[s]||"info"}function Tt(s){return{added:"新增",modified:"修改",removed:"删除",unchanged:"未变"}[s]||s}async function Dt(){if(!R.value.length){g.warning("请先选择基础标准");return}if(!U.value.trim()){g.warning("请输入特殊要求");return}re.value=!0;try{const s=await Q.mergeSpecialRequirements({standards:R.value.map(e=>({category:e.category,item:e.item,description:e.description,risk_level:e.risk_level,applicable_to:e.applicable_to||["contract"]})),special_requirements:U.value.trim(),our_party:M.value.our_party,material_type:M.value.material_type});q.value=s.data,ae.value=!0}catch(s){g.error("整合失败: "+(s.message||"请重试"))}finally{re.value=!1}}function Bt(){ae.value=!1,q.value=null}function Ut(){q.value&&(R.value=q.value.merged_standards.filter(s=>s.change_type!=="removed").map(s=>({id:s.id,category:s.category,item:s.item,description:s.description,risk_level:s.risk_level,applicable_to:["contract"]})),ae.value=!1,q.value=null,g.success("已应用到本次审核"))}async function qt(){if(!m.value){g.warning("请先上传文档");return}if(!R.value.length){g.warning("请先选择标准");return}Y.value=!0;try{const s=["审核分类,审核要点,详细说明,风险等级,适用材料类型",...R.value.map(v=>`"${v.category}","${v.item}","${v.description}","${v.risk_level==="high"?"高":v.risk_level==="medium"?"中":"低"}","${(v.applicable_to||["contract"]).join(",")}"`)].join(`
`),e=new Blob([s],{type:"text/csv;charset=utf-8"}),k=b.value?`${b.value.name}.csv`:"selected_standards.csv",d=new File([e],k,{type:"text/csv"});await u.uploadStandard(m.value,d),le.value=!1,g.success("标准应用成功")}catch(s){g.error("应用标准失败: "+s.message)}finally{Y.value=!1}}return(s,e)=>{var Ae;const k=p("MagicStick"),d=p("el-icon"),v=p("el-button"),I=p("el-alert"),S=p("el-tag"),$e=p("Document"),Pt=p("DocumentChecked"),Le=p("UploadFilled"),Ie=p("el-upload"),de=p("el-descriptions-item"),Mt=p("el-descriptions"),Te=p("el-divider"),Et=p("List"),Nt=p("Collection"),De=p("Edit"),Be=p("ArrowDown"),ke=p("el-input"),Ue=p("el-radio"),At=p("el-radio-group"),Ft=p("el-collapse-transition"),jt=p("el-checkbox"),ce=p("el-empty"),oe=p("el-dialog"),qe=p("el-dropdown-item"),Ot=p("el-dropdown-menu"),Qt=p("el-dropdown"),pe=p("el-table-column"),Wt=p("el-table"),Gt=p("CirclePlus"),Ht=p("Remove"),Jt=p("Check"),Pe=p("router-link"),Me=p("el-card"),Ee=p("el-col"),Xt=p("el-progress"),ve=p("el-step"),Yt=p("el-steps"),Ne=p("el-result"),Kt=p("el-row"),Zt=sl("loading");return n(),c("div",Cl,[t(We,{name:"fade"},{default:l(()=>[re.value?(n(),c("div",bl,[a("div",xl,[a("div",zl,[t(d,{class:"ai-icon-spin",size:48},{default:l(()=>[t(k)]),_:1})]),e[17]||(e[17]=a("h3",{class:"ai-title"},"AI 正在整合特殊要求",-1)),e[18]||(e[18]=a("p",{class:"ai-desc"},"正在分析您的特殊要求，智能调整审核标准...",-1)),e[19]||(e[19]=a("div",{class:"ai-progress"},[a("div",{class:"ai-progress-bar"})],-1)),e[20]||(e[20]=a("p",{class:"ai-hint"},"预计需要 30-60 秒，请耐心等待",-1))])])):y("",!0)]),_:1}),t(We,{name:"fade"},{default:l(()=>[f(u).isOperationInProgress?(n(),c("div",Rl,[t(d,{class:"is-loading"},{default:l(()=>[t(f(Ge))]),_:1}),a("span",null,r(f(u).currentOperationMessage),1)])):y("",!0)]),_:1}),((Ae=f(u).operationError)==null?void 0:Ae.type)==="quota_exceeded"&&!f(u).isOperationInProgress?(n(),c("div",Sl,[a("div",Vl,[t(d,{size:32,color:"#E6A23C"},{default:l(()=>[t(f(al))]),_:1})]),a("div",$l,[e[23]||(e[23]=a("h4",null,"免费额度已用完",-1)),e[24]||(e[24]=a("p",null,"您的免费试用额度已全部使用完毕。如需继续使用，请联系我们获取更多额度。",-1)),a("div",Ll,[t(v,{type:"warning",onClick:Lt},{default:l(()=>[...e[21]||(e[21]=[o("联系我们",-1)])]),_:1}),t(v,{onClick:Re},{default:l(()=>[...e[22]||(e[22]=[o("我知道了",-1)])]),_:1})])])])):f(u).operationError&&!f(u).isOperationInProgress?(n(),z(I,{key:1,type:"error",title:f(u).operationError.message,description:f(u).operationError.detail,"show-icon":"",closable:"",class:"error-alert",onClose:Re},null,8,["title","description"])):y("",!0),t(Kt,{gutter:24},{default:l(()=>[t(Ee,{span:10},{default:l(()=>[t(Me,{class:"config-card"},{header:l(()=>[a("div",Il,[a("span",null,r(V.value?"深度交互审阅":"审阅配置"),1),V.value?(n(),z(S,{key:0,type:"success",size:"small",style:{"margin-left":"8px"}},{default:l(()=>[...e[25]||(e[25]=[o("交互模式",-1)])]),_:1})):y("",!0)])]),default:l(()=>{var H,Fe;return[a("div",Tl,[a("h4",null,[t(d,null,{default:l(()=>[t($e)]),_:1}),e[26]||(e[26]=o(" 上传待审阅文档 ",-1))]),t(Ie,{class:"upload-box",drag:"","auto-upload":!1,"show-file-list":!1,"on-change":ot,disabled:G.value,accept:".pdf,.jpg,.jpeg,.png,.webp,.docx,.xlsx,.md,.txt"},{default:l(()=>{var i;return[G.value?(n(),c("div",Dl,[t(d,{size:40,class:"is-loading"},{default:l(()=>[t(f(Ge))]),_:1}),e[27]||(e[27]=a("p",null,"正在分析文档...",-1)),e[28]||(e[28]=a("span",null,"识别合同各方和文档类型",-1))])):(i=w.value)!=null&&i.document_filename?(n(),c("div",Bl,[t(d,{size:40,color:"#67c23a"},{default:l(()=>[t(Pt)]),_:1}),a("span",null,r(w.value.document_filename),1),a("div",Ul,[t(v,{type:"primary",text:"",size:"small"},{default:l(()=>[...e[29]||(e[29]=[o("重新上传",-1)])]),_:1}),t(v,{type:"danger",text:"",size:"small",onClick:nl(dt,["stop"])},{default:l(()=>[...e[30]||(e[30]=[o("取消",-1)])]),_:1})])])):(n(),c("div",ql,[t(d,{size:40},{default:l(()=>[t(Le)]),_:1}),e[31]||(e[31]=a("p",null,"拖拽文件到此处或点击上传",-1)),e[32]||(e[32]=a("span",null,"支持 PDF、图片、Word、Excel、Markdown 格式",-1))]))]}),_:1},8,["disabled"]),(H=w.value)!=null&&H.our_party&&!G.value?(n(),c("div",Pl,[t(Mt,{column:2,size:"small",border:""},{default:l(()=>[t(de,{label:"任务名称"},{default:l(()=>[o(r(w.value.name||"未命名"),1)]),_:1}),t(de,{label:"我方身份"},{default:l(()=>[o(r(w.value.our_party),1)]),_:1}),t(de,{label:"材料类型"},{default:l(()=>[o(r(w.value.material_type==="contract"?"合同":"营销材料"),1)]),_:1}),t(de,{label:"审阅语言"},{default:l(()=>[o(r(w.value.language==="zh-CN"?"中文":"English"),1)]),_:1})]),_:1})])):y("",!0)]),V.value?y("",!0):(n(),z(Te,{key:0})),V.value?y("",!0):(n(),c("div",Ml,[a("h4",null,[t(d,null,{default:l(()=>[t(Et)]),_:1}),e[33]||(e[33]=o(" 任务要求 ",-1))]),a("div",El,[t(v,{type:"primary",onClick:vt},{default:l(()=>[t(d,null,{default:l(()=>[t(Nt)]),_:1}),e[34]||(e[34]=o(" 审阅标准 ",-1)),R.value.length?(n(),z(S,{key:0,size:"small",type:"success",class:"btn-tag"},{default:l(()=>[o(r(R.value.length),1)]),_:1})):y("",!0)]),_:1}),t(v,{onClick:xt},{default:l(()=>[t(d,null,{default:l(()=>[t(f(He))]),_:1}),e[36]||(e[36]=o(" 业务条线 ",-1)),A.value?(n(),z(S,{key:0,size:"small",type:"success",class:"btn-tag"},{default:l(()=>[...e[35]||(e[35]=[o(" 1 ",-1)])]),_:1})):y("",!0)]),_:1})]),t(Ie,{ref_key:"standardUploadRef",ref:W,"auto-upload":!1,"show-file-list":!1,"on-change":kt,accept:".xlsx,.xls,.csv,.docx,.md,.txt",style:{display:"none"}},null,512),R.value.length>0?(n(),c("div",Nl,[a("div",Al,[e[38]||(e[38]=a("span",{class:"selected-label"},"已选标准",-1)),t(S,{type:"success",size:"small"},{default:l(()=>[o(r(R.value.length)+" 条",1)]),_:1}),t(v,{text:"",type:"primary",size:"small",onClick:e[0]||(e[0]=i=>le.value=!0)},{default:l(()=>[...e[37]||(e[37]=[o(" 查看详情 ",-1)])]),_:1})]),a("div",Fl,[(n(!0),c(F,null,J(R.value.slice(0,6),i=>(n(),z(S,{key:i.id||i.item,size:"small",style:{margin:"2px"}},{default:l(()=>[o(r(i.item),1)]),_:2},1024))),128)),R.value.length>6?(n(),c("span",jl," +"+r(R.value.length-6)+" 条 ",1)):y("",!0)])])):y("",!0),a("div",{class:j(["special-requirements",{"has-content":U.value.trim()}])},[a("div",{class:"special-header",onClick:e[1]||(e[1]=i=>ie.value=!ie.value)},[t(d,null,{default:l(()=>[t(De)]),_:1}),e[39]||(e[39]=a("span",{class:"special-title"},"本次特殊要求",-1)),e[40]||(e[40]=a("span",{class:"special-priority-hint"},"优先级最高",-1)),t(d,{class:j(["expand-icon",{expanded:ie.value}])},{default:l(()=>[t(Be)]),_:1},8,["class"])]),t(Ft,null,{default:l(()=>[Je(a("div",Ol,[e[47]||(e[47]=a("p",{class:"special-desc"}," 输入本次项目的特殊审核要求。当与审阅标准或业务背景冲突时，以此处要求为准。 ",-1)),t(ke,{modelValue:U.value,"onUpdate:modelValue":e[2]||(e[2]=i=>U.value=i),type:"textarea",rows:5,autosize:{minRows:5,maxRows:10},placeholder:`例如：

• 本项目为政府采购，需特别关注合规要求

• 我方为乙方，重点关注付款条款和违约责任

• 涉及数据跨境，需审核数据安全条款`},null,8,["modelValue"]),U.value.trim()?(n(),c("div",Ql,[e[43]||(e[43]=a("span",{class:"mode-label"},"处理方式：",-1)),t(At,{modelValue:se.value,"onUpdate:modelValue":e[3]||(e[3]=i=>se.value=i),size:"small"},{default:l(()=>[t(Ue,{value:"direct"},{default:l(()=>[...e[41]||(e[41]=[a("span",{class:"mode-option"},[a("span",{class:"mode-name"},"直接应用"),a("span",{class:"mode-desc"},"审阅时自动参考，无需等待")],-1)])]),_:1}),t(Ue,{value:"merge"},{default:l(()=>[...e[42]||(e[42]=[a("span",{class:"mode-option"},[a("span",{class:"mode-name"},"修改标准"),a("span",{class:"mode-desc"},"先调整审核标准，可预览效果")],-1)])]),_:1})]),_:1},8,["modelValue"])])):y("",!0),U.value.trim()&&se.value==="merge"?(n(),c("div",Wl,[t(v,{type:"primary",size:"default",loading:re.value,disabled:!U.value.trim()||!R.value.length,onClick:Dt},{default:l(()=>[t(d,null,{default:l(()=>[t(k)]),_:1}),e[44]||(e[44]=o(" 开始修改标准 ",-1))]),_:1},8,["loading","disabled"]),e[45]||(e[45]=a("span",{class:"special-tip"},"AI 将根据特殊要求调整审核标准（约30-60秒）",-1))])):y("",!0),U.value.trim()&&se.value==="direct"?(n(),c("div",Gl,[t(d,{color:"#67c23a"},{default:l(()=>[t(f(me))]),_:1}),e[46]||(e[46]=a("span",{class:"direct-hint"},"开始审阅后，特殊要求将自动生效",-1))])):y("",!0)],512),[[ol,ie.value]])]),_:1})],2),(Fe=w.value)!=null&&Fe.standard_filename?(n(),c("div",Hl,[t(d,{color:"#67c23a"},{default:l(()=>[t(f(me))]),_:1}),a("span",null,"已应用: "+r(w.value.standard_filename),1),t(v,{text:"",type:"primary",size:"small",onClick:wt},{default:l(()=>[...e[48]||(e[48]=[o("重新选择",-1)])]),_:1})])):y("",!0)])),V.value?(n(),c("div",Jl,[t(I,{type:"success",closable:!1,"show-icon":""},{title:l(()=>[...e[49]||(e[49]=[o("深度交互审阅模式",-1)])]),default:l(()=>[...e[50]||(e[50]=[a("p",null,"AI 将自动分析文档，识别所有潜在风险点。",-1),a("p",null,"审阅完成后，您可以逐条与 AI 对话，打磨每个修改建议。",-1)])]),_:1})])):y("",!0),t(oe,{modelValue:fe.value,"onUpdate:modelValue":e[5]||(e[5]=i=>fe.value=i),title:"智能推荐标准",width:"700px"},{footer:l(()=>[t(v,{onClick:e[4]||(e[4]=i=>fe.value=!1)},{default:l(()=>[...e[52]||(e[52]=[o("取消",-1)])]),_:1}),t(v,{type:"primary",onClick:s.confirmRecommendation},{default:l(()=>[o(" 确认选择 ("+r(et.value.length)+") ",1)]),_:1},8,["onClick"])]),default:l(()=>[he.value.length?(n(),c("div",Xl,[t(I,{type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:l(()=>[...e[51]||(e[51]=[o(" 根据您上传的文档，推荐以下审核标准： ",-1)])]),_:1}),a("div",Yl,[(n(!0),c(F,null,J(he.value,i=>(n(),c("div",{key:i.standard_id,class:j(["recommend-item",{selected:s.isStandardSelected(i.standard_id)}]),onClick:C=>s.toggleStandard(i)},[t(jt,{"model-value":s.isStandardSelected(i.standard_id)},null,8,["model-value"]),a("div",Zl,[a("div",es,[a("span",ts,r(i.standard.item),1),t(S,{size:"small",type:s.getRelevanceType(i.relevance_score)},{default:l(()=>[o(" 相关度 "+r(Math.round(i.relevance_score*100))+"% ",1)]),_:2},1032,["type"])]),a("p",ls,r(i.match_reason),1),a("p",ss,r(i.standard.description),1)])],10,Kl))),128))])])):(n(),z(ce,{key:1,description:"暂无推荐结果"}))]),_:1},8,["modelValue"]),t(oe,{modelValue:$.value,"onUpdate:modelValue":e[9]||(e[9]=i=>$.value=i),title:"选择审核标准",width:"800px"},{footer:l(()=>[t(v,{onClick:e[8]||(e[8]=i=>$.value=!1)},{default:l(()=>[...e[61]||(e[61]=[o("取消",-1)])]),_:1}),t(v,{type:"primary",onClick:ft,disabled:!b.value},{default:l(()=>[...e[62]||(e[62]=[o(" 确认选择 ",-1)])]),_:1},8,["disabled"])]),default:l(()=>{var i;return[a("div",as,[a("div",ns,[t(ke,{modelValue:N.value,"onUpdate:modelValue":e[6]||(e[6]=C=>N.value=C),placeholder:"搜索标准...",clearable:"",style:{flex:"1"}},{prefix:l(()=>[t(d,null,{default:l(()=>[t(f(Xe))]),_:1})]),_:1},8,["modelValue"]),t(v,{type:"success",onClick:ct,loading:ge.value,disabled:!((i=w.value)!=null&&i.document_filename)},{default:l(()=>[t(d,null,{default:l(()=>[t(k)]),_:1}),e[53]||(e[53]=o(" 智能推荐 ",-1))]),_:1},8,["loading","disabled"]),t(Qt,{trigger:"click",onCommand:yt},{dropdown:l(()=>[t(Ot,null,{default:l(()=>[t(qe,{command:"upload"},{default:l(()=>[t(d,null,{default:l(()=>[t(Le)]),_:1}),e[55]||(e[55]=o(" 上传新标准 ",-1))]),_:1}),t(qe,{command:"ai"},{default:l(()=>[t(d,null,{default:l(()=>[t(k)]),_:1}),e[56]||(e[56]=o(" AI辅助制作 ",-1))]),_:1})]),_:1})]),default:l(()=>[t(v,{type:"primary"},{default:l(()=>[t(d,null,{default:l(()=>[t(f(Ye))]),_:1}),e[54]||(e[54]=o(" 新建标准 ",-1)),t(d,{class:"el-icon--right"},{default:l(()=>[t(Be)]),_:1})]),_:1})]),_:1})]),K.value.length>0?(n(),c("div",os,[a("div",is,[t(d,{color:"#67c23a"},{default:l(()=>[t(k)]),_:1}),e[58]||(e[58]=a("span",null,"智能推荐",-1)),t(v,{text:"",type:"info",size:"small",onClick:e[7]||(e[7]=C=>K.value=[])},{default:l(()=>[...e[57]||(e[57]=[o(" 清除推荐 ",-1)])]),_:1})]),a("div",rs,[(n(!0),c(F,null,J(K.value,C=>{var h;return n(),c("div",{key:C.collection_id,class:j(["recommendation-card",{selected:((h=b.value)==null?void 0:h.id)===C.collection_id}]),onClick:L=>pt(C)},[a("div",ds,[a("span",cs,r(C.collection_name),1),t(S,{type:"success",size:"small"},{default:l(()=>[o(" 相关度 "+r(Math.round(C.relevance_score*100))+"% ",1)]),_:2},1024)]),a("p",ps,r(C.match_reason),1),a("div",vs,[t(S,{size:"small",type:"info"},{default:l(()=>[o(r(C.standard_count)+" 条审核条目",1)]),_:2},1024)])],10,us)}),128))])])):y("",!0),a("div",ms,[(n(!0),c(F,null,J(xe.value,C=>{var h,L,je;return n(),c("div",{key:C.id,class:j(["collection-card-dialog",{selected:((h=b.value)==null?void 0:h.id)===C.id}]),onClick:Ks=>_t(C)},[a("div",fs,[t(d,{size:24,color:((L=b.value)==null?void 0:L.id)===C.id?"#409eff":"#909399"},{default:l(()=>[t(f(il))]),_:1},8,["color"]),a("div",gs,[a("span",ys,r(C.name),1),a("span",ks,[t(S,{size:"small",type:"info"},{default:l(()=>[o(r(C.standard_count)+" 条审核条目",1)]),_:2},1024),C.is_preset?(n(),z(S,{key:0,size:"small",type:"success"},{default:l(()=>[...e[59]||(e[59]=[o("预设",-1)])]),_:1})):y("",!0)])]),((je=b.value)==null?void 0:je.id)===C.id?(n(),z(d,{key:0,class:"check-icon",color:"#409eff"},{default:l(()=>[t(f(me))]),_:1})):y("",!0)]),C.description?(n(),c("p",ws,r(C.description),1)):y("",!0)],10,_s)}),128)),xe.value.length===0?(n(),z(ce,{key:0,description:"暂无标准"},{default:l(()=>[t(v,{type:"primary",onClick:mt},{default:l(()=>[...e[60]||(e[60]=[o(" 前往标准管理 ",-1)])]),_:1})]),_:1})):y("",!0)]),b.value?(n(),c("div",hs,[t(d,null,{default:l(()=>[t(f(we))]),_:1}),a("span",null,"已选择「"+r(b.value.name)+"」，共 "+r(b.value.standard_count)+" 条审核条目",1)])):y("",!0)])]}),_:1},8,["modelValue"]),t(oe,{modelValue:le.value,"onUpdate:modelValue":e[11]||(e[11]=i=>le.value=i),title:"已选审核标准",width:"750px"},{footer:l(()=>[t(v,{onClick:e[10]||(e[10]=i=>le.value=!1)},{default:l(()=>[...e[63]||(e[63]=[o("关闭",-1)])]),_:1}),t(v,{type:"primary",onClick:qt,loading:Y.value},{default:l(()=>[...e[64]||(e[64]=[o(" 应用标准 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(Wt,{data:R.value,"max-height":"450"},{default:l(()=>[t(pe,{prop:"category",label:"分类",width:"100"}),t(pe,{prop:"item",label:"审核要点",width:"150"}),t(pe,{prop:"description",label:"详细说明","show-overflow-tooltip":""}),t(pe,{label:"风险",width:"60",align:"center"},{default:l(({row:i})=>[t(S,{type:Se(i.risk_level),size:"small"},{default:l(()=>[o(r(Ve(i.risk_level)),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),t(oe,{modelValue:ae.value,"onUpdate:modelValue":e[12]||(e[12]=i=>ae.value=i),title:"标准整合预览",width:"850px","close-on-click-modal":!1},{footer:l(()=>[t(v,{onClick:Bt},{default:l(()=>[...e[65]||(e[65]=[o("取消，保留原标准",-1)])]),_:1}),t(v,{type:"primary",onClick:Ut},{default:l(()=>[...e[66]||(e[66]=[o(" 应用整合后的标准 ",-1)])]),_:1})]),default:l(()=>{var i,C;return[a("div",Cs,[a("div",bs,[t(I,{title:(i=q.value)==null?void 0:i.merge_notes,type:"info",closable:!1,"show-icon":""},null,8,["title"]),a("div",xs,[t(S,{type:"success"},{default:l(()=>{var h,L;return[t(d,null,{default:l(()=>[t(Gt)]),_:1}),o(" 新增 "+r(((L=(h=q.value)==null?void 0:h.summary)==null?void 0:L.added_count)||0)+" 条 ",1)]}),_:1}),t(S,{type:"warning"},{default:l(()=>{var h,L;return[t(d,null,{default:l(()=>[t(De)]),_:1}),o(" 修改 "+r(((L=(h=q.value)==null?void 0:h.summary)==null?void 0:L.modified_count)||0)+" 条 ",1)]}),_:1}),t(S,{type:"danger"},{default:l(()=>{var h,L;return[t(d,null,{default:l(()=>[t(Ht)]),_:1}),o(" 删除 "+r(((L=(h=q.value)==null?void 0:h.summary)==null?void 0:L.removed_count)||0)+" 条 ",1)]}),_:1}),t(S,{type:"info"},{default:l(()=>{var h,L;return[t(d,null,{default:l(()=>[t(Jt)]),_:1}),o(" 未变 "+r(((L=(h=q.value)==null?void 0:h.summary)==null?void 0:L.unchanged_count)||0)+" 条 ",1)]}),_:1})])]),a("div",zs,[(n(!0),c(F,null,J(((C=q.value)==null?void 0:C.merged_standards)||[],(h,L)=>(n(),c("div",{key:L,class:j(["merge-standard-item",h.change_type])},[a("div",Rs,[t(S,{type:It(h.change_type),size:"small"},{default:l(()=>[o(r(Tt(h.change_type)),1)]),_:2},1032,["type"])]),a("div",Ss,[a("div",Vs,[a("span",$s,r(h.category),1),a("span",Ls,r(h.item),1),t(S,{type:Se(h.risk_level),size:"small"},{default:l(()=>[o(r(Ve(h.risk_level)),1)]),_:2},1032,["type"])]),a("p",Is,r(h.description),1),h.change_reason?(n(),c("p",Ts,[t(d,null,{default:l(()=>[t(f(we))]),_:1}),o(" "+r(h.change_reason),1)])):y("",!0)])],2))),128))])])]}),_:1},8,["modelValue"]),t(oe,{modelValue:Z.value,"onUpdate:modelValue":e[15]||(e[15]=i=>Z.value=i),title:"选择业务条线",width:"800px"},{footer:l(()=>[t(v,{onClick:e[14]||(e[14]=i=>Z.value=!1)},{default:l(()=>[...e[71]||(e[71]=[o("取消",-1)])]),_:1}),A.value?(n(),z(v,{key:0,type:"danger",text:"",onClick:St},{default:l(()=>[...e[72]||(e[72]=[o(" 清除选择 ",-1)])]),_:1})):y("",!0),t(v,{type:"primary",onClick:Rt},{default:l(()=>[...e[73]||(e[73]=[o(" 确认选择 ",-1)])]),_:1})]),default:l(()=>[a("div",Ds,[a("div",Bs,[t(ke,{modelValue:ne.value,"onUpdate:modelValue":e[13]||(e[13]=i=>ne.value=i),placeholder:"搜索业务条线...",clearable:"",style:{flex:"1"}},{prefix:l(()=>[t(d,null,{default:l(()=>[t(f(Xe))]),_:1})]),_:1},8,["modelValue"]),t(Pe,{to:"/business"},{default:l(()=>[t(v,{type:"primary"},{default:l(()=>[t(d,null,{default:l(()=>[t(f(Ye))]),_:1}),e[67]||(e[67]=o(" 管理业务条线 ",-1))]),_:1})]),_:1})]),t(I,{type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"16px"}},{default:l(()=>[...e[68]||(e[68]=[o(" 选择业务条线后，审阅时将根据业务背景信息提供更有针对性的建议（可选） ",-1)])]),_:1}),Je((n(),c("div",Us,[(n(!0),c(F,null,J(Ce.value,i=>(n(),c("div",{key:i.id,class:j(["business-line-card",{selected:P.value===i.id}]),onClick:C=>zt(i)},[a("div",Ps,[t(d,{size:24,color:P.value===i.id?"#409eff":"#909399"},{default:l(()=>[t(f(He))]),_:1},8,["color"]),a("div",Ms,[a("span",Es,r(i.name),1),a("span",Ns,[t(S,{size:"small",type:"info"},{default:l(()=>[o(r(i.context_count)+" 条背景信息",1)]),_:2},1024),i.is_preset?(n(),z(S,{key:0,size:"small",type:"success"},{default:l(()=>[...e[69]||(e[69]=[o("预设",-1)])]),_:1})):y("",!0),i.industry?(n(),z(S,{key:1,size:"small"},{default:l(()=>[o(r(i.industry),1)]),_:2},1024)):y("",!0)])]),P.value===i.id?(n(),z(d,{key:0,class:"check-icon",color:"#409eff"},{default:l(()=>[t(f(me))]),_:1})):y("",!0)]),i.description?(n(),c("p",As,r(i.description),1)):y("",!0)],10,qs))),128)),Ce.value.length===0&&!ue.value?(n(),z(ce,{key:0,description:"暂无业务条线"},{default:l(()=>[t(Pe,{to:"/business"},{default:l(()=>[t(v,{type:"primary"},{default:l(()=>[...e[70]||(e[70]=[o("前往创建",-1)])]),_:1})]),_:1})]),_:1})):y("",!0)])),[[Zt,ue.value]]),ye.value?(n(),c("div",Fs,[t(d,null,{default:l(()=>[t(f(we))]),_:1}),a("span",null,"已选择「"+r(ye.value.name)+"」，共 "+r(ye.value.context_count)+" 条背景信息",1)])):y("",!0)])]),_:1},8,["modelValue"]),t(Te),t(v,{type:V.value?"success":"primary",size:"large",class:"start-btn",loading:f(u).isReviewing,disabled:!st.value,onClick:ht},{default:l(()=>[f(u).isReviewing?(n(),c(F,{key:0},[o(r(V.value?"快速初审中...":"审阅中..."),1)],64)):(n(),c(F,{key:1},[o(r(V.value?"开始快速初审":"开始审阅"),1)],64))]),_:1},8,["type","loading","disabled"])]}),_:1})]),_:1}),t(Ee,{span:14},{default:l(()=>[t(Me,{class:"progress-card"},{header:l(()=>[...e[74]||(e[74]=[a("div",{class:"card-header"},[a("span",null,"审阅进度")],-1)])]),default:l(()=>[!f(u).isReviewing&&!be.value?(n(),c("div",js,[t(ce,{description:"完成配置后点击开始审阅"},{image:l(()=>[t(d,{size:80,color:"#909399"},{default:l(()=>[t($e)]),_:1})]),_:1})])):f(u).isReviewing?(n(),c("div",Os,[a("div",Qs,[t(Xt,{type:"circle",percentage:f(u).progress.percentage,width:150,"stroke-width":10},null,8,["percentage"]),a("div",Ws,[a("h3",null,r(at.value),1),a("p",null,r(f(u).progress.message),1)])]),a("div",Gs,[t(Yt,{active:nt.value,"align-center":""},{default:l(()=>[t(ve,{title:"分析文档"}),t(ve,{title:"识别风险"}),t(ve,{title:"生成建议"}),t(ve,{title:"完成"})]),_:1},8,["active"])])])):be.value?(n(),c("div",Hs,[t(Ne,{icon:"success",title:"审阅完成"},{"sub-title":l(()=>[f(u).reviewResult?(n(),c("p",Js," 发现 "+r(f(u).reviewResult.summary.total_risks)+" 个风险点， 生成 "+r(f(u).reviewResult.summary.total_modifications)+" 条修改建议 ",1)):y("",!0)]),extra:l(()=>[t(v,{type:"primary",onClick:$t},{default:l(()=>[...e[75]||(e[75]=[o(" 查看完整结果 ",-1)])]),_:1})]),_:1})])):lt.value?(n(),c("div",Xs,[t(Ne,{icon:"error",title:"审阅失败"},{"sub-title":l(()=>{var H;return[a("p",null,r(((H=w.value)==null?void 0:H.message)||"发生未知错误"),1)]}),extra:l(()=>[t(v,{type:"primary",onClick:Vt},{default:l(()=>[...e[76]||(e[76]=[o("重试",-1)])]),_:1})]),_:1})])):y("",!0)]),_:1})]),_:1})]),_:1}),t(hl,{modelValue:O.value,"onUpdate:modelValue":e[16]||(e[16]=H=>O.value=H),parties:B.value,onConfirm:rt,onCancel:ut},null,8,["modelValue","parties"])])}}},ta=Ke(Ys,[["__scopeId","data-v-058cb123"]]);export{ta as default};
