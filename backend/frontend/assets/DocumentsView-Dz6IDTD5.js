import{_ as me,u as ge,r as m,n as h,q as he,o as ye,E as D,a as f,v as we,c as g,b as d,f as s,g as l,e as y,x as Ce,d as M,w as n,h as i,i as r,y as j,t as v,p as be,z as q,A as ke,B as xe,C as Te,s as Ve,D as ze,F as $e,G as De,H as Se,I as U,J as Ie,K as Le,L as Me,k as Ne,M as G}from"./index-BOoWkaEM.js";import{u as Ue}from"./index-DZX06AQ0.js";const Be={class:"documents-view"},Ee={class:"page-header"},Pe={class:"header-actions"},Fe={class:"stats-cards"},Re={class:"stat-card"},Ae={class:"stat-icon total"},Ke={class:"stat-info"},Oe={class:"stat-value"},je={class:"stat-card"},qe={class:"stat-icon completed"},Ge={class:"stat-info"},He={class:"stat-value completed"},Je={class:"stat-card"},Qe={class:"stat-icon in-progress"},We={class:"stat-info"},Xe={class:"stat-value in-progress"},Ye={class:"stat-card"},Ze={class:"stat-icon failed"},et={class:"stat-info"},tt={class:"stat-value failed"},lt={class:"filter-row"},at={key:0,class:"filter-results"},st={class:"documents-list"},nt={key:0,class:"select-all-row"},ot=["onClick"],ut={class:"document-icon"},it={class:"document-info"},dt={class:"document-name"},rt={class:"document-meta"},ct={key:0},vt={key:1,class:"meta-sep"},ft={class:"document-actions"},_t={key:1,class:"pagination-wrapper"},B=10,pt={__name:"DocumentsView",setup(mt){const N=ge(),w=Ue(),T=m(!1),_=m([]),V=m(""),C=m(""),b=m(""),k=m("created_at"),x=m("desc"),z=m(1),u=m([]);let E=null;const S=h(()=>{let t=[..._.value];if(V.value){const e=V.value.toLowerCase();t=t.filter(a=>(a.document_filename||"").toLowerCase().includes(e)||(a.name||"").toLowerCase().includes(e)||(a.our_party||"").toLowerCase().includes(e))}return C.value&&(t=t.filter(e=>e.status===C.value)),b.value&&(t=t.filter(e=>e.material_type===b.value)),t.sort((e,a)=>{let c,$;return k.value==="name"?(c=(e.document_filename||e.name||"").toLowerCase(),$=(a.document_filename||a.name||"").toLowerCase()):(c=new Date(e[k.value]||0).getTime(),$=new Date(a[k.value]||0).getTime()),x.value==="desc"?c>$?-1:1:c<$?-1:1}),t}),I=h(()=>{const t=(z.value-1)*B,e=t+B;return S.value.slice(t,e)}),H=h(()=>_.value.length),J=h(()=>_.value.filter(t=>t.status==="completed").length),Q=h(()=>_.value.filter(t=>t.status==="reviewing"||t.status==="created"||t.status==="uploading").length),W=h(()=>_.value.filter(t=>t.status==="failed").length),R=h({get:()=>{const t=I.value.map(e=>e.id);return t.length>0&&t.every(e=>u.value.includes(e))},set:()=>{}}),X=h(()=>{const t=I.value.map(a=>a.id),e=t.filter(a=>u.value.includes(a));return e.length>0&&e.length<t.length});he([C,b,k,x],()=>{z.value=1}),ye(async()=>{await Y()});async function Y(){var t;T.value=!0;try{await w.fetchTasks(),_.value=w.tasks}catch(e){D.error(((t=e.errorInfo)==null?void 0:t.message)||"获取任务列表失败")}finally{T.value=!1}}function Z(){E&&clearTimeout(E),E=setTimeout(()=>{z.value=1},300)}function ee(){x.value=x.value==="desc"?"asc":"desc"}function te(){V.value="",C.value="",b.value="",k.value="created_at",x.value="desc",z.value=1}function le(){window.scrollTo({top:0,behavior:"smooth"})}function ae(t,e){e?u.value.push(t):u.value=u.value.filter(a=>a!==t)}function se(t){const e=I.value.map(a=>a.id);t?e.forEach(a=>{u.value.includes(a)||u.value.push(a)}):u.value=u.value.filter(a=>!e.includes(a))}async function ne(){try{await G.confirm(`确定要删除选中的 ${u.value.length} 个文档吗？此操作不可恢复。`,"批量删除",{type:"warning"}),T.value=!0;let t=0,e=0;for(const a of u.value)try{await w.deleteTask(a),t++}catch{e++}_.value=w.tasks,u.value=[],e===0?D.success(`成功删除 ${t} 个文档`):D.warning(`删除完成：成功 ${t} 个，失败 ${e} 个`)}catch(t){t!=="cancel"&&D.error("删除失败")}finally{T.value=!1}}async function oe(t){try{await G.confirm(`确定要删除 "${t.document_filename||t.name}" 吗？`,"确认删除",{type:"warning"}),await w.deleteTask(t.id),_.value=w.tasks,u.value=u.value.filter(e=>e!==t.id),D.success("删除成功")}catch(e){e!=="cancel"&&D.error("删除失败")}}function A(){w.resetState(),N.push("/review")}function K(t){t.status==="completed"?N.push(`/interactive/${t.id}`):N.push(`/review/${t.id}`)}function ue(t){N.push(`/interactive/${t.id}`)}function ie(t){return{created:"info",uploading:"info",reviewing:"warning",completed:"success",failed:"danger"}[t]||"info"}function de(t){return{created:"已创建",uploading:"上传中",reviewing:"审阅中",completed:"已完成",failed:"失败"}[t]||t}function re(t){return t==="contract"?"合同":"营销材料"}function ce(t){return t?new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):""}return(t,e)=>{const a=f("el-icon"),c=f("el-button"),$=f("el-input"),p=f("el-option"),P=f("el-select"),ve=f("el-card"),O=f("el-checkbox"),fe=f("el-empty"),F=f("el-tag"),_e=f("el-pagination"),pe=we("loading");return d(),g("div",Be,[s("div",Ee,[e[8]||(e[8]=s("div",{class:"header-left"},[s("h1",null,"文档管理"),s("p",{class:"subtitle"},"管理所有审阅任务和文档")],-1)),s("div",Pe,[u.value.length>0?(d(),M(c,{key:0,type:"danger",onClick:ne},{default:n(()=>[l(a,null,{default:n(()=>[l(r(j))]),_:1}),i(" 删除选中 ("+v(u.value.length)+") ",1)]),_:1})):y("",!0),l(c,{type:"primary",onClick:A},{default:n(()=>[l(a,null,{default:n(()=>[l(r(be))]),_:1}),e[7]||(e[7]=i(" 新建审阅任务 ",-1))]),_:1})])]),s("div",Fe,[s("div",Re,[s("div",Ae,[l(a,{size:24},{default:n(()=>[l(r(q))]),_:1})]),s("div",Ke,[s("div",Oe,v(H.value),1),e[9]||(e[9]=s("div",{class:"stat-label"},"文档总数",-1))])]),s("div",je,[s("div",qe,[l(a,{size:24},{default:n(()=>[l(r(ke))]),_:1})]),s("div",Ge,[s("div",He,v(J.value),1),e[10]||(e[10]=s("div",{class:"stat-label"},"已完成",-1))])]),s("div",Je,[s("div",Qe,[l(a,{size:24},{default:n(()=>[l(r(xe))]),_:1})]),s("div",We,[s("div",Xe,v(Q.value),1),e[11]||(e[11]=s("div",{class:"stat-label"},"进行中",-1))])]),s("div",Ye,[s("div",Ze,[l(a,{size:24},{default:n(()=>[l(r(Te))]),_:1})]),s("div",et,[s("div",tt,v(W.value),1),e[12]||(e[12]=s("div",{class:"stat-label"},"失败",-1))])])]),l(ve,{class:"filter-card"},{default:n(()=>[s("div",lt,[l($,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=o=>V.value=o),placeholder:"搜索文档名称、我方身份...",clearable:"",style:{width:"280px"},onInput:Z},{prefix:n(()=>[l(a,null,{default:n(()=>[l(r(Ve))]),_:1})]),_:1},8,["modelValue"]),l(P,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=o=>C.value=o),placeholder:"状态",clearable:"",style:{width:"130px"}},{default:n(()=>[l(p,{label:"已创建",value:"created"}),l(p,{label:"审阅中",value:"reviewing"}),l(p,{label:"已完成",value:"completed"}),l(p,{label:"失败",value:"failed"})]),_:1},8,["modelValue"]),l(P,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=o=>b.value=o),placeholder:"材料类型",clearable:"",style:{width:"130px"}},{default:n(()=>[l(p,{label:"合同",value:"contract"}),l(p,{label:"营销材料",value:"marketing"})]),_:1},8,["modelValue"]),l(P,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=o=>k.value=o),placeholder:"排序",style:{width:"140px"}},{default:n(()=>[l(p,{label:"创建时间",value:"created_at"}),l(p,{label:"更新时间",value:"updated_at"}),l(p,{label:"文档名称",value:"name"})]),_:1},8,["modelValue"]),l(c,{icon:x.value==="desc"?"SortDown":"SortUp",onClick:ee},{default:n(()=>[i(v(x.value==="desc"?"降序":"升序"),1)]),_:1},8,["icon"]),l(c,{text:"",onClick:te},{default:n(()=>[l(a,null,{default:n(()=>[l(r(ze))]),_:1}),e[13]||(e[13]=i(" 重置 ",-1))]),_:1})])]),_:1}),_.value.length>0&&(V.value||C.value||b.value)?(d(),g("div",at,[s("span",null,"筛选结果：共 "+v(S.value.length)+" 个文档",1)])):y("",!0),Ce((d(),g("div",st,[I.value.length>0?(d(),g("div",nt,[l(O,{modelValue:R.value,"onUpdate:modelValue":e[4]||(e[4]=o=>R.value=o),indeterminate:X.value,onChange:se},{default:n(()=>[...e[14]||(e[14]=[i(" 全选当前页 ",-1)])]),_:1},8,["modelValue","indeterminate"])])):y("",!0),S.value.length===0&&!T.value?(d(),M(fe,{key:1,description:"暂无文档"},{default:n(()=>[l(c,{type:"primary",onClick:A},{default:n(()=>[...e[15]||(e[15]=[i("创建第一个任务",-1)])]),_:1})]),_:1})):y("",!0),(d(!0),g($e,null,De(I.value,o=>(d(),g("div",{key:o.id,class:Se(["document-card",{selected:u.value.includes(o.id)}])},[l(O,{"model-value":u.value.includes(o.id),onChange:L=>ae(o.id,L),class:"document-checkbox",onClick:e[5]||(e[5]=U(()=>{},["stop"]))},null,8,["model-value","onChange"]),s("div",{class:"document-card-main",onClick:L=>K(o)},[s("div",ut,[l(a,{size:24},{default:n(()=>[l(r(q))]),_:1})]),s("div",it,[s("div",dt,[i(v(o.document_filename||o.name)+" ",1),l(F,{type:ie(o.status),size:"small"},{default:n(()=>[i(v(de(o.status)),1)]),_:2},1032,["type"]),l(F,{type:"info",size:"small"},{default:n(()=>[i(v(re(o.material_type)),1)]),_:2},1024)]),s("div",rt,[o.our_party?(d(),g("span",ct,[l(a,null,{default:n(()=>[l(r(Ie))]),_:1}),i(" "+v(o.our_party),1)])):y("",!0),e[17]||(e[17]=s("span",{class:"meta-sep"},"|",-1)),s("span",null,[l(a,null,{default:n(()=>[l(r(Le))]),_:1}),i(" "+v(ce(o.created_at)),1)]),o.language==="en"?(d(),g("span",vt,"|")):y("",!0),o.language==="en"?(d(),M(F,{key:2,size:"small",type:"success"},{default:n(()=>[...e[16]||(e[16]=[i("EN",-1)])]),_:1})):y("",!0)])])],8,ot),s("div",ft,[o.status==="completed"?(d(),M(c,{key:0,text:"",type:"primary",onClick:U(L=>ue(o),["stop"])},{default:n(()=>[l(a,null,{default:n(()=>[l(r(Me))]),_:1}),e[18]||(e[18]=i(" 查看结果 ",-1))]),_:1},8,["onClick"])):(d(),M(c,{key:1,text:"",type:"primary",onClick:U(L=>K(o),["stop"])},{default:n(()=>[l(a,null,{default:n(()=>[l(r(Ne))]),_:1}),e[19]||(e[19]=i(" 继续审阅 ",-1))]),_:1},8,["onClick"])),l(c,{text:"",type:"danger",onClick:U(L=>oe(o),["stop"])},{default:n(()=>[l(a,null,{default:n(()=>[l(r(j))]),_:1}),e[20]||(e[20]=i(" 删除 ",-1))]),_:1},8,["onClick"])])],2))),128))])),[[pe,T.value]]),S.value.length>B?(d(),g("div",_t,[l(_e,{"current-page":z.value,"onUpdate:currentPage":e[6]||(e[6]=o=>z.value=o),"page-size":B,total:S.value.length,layout:"prev, pager, next, jumper",onCurrentChange:le},null,8,["current-page","total"])])):y("",!0)])}}},yt=me(pt,[["__scopeId","data-v-9f51f526"]]);export{yt as default};
