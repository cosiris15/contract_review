import{_ as Ee,r as d,q as W,o as Be,c as w,a as r,f as l,N as S,e as o,y as ne,w as a,g as u,k as Ue,i as V,p as ie,E as he,F as ze,s as ue,G as $e,H as Ne,J as Te,K as Fe,b as x,d as k,M as qe,O as j,af as De,t as y,R as Ie,U as Ke,Q as X,l as de,z as Me,aG as Pe,al as Se,am as Ae,aA as Ge,aB as Oe,a3 as He,a5 as _,x as m,W as re}from"./index-PX0bYf_H.js";/* empty css                 *//* empty css                  *//* empty css                     *//* empty css                *//* empty css                  */const Je={class:"business-view"},Qe={class:"page-header"},Re={class:"header-actions"},We={class:"filter-row"},je={class:"lines-list"},Xe=["onClick"],Ye={class:"line-icon"},Ze={class:"line-info"},el={class:"line-name"},ll={class:"line-desc"},tl={class:"line-meta"},al={key:0,class:"meta-sep"},sl={key:1},ol={class:"line-actions"},nl={class:"detail-header"},il={class:"detail-title"},ul={class:"detail-tags"},dl={class:"info-grid"},rl={class:"info-block"},vl={class:"info-block-value"},ml={class:"info-block stats"},pl={class:"stat-box"},fl={class:"stat-number"},cl={class:"stat-box"},yl={class:"stat-number"},gl={class:"filter-row"},_l={class:"table-footer"},bl={__name:"BusinessView",setup(wl){const Y=d([]),O=d(!1),z=d(""),A=d(""),i=d(null),C=d([]),H=d(!1),E=d(""),$=d(""),N=d(""),T=d([]),F=d(!1),q=d(!1),B=d(!1),n=d({name:"",description:"",industry:"",language:"zh-CN"}),p=d({category:"core_focus",item:"",description:"",priority:"medium"}),D=d(null),I=d(null),U=d(!1),J=d(!1),Z=W(()=>Y.value.filter(s=>!z.value||s.name.toLowerCase().includes(z.value.toLowerCase())||s.description&&s.description.toLowerCase().includes(z.value.toLowerCase()))),ee=W(()=>C.value.filter(s=>{const e=!E.value||s.item.toLowerCase().includes(E.value.toLowerCase())||s.description.toLowerCase().includes(E.value.toLowerCase()),f=!$.value||s.category===$.value,v=!N.value||s.priority===N.value;return e&&f&&v})),ve=W(()=>{const s=new Set(C.value.map(e=>e.category));return Array.from(s)});async function K(){O.value=!0;try{const s={include_preset:!0};A.value&&(s.language=A.value);const e=await _.getBusinessLines(s);Y.value=e.data}catch(s){m.error("加载业务条线失败: "+s.message)}finally{O.value=!1}}async function me(){try{const s=await _.getBusinessCategories();T.value=s.data}catch(s){console.error("加载分类失败:",s),T.value=[{id:"core_focus",name:"核心关注点"},{id:"typical_risks",name:"典型风险"},{id:"compliance",name:"合规要求"},{id:"business_practices",name:"业务惯例"},{id:"negotiation_priorities",name:"谈判要点"}]}}async function le(s){i.value=s,H.value=!0;try{const e=await _.getBusinessLine(s.id);i.value=e.data,C.value=e.data.contexts||[]}catch(e){m.error("加载业务条线详情失败: "+e.message)}finally{H.value=!1}}function pe(){i.value=null,C.value=[],E.value="",$.value="",N.value=""}async function fe(){if(!n.value.name){m.warning("请输入业务条线名称");return}U.value=!0;try{await _.createBusinessLine(n.value),m.success("创建成功"),F.value=!1,ae(),K()}catch(s){m.error("创建失败: "+s.message)}finally{U.value=!1}}function te(s){D.value=s.id,n.value={name:s.name,description:s.description||"",industry:s.industry||"",language:s.language||"zh-CN"},q.value=!0}async function ce(){if(!n.value.name){m.warning("请输入业务条线名称");return}U.value=!0;try{await _.updateBusinessLine(D.value,{name:n.value.name,description:n.value.description,industry:n.value.industry}),m.success("保存成功"),q.value=!1,K(),i.value&&i.value.id===D.value&&(i.value.name=n.value.name,i.value.description=n.value.description,i.value.industry=n.value.industry),D.value=null}catch(s){m.error("保存失败: "+s.message)}finally{U.value=!1}}async function ye(s){try{await re.confirm(`确定要删除业务条线「${s.name}」吗？这将同时删除所有相关的背景信息。`,"确认删除",{type:"warning"}),await _.deleteBusinessLine(s.id),m.success("删除成功"),K()}catch(e){e!=="cancel"&&m.error("删除失败: "+e.message)}}function ae(){n.value={name:"",description:"",industry:"",language:"zh-CN"},D.value=null}function ge(s){I.value=s,p.value={category:s.category,item:s.item,description:s.description,priority:s.priority},B.value=!0}async function _e(){if(!p.value.item||!p.value.description){m.warning("请填写必填字段");return}J.value=!0;try{I.value?(await _.updateBusinessContext(I.value.id,p.value),m.success("更新成功")):(await _.addBusinessContext(i.value.id,p.value),m.success("添加成功")),B.value=!1,se();const s=await _.getBusinessLine(i.value.id);C.value=s.data.contexts||[],i.value.context_count=C.value.length}catch(s){m.error("保存失败: "+s.message)}finally{J.value=!1}}async function be(s){try{await re.confirm(`确定要删除「${s.item}」吗？`,"确认删除",{type:"warning"}),await _.deleteBusinessContext(s.id),m.success("删除成功");const e=await _.getBusinessLine(i.value.id);C.value=e.data.contexts||[],i.value.context_count=C.value.length}catch(e){e!=="cancel"&&m.error("删除失败: "+e.message)}}function se(){p.value={category:"core_focus",item:"",description:"",priority:"medium"},I.value=null}function we(s){const e=T.value.find(f=>f.id===s);return e?e.name:s}function Ve(s){return{core_focus:"primary",typical_risks:"danger",compliance:"warning",business_practices:"info",negotiation_priorities:"success"}[s]||""}function Ce(s){return{high:"danger",medium:"warning",low:"info"}[s]||""}function xe(s){return{high:"高",medium:"中",low:"低"}[s]||s}return Be(()=>{K(),me()}),(s,e)=>{const f=Ue,v=he,b=ze,c=Ne,h=$e,G=Te,ke=qe,L=Ie,M=Ae,Le=Se,g=Oe,Q=Ge,R=He,oe=Fe;return r(),w("div",Je,[i.value?(r(),w(S,{key:1},[o("div",nl,[l(v,{text:"",onClick:pe},{default:a(()=>[l(f,null,{default:a(()=>[l(V(Pe))]),_:1}),e[32]||(e[32]=u(" 返回列表 ",-1))]),_:1}),o("div",il,[o("h2",null,y(i.value.name),1),o("div",ul,[i.value.is_preset?(r(),x(L,{key:0,size:"small",type:"info"},{default:a(()=>[...e[33]||(e[33]=[u("系统预设",-1)])]),_:1})):k("",!0),i.value.language==="en"?(r(),x(L,{key:1,size:"small",type:"success"},{default:a(()=>[...e[34]||(e[34]=[u("EN",-1)])]),_:1})):k("",!0),i.value.industry?(r(),x(L,{key:2,size:"small"},{default:a(()=>[u(y(i.value.industry),1)]),_:1})):k("",!0)])]),l(v,{type:"primary",text:"",onClick:e[3]||(e[3]=t=>te(i.value)),disabled:i.value.is_preset},{default:a(()=>[l(f,null,{default:a(()=>[l(V(de))]),_:1}),e[35]||(e[35]=u(" 编辑信息 ",-1))]),_:1},8,["disabled"])]),l(G,{class:"line-info-card"},{default:a(()=>[o("div",dl,[o("div",rl,[e[36]||(e[36]=o("div",{class:"info-block-label"},"业务描述",-1)),o("div",vl,y(i.value.description||"暂无描述"),1)]),o("div",ml,[o("div",pl,[o("div",fl,y(C.value.length),1),e[37]||(e[37]=o("div",{class:"stat-text"},"背景信息",-1))]),o("div",cl,[o("div",yl,y(ve.value.length),1),e[38]||(e[38]=o("div",{class:"stat-text"},"分类",-1))])])])]),_:1}),l(G,{class:"filter-card"},{default:a(()=>[o("div",gl,[l(b,{modelValue:E.value,"onUpdate:modelValue":e[4]||(e[4]=t=>E.value=t),placeholder:"搜索背景信息...",clearable:"",style:{width:"300px"}},{prefix:a(()=>[l(f,null,{default:a(()=>[l(V(ue))]),_:1})]),_:1},8,["modelValue"]),l(h,{modelValue:$.value,"onUpdate:modelValue":e[5]||(e[5]=t=>$.value=t),placeholder:"选择分类",clearable:"",style:{width:"200px"}},{default:a(()=>[(r(!0),w(S,null,j(T.value,t=>(r(),x(c,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(h,{modelValue:N.value,"onUpdate:modelValue":e[6]||(e[6]=t=>N.value=t),placeholder:"重要程度",clearable:"",style:{width:"150px"}},{default:a(()=>[l(c,{label:"高",value:"high"}),l(c,{label:"中",value:"medium"}),l(c,{label:"低",value:"low"})]),_:1},8,["modelValue"]),l(v,{type:"primary",onClick:e[7]||(e[7]=t=>B.value=!0),disabled:i.value.is_preset},{default:a(()=>[l(f,null,{default:a(()=>[l(V(ie))]),_:1}),e[39]||(e[39]=u(" 添加背景信息 ",-1))]),_:1},8,["disabled"])])]),_:1}),l(G,{class:"table-card"},{default:a(()=>[ne((r(),x(Le,{data:ee.value,stripe:"",style:{width:"100%"}},{default:a(()=>[l(M,{label:"分类",width:"140"},{default:a(({row:t})=>[l(L,{type:Ve(t.category),size:"small"},{default:a(()=>[u(y(we(t.category)),1)]),_:2},1032,["type"])]),_:1}),l(M,{prop:"item",label:"要点","min-width":"180"}),l(M,{prop:"description",label:"详细说明","min-width":"280","show-overflow-tooltip":""}),l(M,{label:"重要程度",width:"100",align:"center"},{default:a(({row:t})=>[l(L,{type:Ce(t.priority),size:"small"},{default:a(()=>[u(y(xe(t.priority)),1)]),_:2},1032,["type"])]),_:1}),l(M,{label:"操作",width:"150",fixed:"right"},{default:a(({row:t})=>[l(v,{type:"primary",text:"",size:"small",onClick:P=>ge(t),disabled:i.value.is_preset},{default:a(()=>[...e[40]||(e[40]=[u(" 编辑 ",-1)])]),_:1},8,["onClick","disabled"]),l(v,{type:"danger",text:"",size:"small",onClick:P=>be(t),disabled:i.value.is_preset},{default:a(()=>[...e[41]||(e[41]=[u(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[oe,H.value]]),o("div",_l,[o("span",null,"共 "+y(ee.value.length)+" 条背景信息",1)])]),_:1})],64)):(r(),w(S,{key:0},[o("div",Qe,[e[26]||(e[26]=o("div",{class:"header-left"},[o("h1",null,"业务条线管理"),o("p",{class:"subtitle"},"管理业务背景信息，在审阅时提供业务上下文")],-1)),o("div",Re,[l(v,{type:"primary",onClick:e[0]||(e[0]=t=>F.value=!0)},{default:a(()=>[l(f,null,{default:a(()=>[l(V(ie))]),_:1}),e[25]||(e[25]=u(" 新建业务条线 ",-1))]),_:1})])]),l(G,{class:"filter-card"},{default:a(()=>[o("div",We,[l(b,{modelValue:z.value,"onUpdate:modelValue":e[1]||(e[1]=t=>z.value=t),placeholder:"搜索业务条线...",clearable:"",style:{width:"300px"}},{prefix:a(()=>[l(f,null,{default:a(()=>[l(V(ue))]),_:1})]),_:1},8,["modelValue"]),l(h,{modelValue:A.value,"onUpdate:modelValue":e[2]||(e[2]=t=>A.value=t),placeholder:"语言",clearable:"",style:{width:"150px"},onChange:K},{default:a(()=>[l(c,{label:"中文",value:"zh-CN"}),l(c,{label:"English",value:"en"})]),_:1},8,["modelValue"])])]),_:1}),ne((r(),w("div",je,[Z.value.length===0?(r(),x(ke,{key:0,description:"暂无业务条线"})):k("",!0),(r(!0),w(S,null,j(Z.value,t=>(r(),w("div",{key:t.id,class:"line-card"},[o("div",{class:"line-card-main",onClick:P=>le(t)},[o("div",Ye,[l(f,{size:24},{default:a(()=>[l(V(De))]),_:1})]),o("div",Ze,[o("div",el,[u(y(t.name)+" ",1),t.is_preset?(r(),x(L,{key:0,size:"small",type:"info"},{default:a(()=>[...e[27]||(e[27]=[u("系统预设",-1)])]),_:1})):k("",!0),t.language==="en"?(r(),x(L,{key:1,size:"small",type:"success"},{default:a(()=>[...e[28]||(e[28]=[u("EN",-1)])]),_:1})):k("",!0)]),o("div",ll,y(t.description||"暂无描述"),1),o("div",tl,[o("span",null,y(t.context_count)+" 条背景信息",1),t.industry?(r(),w("span",al,"|")):k("",!0),t.industry?(r(),w("span",sl,y(t.industry),1)):k("",!0)])])],8,Xe),o("div",ol,[l(v,{text:"",type:"primary",onClick:X(P=>le(t),["stop"])},{default:a(()=>[l(f,null,{default:a(()=>[l(V(Ke))]),_:1}),e[29]||(e[29]=u(" 查看 ",-1))]),_:1},8,["onClick"]),l(v,{text:"",type:"primary",onClick:X(P=>te(t),["stop"]),disabled:t.is_preset},{default:a(()=>[l(f,null,{default:a(()=>[l(V(de))]),_:1}),e[30]||(e[30]=u(" 编辑 ",-1))]),_:1},8,["onClick","disabled"]),l(v,{text:"",type:"danger",onClick:X(P=>ye(t),["stop"]),disabled:t.is_preset},{default:a(()=>[l(f,null,{default:a(()=>[l(V(Me))]),_:1}),e[31]||(e[31]=u(" 删除 ",-1))]),_:1},8,["onClick","disabled"])])]))),128))])),[[oe,O.value]])],64)),l(R,{modelValue:F.value,"onUpdate:modelValue":e[13]||(e[13]=t=>F.value=t),title:"创建业务条线",width:"500px",onClose:ae},{footer:a(()=>[l(v,{onClick:e[12]||(e[12]=t=>F.value=!1)},{default:a(()=>[...e[42]||(e[42]=[u("取消",-1)])]),_:1}),l(v,{type:"primary",onClick:fe,loading:U.value},{default:a(()=>[...e[43]||(e[43]=[u(" 创建 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(Q,{model:n.value,"label-width":"100px"},{default:a(()=>[l(g,{label:"条线名称",required:""},{default:a(()=>[l(b,{modelValue:n.value.name,"onUpdate:modelValue":e[8]||(e[8]=t=>n.value.name=t),placeholder:"如：科技业务线、电商平台业务线"},null,8,["modelValue"])]),_:1}),l(g,{label:"业务描述"},{default:a(()=>[l(b,{modelValue:n.value.description,"onUpdate:modelValue":e[9]||(e[9]=t=>n.value.description=t),type:"textarea",rows:3,placeholder:"描述该业务条线的主要特点和关注点"},null,8,["modelValue"])]),_:1}),l(g,{label:"所属行业"},{default:a(()=>[l(b,{modelValue:n.value.industry,"onUpdate:modelValue":e[10]||(e[10]=t=>n.value.industry=t),placeholder:"如：科技、电商、金融"},null,8,["modelValue"])]),_:1}),l(g,{label:"语言"},{default:a(()=>[l(h,{modelValue:n.value.language,"onUpdate:modelValue":e[11]||(e[11]=t=>n.value.language=t),style:{width:"100%"}},{default:a(()=>[l(c,{label:"中文",value:"zh-CN"}),l(c,{label:"English",value:"en"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(R,{modelValue:q.value,"onUpdate:modelValue":e[18]||(e[18]=t=>q.value=t),title:"编辑业务条线",width:"500px"},{footer:a(()=>[l(v,{onClick:e[17]||(e[17]=t=>q.value=!1)},{default:a(()=>[...e[44]||(e[44]=[u("取消",-1)])]),_:1}),l(v,{type:"primary",onClick:ce,loading:U.value},{default:a(()=>[...e[45]||(e[45]=[u(" 保存 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(Q,{model:n.value,"label-width":"100px"},{default:a(()=>[l(g,{label:"条线名称",required:""},{default:a(()=>[l(b,{modelValue:n.value.name,"onUpdate:modelValue":e[14]||(e[14]=t=>n.value.name=t),placeholder:"如：科技业务线、电商平台业务线"},null,8,["modelValue"])]),_:1}),l(g,{label:"业务描述"},{default:a(()=>[l(b,{modelValue:n.value.description,"onUpdate:modelValue":e[15]||(e[15]=t=>n.value.description=t),type:"textarea",rows:3,placeholder:"描述该业务条线的主要特点和关注点"},null,8,["modelValue"])]),_:1}),l(g,{label:"所属行业"},{default:a(()=>[l(b,{modelValue:n.value.industry,"onUpdate:modelValue":e[16]||(e[16]=t=>n.value.industry=t),placeholder:"如：科技、电商、金融"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(R,{modelValue:B.value,"onUpdate:modelValue":e[24]||(e[24]=t=>B.value=t),title:I.value?"编辑背景信息":"添加背景信息",width:"600px",onClose:se},{footer:a(()=>[l(v,{onClick:e[23]||(e[23]=t=>B.value=!1)},{default:a(()=>[...e[46]||(e[46]=[u("取消",-1)])]),_:1}),l(v,{type:"primary",onClick:_e,loading:J.value},{default:a(()=>[...e[47]||(e[47]=[u(" 保存 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[l(Q,{model:p.value,"label-width":"100px"},{default:a(()=>[l(g,{label:"分类",required:""},{default:a(()=>[l(h,{modelValue:p.value.category,"onUpdate:modelValue":e[19]||(e[19]=t=>p.value.category=t),style:{width:"100%"}},{default:a(()=>[(r(!0),w(S,null,j(T.value,t=>(r(),x(c,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(g,{label:"要点名称",required:""},{default:a(()=>[l(b,{modelValue:p.value.item,"onUpdate:modelValue":e[20]||(e[20]=t=>p.value.item=t),placeholder:"简要描述该要点"},null,8,["modelValue"])]),_:1}),l(g,{label:"详细说明",required:""},{default:a(()=>[l(b,{modelValue:p.value.description,"onUpdate:modelValue":e[21]||(e[21]=t=>p.value.description=t),type:"textarea",rows:4,placeholder:"详细描述该要点的具体内容和注意事项"},null,8,["modelValue"])]),_:1}),l(g,{label:"重要程度"},{default:a(()=>[l(h,{modelValue:p.value.priority,"onUpdate:modelValue":e[22]||(e[22]=t=>p.value.priority=t),style:{width:"100%"}},{default:a(()=>[l(c,{label:"高",value:"high"}),l(c,{label:"中",value:"medium"}),l(c,{label:"低",value:"low"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Bl=Ee(bl,[["__scopeId","data-v-773f2a7b"]]);export{Bl as default};
