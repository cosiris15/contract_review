import{_ as st,n as U,r as _,q as nt,N as Qe,a as m,d as $,b as n,w as a,f as s,c as d,e as k,F as N,G as Y,H as B,g as t,i as g,O as Ye,P as Ze,t as c,Q as na,R as oa,x as Ce,S as ze,h as i,T as ia,u as ra,o as ua,U as j,E as h,v as da,V as Je,B as Ke,W as ca,I as pa,X as va,Y as et,A as we,s as tt,p as at,Z as ma,$ as he,a0 as lt}from"./index-BOoWkaEM.js";import{u as fa}from"./index-DZX06AQ0.js";const _a={class:"party-select-content"},ga={key:0,class:"hint-text"},ya={key:1,class:"hint-text"},ka={key:2,class:"party-list"},wa=["onClick"],ha={class:"party-radio"},Ca={class:"party-info"},ba={class:"party-role"},Sa={class:"party-name"},xa={key:0,class:"party-desc"},Ra={key:0,class:"party-radio"},$a={key:0,class:"party-role"},za={key:3,class:"preview-section"},Va={class:"preview-content"},Ia={__name:"PartySelectDialog",props:{modelValue:{type:Boolean,default:!1},parties:{type:Array,default:()=>[]},documentPreview:{type:String,default:""}},emits:["update:modelValue","confirm","cancel"],setup(D,{emit:pe}){const V=D,r=pe,W=U({get:()=>V.modelValue,set:I=>r("update:modelValue",I)}),v=_(0),L=_(""),M=_(!1),F=_(null);nt(()=>V.modelValue,I=>{I&&(V.parties.length>0?v.value=0:(v.value=-1,Qe(()=>{var f;(f=F.value)==null||f.focus()})),L.value="",M.value=!1)});const se=U(()=>v.value===-1?L.value.trim().length>0:v.value>=0&&v.value<V.parties.length);function ne(){v.value=-1,Qe(()=>{var I;(I=F.value)==null||I.focus()})}function oe(){let I="";if(v.value===-1)I=L.value.trim();else if(V.parties[v.value]){const f=V.parties[v.value];I=f.name!=="未指明"?f.name:f.role}r("confirm",I),W.value=!1}function Z(){r("cancel"),W.value=!1}return(I,f)=>{const b=m("el-icon"),O=m("el-input"),J=m("el-collapse-transition"),X=m("el-button"),G=m("el-dialog");return n(),$(G,{modelValue:W.value,"onUpdate:modelValue":f[3]||(f[3]=T=>W.value=T),title:"选择您的身份",width:"600px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{footer:a(()=>[t(X,{onClick:Z},{default:a(()=>[...f[5]||(f[5]=[i("取消",-1)])]),_:1}),t(X,{type:"primary",disabled:!se.value,onClick:oe},{default:a(()=>[...f[6]||(f[6]=[i(" 确认 ",-1)])]),_:1},8,["disabled"])]),default:a(()=>[s("div",_a,[D.parties.length>0?(n(),d("p",ga," 系统已识别出文档中的各方，请选择您代表的一方： ")):(n(),d("p",ya," 未能自动识别合同各方，请手动输入您的身份（如：甲方、买方、XX公司）： ")),D.parties.length>0?(n(),d("div",ka,[(n(!0),d(N,null,Y(D.parties,(T,H)=>(n(),d("div",{key:H,class:B(["party-item",{selected:v.value===H}]),onClick:ie=>v.value=H},[s("div",ha,[v.value===H?(n(),$(b,{key:0,color:"#409eff",size:20},{default:a(()=>[t(g(Ye))]),_:1})):(n(),$(b,{key:1,color:"#c0c4cc",size:20},{default:a(()=>[t(g(Ze))]),_:1}))]),s("div",Ca,[s("div",ba,c(T.role),1),s("div",Sa,c(T.name),1),T.description?(n(),d("div",xa,c(T.description),1)):k("",!0)])],10,wa))),128))])):k("",!0),s("div",{class:B(["party-item manual-input",{selected:v.value===-1,"no-parties":D.parties.length===0}]),onClick:ne},[D.parties.length>0?(n(),d("div",Ra,[v.value===-1?(n(),$(b,{key:0,color:"#409eff",size:20},{default:a(()=>[t(g(Ye))]),_:1})):(n(),$(b,{key:1,color:"#c0c4cc",size:20},{default:a(()=>[t(g(Ze))]),_:1}))])):k("",!0),s("div",{class:B(["party-info",{"full-width":D.parties.length===0}])},[D.parties.length>0?(n(),d("div",$a,"其他（手动输入）")):k("",!0),t(O,{ref_key:"customInputRef",ref:F,modelValue:L.value,"onUpdate:modelValue":f[0]||(f[0]=T=>L.value=T),placeholder:D.parties.length>0?"请输入您的身份":"例如：甲方、买方、XX科技有限公司",size:"default",style:na({marginTop:D.parties.length>0?"8px":"0"}),onFocus:f[1]||(f[1]=T=>v.value=-1)},null,8,["modelValue","placeholder","style"])],2)],2),D.documentPreview?(n(),d("div",za,[s("div",{class:"preview-header",onClick:f[2]||(f[2]=T=>M.value=!M.value)},[t(b,{class:B({"is-rotated":M.value})},{default:a(()=>[t(g(oa))]),_:1},8,["class"]),f[4]||(f[4]=s("span",null,"查看文档开头内容",-1))]),t(J,null,{default:a(()=>[Ce(s("div",Va,[s("pre",null,c(D.documentPreview),1)],512),[[ze,M.value]])]),_:1})])):k("",!0)])]),_:1},8,["modelValue"])}}},Ta=st(Ia,[["__scopeId","data-v-3ae6a332"]]),La={class:"review-view"},Pa={key:0,class:"ai-processing-overlay"},Da={class:"ai-processing-card"},Ua={class:"ai-icon-wrapper"},Ba={key:0,class:"operation-status-bar"},Ma={key:0,class:"quota-exceeded-alert"},qa={class:"quota-icon"},Ea={class:"quota-content"},Aa={class:"quota-actions"},Na={class:"upload-section"},Fa={key:0,class:"preprocessing-status"},Oa={key:1,class:"uploaded-file"},ja={class:"uploaded-file-actions"},Xa={key:2,class:"upload-placeholder"},Wa={key:0,class:"recognized-info"},Ga={class:"advanced-options-section"},Ha={class:"header-left"},Qa={class:"header-right"},Ya={class:"advanced-options-content"},Za={class:"requirement-selection-entry"},Ja={key:0,class:"selected-standards-section"},Ka={class:"selected-header"},el={class:"selected-tags"},tl={key:0,class:"more-count"},al={class:"special-content"},ll={key:0,class:"special-mode-selection"},sl={key:1,class:"special-footer"},nl={key:2,class:"special-footer direct-mode"},ol={key:1,class:"applied-standard"},il={key:0},rl={class:"recommend-list"},ul=["onClick"],dl={class:"recommend-content"},cl={class:"recommend-header"},pl={class:"recommend-title"},vl={class:"recommend-reason"},ml={class:"recommend-desc"},fl={class:"library-selector"},_l={class:"selector-header"},gl={key:0,class:"recommendation-section"},yl={class:"recommendation-header"},kl={class:"recommendation-list"},wl=["onClick"],hl={class:"rec-header"},Cl={class:"rec-name"},bl={class:"rec-reason"},Sl={class:"rec-meta"},xl={class:"collection-list"},Rl=["onClick"],$l={class:"collection-card-header"},zl={class:"collection-info"},Vl={class:"collection-name"},Il={class:"collection-meta"},Tl={key:0,class:"collection-desc"},Ll={key:1,class:"selection-summary"},Pl={class:"merge-preview"},Dl={class:"merge-summary"},Ul={class:"summary-stats"},Bl={class:"merge-standards-list"},Ml={class:"standard-change-badge"},ql={class:"standard-content"},El={class:"standard-header"},Al={class:"standard-category"},Nl={class:"standard-item"},Fl={class:"standard-desc"},Ol={key:0,class:"change-reason"},jl={class:"business-selector"},Xl={class:"selector-header"},Wl={class:"business-line-list"},Gl=["onClick"],Hl={class:"business-line-header"},Ql={class:"business-line-info"},Yl={class:"business-line-name"},Zl={class:"business-line-meta"},Jl={key:0,class:"business-line-desc"},Kl={key:0,class:"selection-summary"},es={key:0,class:"mode-hint"},ts={key:0},as={key:1},ls={key:0,class:"waiting-state"},ss={key:1,class:"progress-state"},ns={class:"progress-content"},os={class:"progress-info"},is={class:"progress-steps"},rs={key:2,class:"completed-state"},us={key:0},ds={key:3,class:"failed-state"},cs={__name:"ReviewView",setup(D){const pe=ia(),V=ra(),r=fa();_(null);const W=_(null),v=_(pe.params.taskId||null),L=_({name:"",our_party:"",material_type:"contract",language:"zh-CN"});_(null),_(0);const M=_(!1),F=_(!1),se=_([]),ne=_(""),oe=_(null),Z=_(null),I=_([]),f=_(null),b=_([]),O=_(!1),J=_(""),X=_(!1),G=_(!1),T=_(!1),H=U(()=>b.value.length>0||E.value||P.value.trim()),ie=_(!1),P=_(""),re=_("direct"),ve=_(!1),ue=_(!1),q=_(null);_(!1);const be=_(!1),Ve=_([]),ot=_([]),Se=_(!1),K=_([]),ee=_(!1),de=_(""),te=_([]),me=_(!1),E=_(null),A=_(null),it=U(()=>E.value?te.value.find(l=>l.id===E.value):null),xe=U(()=>A.value?te.value.find(l=>l.id===A.value):null),Ie=U(()=>{if(!de.value)return te.value;const l=de.value.toLowerCase();return te.value.filter(e=>e.name.toLowerCase().includes(l)||e.description&&e.description.toLowerCase().includes(l)||e.industry&&e.industry.toLowerCase().includes(l))}),C=U(()=>r.currentTask),Te=U(()=>{var l;return((l=C.value)==null?void 0:l.status)==="completed"}),rt=U(()=>{var l;return((l=C.value)==null?void 0:l.status)==="failed"}),ut=U(()=>{var l;return v.value?(l=C.value)==null?void 0:l.document_filename:!1}),dt=U(()=>({idle:"准备中",analyzing:"分析文档",generating:"生成建议",completed:"已完成"})[r.progress.stage]||"处理中"),ct=U(()=>{const l=r.progress.stage;return l==="idle"?0:l==="analyzing"?1:l==="generating"?2:l==="completed"?4:1});ua(async()=>{try{const l=await j.getCollections();I.value=l.data.map(e=>({id:e.id,name:e.name,description:e.description,material_type:e.material_type,standard_count:e.standard_count,is_preset:e.is_preset,standards:[]}))}catch(l){console.error("加载标准集合失败:",l)}if(Pe(),v.value)try{await r.loadTask(v.value),L.value={name:C.value.name,our_party:C.value.our_party,material_type:C.value.material_type},C.value.status==="reviewing"&&(r.isReviewing=!0,r.startPolling(v.value))}catch{h.error("加载任务失败"),V.push("/")}}),nt(()=>pe.params.taskId,async l=>{l&&l!==v.value&&(v.value=l,await r.loadTask(l))});async function pt(l){if(Z.value=l.raw,!v.value)try{const e=await r.createTask({name:"正在分析...",our_party:"待确认",material_type:L.value.material_type||"contract",language:"zh-CN"});v.value=e.id,V.replace(`/review/${e.id}`)}catch{h.error("创建任务失败"),Z.value=null;return}try{await r.uploadDocument(v.value,l.raw)}catch(e){h.error(e.message||"上传失败"),Z.value=null;return}await vt()}async function vt(){if(v.value){M.value=!0;try{const l=await j.preprocessDocument(v.value);oe.value=l.data,se.value=l.data.parties||[],ne.value=l.data.document_preview||"",F.value=!0}catch(l){console.error("预处理失败:",l),h.warning("文档分析失败，请手动输入信息"),se.value=[],ne.value="",F.value=!0}finally{M.value=!1}}}async function mt(l){var o,p;if(!v.value)return;const e=((o=oe.value)==null?void 0:o.suggested_name)||"未命名文档",y=((p=oe.value)==null?void 0:p.language)||"zh-CN";try{await j.updateTask(v.value,{name:e,our_party:l,language:y}),C.value&&(C.value.name=e,C.value.our_party=l,C.value.language=y),L.value.name=e,L.value.our_party=l,L.value.language=y,h.success("已确认您的身份"),Z.value=null}catch(x){console.error("更新任务失败:",x),h.error("保存失败，请重试")}}function ft(){h.info("请选择您在合同中的身份以继续"),setTimeout(()=>{F.value=!0},500)}function _t(){C.value&&(C.value.document_filename=null,C.value.document_storage_name=null)}async function gt(){var l;if(!((l=C.value)!=null&&l.document_filename)){h.warning("请先上传文档");return}Se.value=!0;try{const e=r.documentText||`文档名称: ${C.value.document_filename}`,y=await j.recommendCollections({document_text:e.slice(0,1e3),material_type:L.value.material_type});K.value=y.data||[],K.value.length===0?h.info("没有找到匹配的标准集合推荐"):h.success(`推荐了 ${K.value.length} 个标准集合`)}catch(e){console.error("获取推荐失败:",e),h.error("获取推荐失败: "+(e.message||"请重试"))}finally{Se.value=!1}}async function yt(l){let e=I.value.find(y=>y.id===l.collection_id);if(e){if(!e.standards||e.standards.length===0)try{const y=await j.getCollection(e.id);e.standards=y.data.standards||[],e.standard_count=e.standards.length}catch(y){console.error("获取集合详情失败:",y),h.error("获取标准详情失败");return}f.value=e}}const Le=U(()=>{if(!J.value)return I.value;const l=J.value.toLowerCase();return I.value.filter(e=>e.name.toLowerCase().includes(l)||e.description&&e.description.toLowerCase().includes(l))});function kt(){f.value=null,O.value=!0}function wt(){O.value=!1,V.push({name:"standards"})}async function ht(l){var e;if(((e=f.value)==null?void 0:e.id)===l.id)f.value=null;else{if(!l.standards||l.standards.length===0)try{const y=await j.getCollection(l.id);l.standards=y.data.standards||[],l.standard_count=l.standards.length}catch(y){console.error("获取集合详情失败:",y),h.error("获取标准详情失败");return}f.value=l}}async function Ct(){if(!v.value){h.warning("请先上传文档");return}if(!f.value){h.warning("请先选择标准");return}b.value=f.value.standards.map(l=>({id:l.id,category:l.category,item:l.item,description:l.description,risk_level:l.risk_level,applicable_to:l.applicable_to||["contract"]})),O.value=!1,await bt(b.value)}async function bt(l){X.value=!0;try{const e=["审核分类,审核要点,详细说明,风险等级,适用材料类型",...l.map(x=>`"${x.category}","${x.item}","${x.description}","${x.risk_level==="high"?"高":x.risk_level==="medium"?"中":"低"}","${(x.applicable_to||["contract"]).join(",")}"`)].join(`
`),y=new Blob([e],{type:"text/csv;charset=utf-8"}),o=f.value?`${f.value.name}.csv`:"selected_standards.csv",p=new File([y],o,{type:"text/csv"});await r.uploadStandard(v.value,p),h.success(`已应用 ${l.length} 条审核标准`)}catch(e){h.error("应用标准失败: "+e.message)}finally{X.value=!1}}function St(l){var e,y;if(l==="upload"){const o=(y=(e=W.value)==null?void 0:e.$el)==null?void 0:y.querySelector('input[type="file"]');o&&o.click()}else l==="ai"&&(O.value=!1,V.push({name:"Standards",query:{action:"ai-create"}}))}async function xt(l){if(!v.value){h.warning("请先上传文档");return}try{await r.uploadStandard(v.value,l.raw),selectedPresetTemplate.value=null,b.value=[],h.success("审核标准上传成功")}catch(e){h.error(e.message||"上传失败")}}function Rt(){f.value=null,b.value=[],P.value=""}async function $t(){if(!v.value){h.warning("请先完成配置");return}try{await zt()}catch(l){h.error(l.message||"启动审阅失败")}}async function zt(){var p;r.isReviewing=!0;const l=b.value.length>0&&((p=C.value)==null?void 0:p.standard_filename),e=l?"正在基于审核标准进行审阅...":"正在进行 AI 自主审阅...";r.progress={stage:"analyzing",percentage:10,message:e};const y=re.value==="direct"&&P.value.trim()?P.value.trim():null,o={llmProvider:"deepseek",useStandards:l,businessLineId:E.value,specialRequirements:y};try{await Vt(o)}catch(x){console.warn("流式审阅失败，降级为普通模式:",x),await It(o)}}async function Vt(l){let e=!1,y=0;try{await lt.startUnifiedReviewStream(v.value,l,{onStart:o=>{console.log("流式审阅开始:",o),r.progress={stage:"analyzing",percentage:15,message:"AI 正在分析文档..."}},onProgress:o=>{r.progress={stage:"analyzing",percentage:o.percentage||20,message:o.message||"正在分析..."}},onRisk:o=>{y++;const p=o.data||{};console.log(`收到风险点 #${y}:`,p.risk_type),e?r.progress={stage:"partial_ready",percentage:Math.min(85+y,95),message:`已识别 ${y} 个风险点...`}:(e=!0,r.progress={stage:"partial_ready",percentage:85,message:"第1条风险点已识别，可以开始处理..."},setTimeout(async()=>{await r.loadTask(v.value),V.push(`/interactive/${v.value}`)},300))},onComplete:async o=>{console.log("流式审阅完成:",o),r.isReviewing=!1,r.progress={stage:"completed",percentage:100,message:"审阅完成"},e||(await r.loadTask(v.value),V.push(`/interactive/${v.value}`))},onError:o=>{throw console.error("流式审阅错误:",o),o}})}catch(o){if(e){console.log("流式审阅中断，但已有部分结果，继续使用");return}throw o}}async function It(l){try{await lt.startUnifiedReview(v.value,l),Tt()}catch(e){r.isReviewing=!1,r.progress={stage:"idle",percentage:0,message:""},h.error(e.message||"启动审阅失败")}}async function Tt(){let l=0,e=0,y=0;const o=setInterval(async()=>{try{const x=(await j.getTaskStatus(v.value)).data;if(x.status==="partial_ready")clearInterval(o),r.isReviewing=!1,r.progress={stage:"partial_ready",percentage:95,message:"第一条已就绪，正在准备更多..."},await r.loadTask(v.value),setTimeout(()=>{V.push(`/interactive/${v.value}`)},500);else if(x.status==="completed")clearInterval(o),r.isReviewing=!1,r.progress={stage:"completed",percentage:100,message:"审阅完成"},await r.loadTask(v.value),setTimeout(()=>{V.push(`/interactive/${v.value}`)},500);else if(x.status==="failed")clearInterval(o),r.isReviewing=!1,r.progress={stage:"idle",percentage:0,message:""},h.error(x.message||"审阅失败");else if(x.status==="reviewing"){const ae=x.progress||{},le=ae.percentage||0;if(le>l)e=le,l=le,y=0;else{y++;const fe=Math.min(le+y*2.5,90);e=Math.min(e+2,fe)}r.progress={stage:ae.stage||"analyzing",percentage:Math.round(e),message:ae.message||x.message||"正在分析文档..."}}}catch(p){console.error("轮询状态失败:",p)}},2e3);setTimeout(()=>{clearInterval(o),r.isReviewing&&(r.isReviewing=!1,r.progress={stage:"idle",percentage:0,message:""},h.error("审阅超时，请重试"))},5*60*1e3)}async function Pe(){me.value=!0;try{const l=await j.getBusinessLines({include_preset:!0});te.value=l.data}catch(l){console.error("加载业务条线失败:",l)}finally{me.value=!1}}function Lt(){A.value=E.value,de.value="",ee.value=!0,te.value.length===0&&Pe()}function Pt(l){A.value===l.id?A.value=null:A.value=l.id}function Dt(){var l;E.value=A.value,ee.value=!1,E.value&&h.success(`已选择业务条线: ${(l=it.value)==null?void 0:l.name}`)}function Ut(){E.value=null,A.value=null,ee.value=!1,h.info("已清除业务条线选择")}function Bt(){r.progress={stage:"idle",percentage:0,message:""},C.value&&(C.value.status="created")}function Mt(){V.push(`/interactive/${v.value}`)}function De(){r.operationState.lastError=null}function qt(){window.location.href="mailto:support@example.com"}function Ue(l){return{high:"danger",medium:"warning",low:"success"}[l]||"info"}function Be(l){return{high:"高",medium:"中",low:"低"}[l]||l}function Et(l){return{added:"success",modified:"warning",removed:"danger",unchanged:"info"}[l]||"info"}function At(l){return{added:"新增",modified:"修改",removed:"删除",unchanged:"未变"}[l]||l}async function Nt(){if(!b.value.length){h.warning("请先选择基础标准");return}if(!P.value.trim()){h.warning("请输入特殊要求");return}ve.value=!0;try{const l=await j.mergeSpecialRequirements({standards:b.value.map(e=>({category:e.category,item:e.item,description:e.description,risk_level:e.risk_level,applicable_to:e.applicable_to||["contract"]})),special_requirements:P.value.trim(),our_party:L.value.our_party,material_type:L.value.material_type});q.value=l.data,ue.value=!0}catch(l){h.error("整合失败: "+(l.message||"请重试"))}finally{ve.value=!1}}function Ft(){ue.value=!1,q.value=null}function Ot(){q.value&&(b.value=q.value.merged_standards.filter(l=>l.change_type!=="removed").map(l=>({id:l.id,category:l.category,item:l.item,description:l.description,risk_level:l.risk_level,applicable_to:["contract"]})),ue.value=!1,q.value=null,h.success("已应用到本次审核"))}async function jt(){if(!v.value){h.warning("请先上传文档");return}if(!b.value.length){h.warning("请先选择标准");return}X.value=!0;try{const l=["审核分类,审核要点,详细说明,风险等级,适用材料类型",...b.value.map(p=>`"${p.category}","${p.item}","${p.description}","${p.risk_level==="high"?"高":p.risk_level==="medium"?"中":"低"}","${(p.applicable_to||["contract"]).join(",")}"`)].join(`
`),e=new Blob([l],{type:"text/csv;charset=utf-8"}),y=f.value?`${f.value.name}.csv`:"selected_standards.csv",o=new File([e],y,{type:"text/csv"});await r.uploadStandard(v.value,o),G.value=!1,h.success("标准应用成功")}catch(l){h.error("应用标准失败: "+l.message)}finally{X.value=!1}}return(l,e)=>{var Ge;const y=m("MagicStick"),o=m("el-icon"),p=m("el-button"),x=m("el-alert"),ae=m("Document"),le=m("DocumentChecked"),fe=m("UploadFilled"),Me=m("el-upload"),_e=m("el-descriptions-item"),Xt=m("el-descriptions"),qe=m("el-divider"),R=m("el-tag"),Re=m("ArrowDown"),Wt=m("Collection"),Ee=m("Edit"),$e=m("el-input"),Ae=m("el-radio"),Gt=m("el-radio-group"),Ne=m("el-collapse-transition"),Ht=m("el-checkbox"),ge=m("el-empty"),ce=m("el-dialog"),Fe=m("el-dropdown-item"),Qt=m("el-dropdown-menu"),Yt=m("el-dropdown"),ye=m("el-table-column"),Zt=m("el-table"),Jt=m("CirclePlus"),Kt=m("Remove"),ea=m("Check"),Oe=m("router-link"),je=m("el-card"),Xe=m("el-col"),ta=m("el-progress"),ke=m("el-step"),aa=m("el-steps"),We=m("el-result"),la=m("el-row"),sa=da("loading");return n(),d("div",La,[t(Je,{name:"fade"},{default:a(()=>[ve.value?(n(),d("div",Pa,[s("div",Da,[s("div",Ua,[t(o,{class:"ai-icon-spin",size:48},{default:a(()=>[t(y)]),_:1})]),e[18]||(e[18]=s("h3",{class:"ai-title"},"AI 正在整合特殊要求",-1)),e[19]||(e[19]=s("p",{class:"ai-desc"},"正在分析您的特殊要求，智能调整审核标准...",-1)),e[20]||(e[20]=s("div",{class:"ai-progress"},[s("div",{class:"ai-progress-bar"})],-1)),e[21]||(e[21]=s("p",{class:"ai-hint"},"预计需要 30-60 秒，请耐心等待",-1))])])):k("",!0)]),_:1}),t(Je,{name:"fade"},{default:a(()=>[g(r).isOperationInProgress?(n(),d("div",Ba,[t(o,{class:"is-loading"},{default:a(()=>[t(g(Ke))]),_:1}),s("span",null,c(g(r).currentOperationMessage),1)])):k("",!0)]),_:1}),((Ge=g(r).operationError)==null?void 0:Ge.type)==="quota_exceeded"&&!g(r).isOperationInProgress?(n(),d("div",Ma,[s("div",qa,[t(o,{size:32,color:"#E6A23C"},{default:a(()=>[t(g(ca))]),_:1})]),s("div",Ea,[e[24]||(e[24]=s("h4",null,"免费额度已用完",-1)),e[25]||(e[25]=s("p",null,"您的免费试用额度已全部使用完毕。如需继续使用，请联系我们获取更多额度。",-1)),s("div",Aa,[t(p,{type:"warning",onClick:qt},{default:a(()=>[...e[22]||(e[22]=[i("联系我们",-1)])]),_:1}),t(p,{onClick:De},{default:a(()=>[...e[23]||(e[23]=[i("我知道了",-1)])]),_:1})])])])):g(r).operationError&&!g(r).isOperationInProgress?(n(),$(x,{key:1,type:"error",title:g(r).operationError.message,description:g(r).operationError.detail,"show-icon":"",closable:"",class:"error-alert",onClose:De},null,8,["title","description"])):k("",!0),t(la,{gutter:24},{default:a(()=>[t(Xe,{span:10},{default:a(()=>[t(je,{class:"config-card"},{header:a(()=>[...e[26]||(e[26]=[s("div",{class:"card-header"},[s("span",null,"审阅配置")],-1)])]),default:a(()=>{var Q;return[s("div",Na,[s("h4",null,[t(o,null,{default:a(()=>[t(ae)]),_:1}),e[27]||(e[27]=i(" 上传待审阅文档 ",-1))]),t(Me,{class:"upload-box",drag:"","auto-upload":!1,"show-file-list":!1,"on-change":pt,disabled:M.value,accept:".pdf,.jpg,.jpeg,.png,.webp,.docx,.xlsx,.md,.txt"},{default:a(()=>{var u;return[M.value?(n(),d("div",Fa,[t(o,{size:40,class:"is-loading"},{default:a(()=>[t(g(Ke))]),_:1}),e[28]||(e[28]=s("p",null,"正在分析文档...",-1)),e[29]||(e[29]=s("span",null,"识别合同各方和文档类型",-1))])):(u=C.value)!=null&&u.document_filename?(n(),d("div",Oa,[t(o,{size:40,color:"#67c23a"},{default:a(()=>[t(le)]),_:1}),s("span",null,c(C.value.document_filename),1),s("div",ja,[t(p,{type:"primary",text:"",size:"small"},{default:a(()=>[...e[30]||(e[30]=[i("重新上传",-1)])]),_:1}),t(p,{type:"danger",text:"",size:"small",onClick:pa(_t,["stop"])},{default:a(()=>[...e[31]||(e[31]=[i("取消",-1)])]),_:1})])])):(n(),d("div",Xa,[t(o,{size:40},{default:a(()=>[t(fe)]),_:1}),e[32]||(e[32]=s("p",null,"拖拽文件到此处或点击上传",-1)),e[33]||(e[33]=s("span",null,"支持 PDF、图片、Word、Excel、Markdown 格式",-1))]))]}),_:1},8,["disabled"]),(Q=C.value)!=null&&Q.our_party&&!M.value?(n(),d("div",Wa,[t(Xt,{column:2,size:"small",border:""},{default:a(()=>[t(_e,{label:"任务名称"},{default:a(()=>[i(c(C.value.name||"未命名"),1)]),_:1}),t(_e,{label:"我方身份"},{default:a(()=>[i(c(C.value.our_party),1)]),_:1}),t(_e,{label:"材料类型"},{default:a(()=>[i(c(C.value.material_type==="contract"?"合同":"营销材料"),1)]),_:1}),t(_e,{label:"审阅语言"},{default:a(()=>[i(c(C.value.language==="zh-CN"?"中文":"English"),1)]),_:1})]),_:1})])):k("",!0)]),t(qe),s("div",Ga,[s("div",{class:B(["advanced-options-header",{expanded:T.value,"has-selection":H.value}]),onClick:e[0]||(e[0]=u=>T.value=!T.value)},[s("div",Ha,[t(o,null,{default:a(()=>[t(g(va))]),_:1}),e[34]||(e[34]=s("span",{class:"header-title"},"高级选项",-1)),e[35]||(e[35]=s("span",{class:"header-subtitle"},"审阅标准、业务条线、特殊要求",-1))]),s("div",Qa,[H.value?(n(),d(N,{key:0},[b.value.length?(n(),$(R,{key:0,size:"small",type:"success"},{default:a(()=>[i(c(b.value.length)+" 条标准 ",1)]),_:1})):k("",!0),E.value?(n(),$(R,{key:1,size:"small",type:"info"},{default:a(()=>[...e[36]||(e[36]=[i(" 业务条线 ",-1)])]),_:1})):k("",!0),P.value.trim()?(n(),$(R,{key:2,size:"small",type:"warning"},{default:a(()=>[...e[37]||(e[37]=[i(" 特殊要求 ",-1)])]),_:1})):k("",!0)],64)):k("",!0),t(o,{class:B(["expand-icon",{expanded:T.value}])},{default:a(()=>[t(Re)]),_:1},8,["class"])])],2),t(Ne,null,{default:a(()=>{var u;return[Ce(s("div",Ya,[s("div",Za,[t(p,{type:"primary",onClick:kt},{default:a(()=>[t(o,null,{default:a(()=>[t(Wt)]),_:1}),e[38]||(e[38]=i(" 审阅标准 ",-1)),b.value.length?(n(),$(R,{key:0,size:"small",type:"success",class:"btn-tag"},{default:a(()=>[i(c(b.value.length),1)]),_:1})):k("",!0)]),_:1}),t(p,{onClick:Lt},{default:a(()=>[t(o,null,{default:a(()=>[t(g(et))]),_:1}),e[40]||(e[40]=i(" 业务条线 ",-1)),E.value?(n(),$(R,{key:0,size:"small",type:"success",class:"btn-tag"},{default:a(()=>[...e[39]||(e[39]=[i(" 1 ",-1)])]),_:1})):k("",!0)]),_:1})]),t(Me,{ref_key:"standardUploadRef",ref:W,"auto-upload":!1,"show-file-list":!1,"on-change":xt,accept:".xlsx,.xls,.csv,.docx,.md,.txt",style:{display:"none"}},null,512),b.value.length>0?(n(),d("div",Ja,[s("div",Ka,[e[42]||(e[42]=s("span",{class:"selected-label"},"已选标准",-1)),t(R,{type:"success",size:"small"},{default:a(()=>[i(c(b.value.length)+" 条",1)]),_:1}),t(p,{text:"",type:"primary",size:"small",onClick:e[1]||(e[1]=w=>G.value=!0)},{default:a(()=>[...e[41]||(e[41]=[i(" 查看详情 ",-1)])]),_:1})]),s("div",el,[(n(!0),d(N,null,Y(b.value.slice(0,6),w=>(n(),$(R,{key:w.id||w.item,size:"small",style:{margin:"2px"}},{default:a(()=>[i(c(w.item),1)]),_:2},1024))),128)),b.value.length>6?(n(),d("span",tl," +"+c(b.value.length-6)+" 条 ",1)):k("",!0)])])):k("",!0),s("div",{class:B(["special-requirements",{"has-content":P.value.trim()}])},[s("div",{class:"special-header",onClick:e[2]||(e[2]=w=>ie.value=!ie.value)},[t(o,null,{default:a(()=>[t(Ee)]),_:1}),e[43]||(e[43]=s("span",{class:"special-title"},"本次特殊要求",-1)),e[44]||(e[44]=s("span",{class:"special-priority-hint"},"优先级最高",-1)),t(o,{class:B(["expand-icon",{expanded:ie.value}])},{default:a(()=>[t(Re)]),_:1},8,["class"])]),t(Ne,null,{default:a(()=>[Ce(s("div",al,[e[51]||(e[51]=s("p",{class:"special-desc"}," 输入本次项目的特殊审核要求。当与审阅标准或业务背景冲突时，以此处要求为准。 ",-1)),t($e,{modelValue:P.value,"onUpdate:modelValue":e[3]||(e[3]=w=>P.value=w),type:"textarea",rows:5,autosize:{minRows:5,maxRows:10},placeholder:`例如：

• 本项目为政府采购，需特别关注合规要求

• 我方为乙方，重点关注付款条款和违约责任

• 涉及数据跨境，需审核数据安全条款`},null,8,["modelValue"]),P.value.trim()?(n(),d("div",ll,[e[47]||(e[47]=s("span",{class:"mode-label"},"处理方式：",-1)),t(Gt,{modelValue:re.value,"onUpdate:modelValue":e[4]||(e[4]=w=>re.value=w),size:"small"},{default:a(()=>[t(Ae,{value:"direct"},{default:a(()=>[...e[45]||(e[45]=[s("span",{class:"mode-option"},[s("span",{class:"mode-name"},"直接应用"),s("span",{class:"mode-desc"},"审阅时自动参考，无需等待")],-1)])]),_:1}),t(Ae,{value:"merge"},{default:a(()=>[...e[46]||(e[46]=[s("span",{class:"mode-option"},[s("span",{class:"mode-name"},"修改标准"),s("span",{class:"mode-desc"},"先调整审核标准，可预览效果")],-1)])]),_:1})]),_:1},8,["modelValue"])])):k("",!0),P.value.trim()&&re.value==="merge"?(n(),d("div",sl,[t(p,{type:"primary",size:"default",loading:ve.value,disabled:!P.value.trim()||!b.value.length,onClick:Nt},{default:a(()=>[t(o,null,{default:a(()=>[t(y)]),_:1}),e[48]||(e[48]=i(" 开始修改标准 ",-1))]),_:1},8,["loading","disabled"]),e[49]||(e[49]=s("span",{class:"special-tip"},"AI 将根据特殊要求调整审核标准（约30-60秒）",-1))])):k("",!0),P.value.trim()&&re.value==="direct"?(n(),d("div",nl,[t(o,{color:"#67c23a"},{default:a(()=>[t(g(we))]),_:1}),e[50]||(e[50]=s("span",{class:"direct-hint"},"开始审阅后，特殊要求将自动生效",-1))])):k("",!0)],512),[[ze,ie.value]])]),_:1})],2),(u=C.value)!=null&&u.standard_filename?(n(),d("div",ol,[t(o,{color:"#67c23a"},{default:a(()=>[t(g(we))]),_:1}),s("span",null,"已应用: "+c(C.value.standard_filename),1),t(p,{text:"",type:"primary",size:"small",onClick:Rt},{default:a(()=>[...e[52]||(e[52]=[i("重新选择",-1)])]),_:1})])):k("",!0)],512),[[ze,T.value]])]}),_:1})]),t(ce,{modelValue:be.value,"onUpdate:modelValue":e[6]||(e[6]=u=>be.value=u),title:"智能推荐标准",width:"700px"},{footer:a(()=>[t(p,{onClick:e[5]||(e[5]=u=>be.value=!1)},{default:a(()=>[...e[54]||(e[54]=[i("取消",-1)])]),_:1}),t(p,{type:"primary",onClick:l.confirmRecommendation},{default:a(()=>[i(" 确认选择 ("+c(ot.value.length)+") ",1)]),_:1},8,["onClick"])]),default:a(()=>[Ve.value.length?(n(),d("div",il,[t(x,{type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:a(()=>[...e[53]||(e[53]=[i(" 根据您上传的文档，推荐以下审核标准： ",-1)])]),_:1}),s("div",rl,[(n(!0),d(N,null,Y(Ve.value,u=>(n(),d("div",{key:u.standard_id,class:B(["recommend-item",{selected:l.isStandardSelected(u.standard_id)}]),onClick:w=>l.toggleStandard(u)},[t(Ht,{"model-value":l.isStandardSelected(u.standard_id)},null,8,["model-value"]),s("div",dl,[s("div",cl,[s("span",pl,c(u.standard.item),1),t(R,{size:"small",type:l.getRelevanceType(u.relevance_score)},{default:a(()=>[i(" 相关度 "+c(Math.round(u.relevance_score*100))+"% ",1)]),_:2},1032,["type"])]),s("p",vl,c(u.match_reason),1),s("p",ml,c(u.standard.description),1)])],10,ul))),128))])])):(n(),$(ge,{key:1,description:"暂无推荐结果"}))]),_:1},8,["modelValue"]),t(ce,{modelValue:O.value,"onUpdate:modelValue":e[10]||(e[10]=u=>O.value=u),title:"选择审核标准",width:"800px"},{footer:a(()=>[t(p,{onClick:e[9]||(e[9]=u=>O.value=!1)},{default:a(()=>[...e[63]||(e[63]=[i("取消",-1)])]),_:1}),t(p,{type:"primary",onClick:Ct,disabled:!f.value},{default:a(()=>[...e[64]||(e[64]=[i(" 确认选择 ",-1)])]),_:1},8,["disabled"])]),default:a(()=>{var u;return[s("div",fl,[s("div",_l,[t($e,{modelValue:J.value,"onUpdate:modelValue":e[7]||(e[7]=w=>J.value=w),placeholder:"搜索标准...",clearable:"",style:{flex:"1"}},{prefix:a(()=>[t(o,null,{default:a(()=>[t(g(tt))]),_:1})]),_:1},8,["modelValue"]),t(p,{type:"success",onClick:gt,loading:Se.value,disabled:!((u=C.value)!=null&&u.document_filename)},{default:a(()=>[t(o,null,{default:a(()=>[t(y)]),_:1}),e[55]||(e[55]=i(" 智能推荐 ",-1))]),_:1},8,["loading","disabled"]),t(Yt,{trigger:"click",onCommand:St},{dropdown:a(()=>[t(Qt,null,{default:a(()=>[t(Fe,{command:"upload"},{default:a(()=>[t(o,null,{default:a(()=>[t(fe)]),_:1}),e[57]||(e[57]=i(" 上传新标准 ",-1))]),_:1}),t(Fe,{command:"ai"},{default:a(()=>[t(o,null,{default:a(()=>[t(y)]),_:1}),e[58]||(e[58]=i(" AI辅助制作 ",-1))]),_:1})]),_:1})]),default:a(()=>[t(p,{type:"primary"},{default:a(()=>[t(o,null,{default:a(()=>[t(g(at))]),_:1}),e[56]||(e[56]=i(" 新建标准 ",-1)),t(o,{class:"el-icon--right"},{default:a(()=>[t(Re)]),_:1})]),_:1})]),_:1})]),K.value.length>0?(n(),d("div",gl,[s("div",yl,[t(o,{color:"#67c23a"},{default:a(()=>[t(y)]),_:1}),e[60]||(e[60]=s("span",null,"智能推荐",-1)),t(p,{text:"",type:"info",size:"small",onClick:e[8]||(e[8]=w=>K.value=[])},{default:a(()=>[...e[59]||(e[59]=[i(" 清除推荐 ",-1)])]),_:1})]),s("div",kl,[(n(!0),d(N,null,Y(K.value,w=>{var S;return n(),d("div",{key:w.collection_id,class:B(["recommendation-card",{selected:((S=f.value)==null?void 0:S.id)===w.collection_id}]),onClick:z=>yt(w)},[s("div",hl,[s("span",Cl,c(w.collection_name),1),t(R,{type:"success",size:"small"},{default:a(()=>[i(" 相关度 "+c(Math.round(w.relevance_score*100))+"% ",1)]),_:2},1024)]),s("p",bl,c(w.match_reason),1),s("div",Sl,[t(R,{size:"small",type:"info"},{default:a(()=>[i(c(w.standard_count)+" 条审核条目",1)]),_:2},1024)])],10,wl)}),128))])])):k("",!0),s("div",xl,[(n(!0),d(N,null,Y(Le.value,w=>{var S,z,He;return n(),d("div",{key:w.id,class:B(["collection-card-dialog",{selected:((S=f.value)==null?void 0:S.id)===w.id}]),onClick:ps=>ht(w)},[s("div",$l,[t(o,{size:24,color:((z=f.value)==null?void 0:z.id)===w.id?"#409eff":"#909399"},{default:a(()=>[t(g(ma))]),_:1},8,["color"]),s("div",zl,[s("span",Vl,c(w.name),1),s("span",Il,[t(R,{size:"small",type:"info"},{default:a(()=>[i(c(w.standard_count)+" 条审核条目",1)]),_:2},1024),w.is_preset?(n(),$(R,{key:0,size:"small",type:"success"},{default:a(()=>[...e[61]||(e[61]=[i("预设",-1)])]),_:1})):k("",!0)])]),((He=f.value)==null?void 0:He.id)===w.id?(n(),$(o,{key:0,class:"check-icon",color:"#409eff"},{default:a(()=>[t(g(we))]),_:1})):k("",!0)]),w.description?(n(),d("p",Tl,c(w.description),1)):k("",!0)],10,Rl)}),128)),Le.value.length===0?(n(),$(ge,{key:0,description:"暂无标准"},{default:a(()=>[t(p,{type:"primary",onClick:wt},{default:a(()=>[...e[62]||(e[62]=[i(" 前往标准管理 ",-1)])]),_:1})]),_:1})):k("",!0)]),f.value?(n(),d("div",Ll,[t(o,null,{default:a(()=>[t(g(he))]),_:1}),s("span",null,"已选择「"+c(f.value.name)+"」，共 "+c(f.value.standard_count)+" 条审核条目",1)])):k("",!0)])]}),_:1},8,["modelValue"]),t(ce,{modelValue:G.value,"onUpdate:modelValue":e[12]||(e[12]=u=>G.value=u),title:"已选审核标准",width:"750px"},{footer:a(()=>[t(p,{onClick:e[11]||(e[11]=u=>G.value=!1)},{default:a(()=>[...e[65]||(e[65]=[i("关闭",-1)])]),_:1}),t(p,{type:"primary",onClick:jt,loading:X.value},{default:a(()=>[...e[66]||(e[66]=[i(" 应用标准 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(Zt,{data:b.value,"max-height":"450"},{default:a(()=>[t(ye,{prop:"category",label:"分类",width:"100"}),t(ye,{prop:"item",label:"审核要点",width:"150"}),t(ye,{prop:"description",label:"详细说明","show-overflow-tooltip":""}),t(ye,{label:"风险",width:"60",align:"center"},{default:a(({row:u})=>[t(R,{type:Ue(u.risk_level),size:"small"},{default:a(()=>[i(c(Be(u.risk_level)),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),t(ce,{modelValue:ue.value,"onUpdate:modelValue":e[13]||(e[13]=u=>ue.value=u),title:"标准整合预览",width:"850px","close-on-click-modal":!1},{footer:a(()=>[t(p,{onClick:Ft},{default:a(()=>[...e[67]||(e[67]=[i("取消，保留原标准",-1)])]),_:1}),t(p,{type:"primary",onClick:Ot},{default:a(()=>[...e[68]||(e[68]=[i(" 应用整合后的标准 ",-1)])]),_:1})]),default:a(()=>{var u,w;return[s("div",Pl,[s("div",Dl,[t(x,{title:(u=q.value)==null?void 0:u.merge_notes,type:"info",closable:!1,"show-icon":""},null,8,["title"]),s("div",Ul,[t(R,{type:"success"},{default:a(()=>{var S,z;return[t(o,null,{default:a(()=>[t(Jt)]),_:1}),i(" 新增 "+c(((z=(S=q.value)==null?void 0:S.summary)==null?void 0:z.added_count)||0)+" 条 ",1)]}),_:1}),t(R,{type:"warning"},{default:a(()=>{var S,z;return[t(o,null,{default:a(()=>[t(Ee)]),_:1}),i(" 修改 "+c(((z=(S=q.value)==null?void 0:S.summary)==null?void 0:z.modified_count)||0)+" 条 ",1)]}),_:1}),t(R,{type:"danger"},{default:a(()=>{var S,z;return[t(o,null,{default:a(()=>[t(Kt)]),_:1}),i(" 删除 "+c(((z=(S=q.value)==null?void 0:S.summary)==null?void 0:z.removed_count)||0)+" 条 ",1)]}),_:1}),t(R,{type:"info"},{default:a(()=>{var S,z;return[t(o,null,{default:a(()=>[t(ea)]),_:1}),i(" 未变 "+c(((z=(S=q.value)==null?void 0:S.summary)==null?void 0:z.unchanged_count)||0)+" 条 ",1)]}),_:1})])]),s("div",Bl,[(n(!0),d(N,null,Y(((w=q.value)==null?void 0:w.merged_standards)||[],(S,z)=>(n(),d("div",{key:z,class:B(["merge-standard-item",S.change_type])},[s("div",Ml,[t(R,{type:Et(S.change_type),size:"small"},{default:a(()=>[i(c(At(S.change_type)),1)]),_:2},1032,["type"])]),s("div",ql,[s("div",El,[s("span",Al,c(S.category),1),s("span",Nl,c(S.item),1),t(R,{type:Ue(S.risk_level),size:"small"},{default:a(()=>[i(c(Be(S.risk_level)),1)]),_:2},1032,["type"])]),s("p",Fl,c(S.description),1),S.change_reason?(n(),d("p",Ol,[t(o,null,{default:a(()=>[t(g(he))]),_:1}),i(" "+c(S.change_reason),1)])):k("",!0)])],2))),128))])])]}),_:1},8,["modelValue"]),t(ce,{modelValue:ee.value,"onUpdate:modelValue":e[16]||(e[16]=u=>ee.value=u),title:"选择业务条线",width:"800px"},{footer:a(()=>[t(p,{onClick:e[15]||(e[15]=u=>ee.value=!1)},{default:a(()=>[...e[73]||(e[73]=[i("取消",-1)])]),_:1}),E.value?(n(),$(p,{key:0,type:"danger",text:"",onClick:Ut},{default:a(()=>[...e[74]||(e[74]=[i(" 清除选择 ",-1)])]),_:1})):k("",!0),t(p,{type:"primary",onClick:Dt},{default:a(()=>[...e[75]||(e[75]=[i(" 确认选择 ",-1)])]),_:1})]),default:a(()=>[s("div",jl,[s("div",Xl,[t($e,{modelValue:de.value,"onUpdate:modelValue":e[14]||(e[14]=u=>de.value=u),placeholder:"搜索业务条线...",clearable:"",style:{flex:"1"}},{prefix:a(()=>[t(o,null,{default:a(()=>[t(g(tt))]),_:1})]),_:1},8,["modelValue"]),t(Oe,{to:"/business"},{default:a(()=>[t(p,{type:"primary"},{default:a(()=>[t(o,null,{default:a(()=>[t(g(at))]),_:1}),e[69]||(e[69]=i(" 管理业务条线 ",-1))]),_:1})]),_:1})]),t(x,{type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"16px"}},{default:a(()=>[...e[70]||(e[70]=[i(" 选择业务条线后，审阅时将根据业务背景信息提供更有针对性的建议（可选） ",-1)])]),_:1}),Ce((n(),d("div",Wl,[(n(!0),d(N,null,Y(Ie.value,u=>(n(),d("div",{key:u.id,class:B(["business-line-card",{selected:A.value===u.id}]),onClick:w=>Pt(u)},[s("div",Hl,[t(o,{size:24,color:A.value===u.id?"#409eff":"#909399"},{default:a(()=>[t(g(et))]),_:1},8,["color"]),s("div",Ql,[s("span",Yl,c(u.name),1),s("span",Zl,[t(R,{size:"small",type:"info"},{default:a(()=>[i(c(u.context_count)+" 条背景信息",1)]),_:2},1024),u.is_preset?(n(),$(R,{key:0,size:"small",type:"success"},{default:a(()=>[...e[71]||(e[71]=[i("预设",-1)])]),_:1})):k("",!0),u.industry?(n(),$(R,{key:1,size:"small"},{default:a(()=>[i(c(u.industry),1)]),_:2},1024)):k("",!0)])]),A.value===u.id?(n(),$(o,{key:0,class:"check-icon",color:"#409eff"},{default:a(()=>[t(g(we))]),_:1})):k("",!0)]),u.description?(n(),d("p",Jl,c(u.description),1)):k("",!0)],10,Gl))),128)),Ie.value.length===0&&!me.value?(n(),$(ge,{key:0,description:"暂无业务条线"},{default:a(()=>[t(Oe,{to:"/business"},{default:a(()=>[t(p,{type:"primary"},{default:a(()=>[...e[72]||(e[72]=[i("前往创建",-1)])]),_:1})]),_:1})]),_:1})):k("",!0)])),[[sa,me.value]]),xe.value?(n(),d("div",Kl,[t(o,null,{default:a(()=>[t(g(he))]),_:1}),s("span",null,"已选择「"+c(xe.value.name)+"」，共 "+c(xe.value.context_count)+" 条背景信息",1)])):k("",!0)])]),_:1},8,["modelValue"]),t(qe),t(p,{type:"primary",size:"large",class:"start-btn",loading:g(r).isReviewing,disabled:!ut.value,onClick:$t},{default:a(()=>[g(r).isReviewing?(n(),d(N,{key:0},[i(" 审阅中... ")],64)):(n(),d(N,{key:1},[i(" 开始审阅 ")],64))]),_:1},8,["loading","disabled"]),g(r).isReviewing?k("",!0):(n(),d("div",es,[t(o,null,{default:a(()=>[t(g(he))]),_:1}),b.value.length?(n(),d("span",ts,"将基于已选标准进行审阅")):(n(),d("span",as,"默认使用 AI 智能审阅，无需选择标准"))]))]}),_:1})]),_:1}),t(Xe,{span:14},{default:a(()=>[t(je,{class:"progress-card"},{header:a(()=>[...e[76]||(e[76]=[s("div",{class:"card-header"},[s("span",null,"审阅进度")],-1)])]),default:a(()=>[!g(r).isReviewing&&!Te.value?(n(),d("div",ls,[t(ge,{description:"完成配置后点击开始审阅"},{image:a(()=>[t(o,{size:80,color:"#909399"},{default:a(()=>[t(ae)]),_:1})]),_:1})])):g(r).isReviewing?(n(),d("div",ss,[s("div",ns,[t(ta,{type:"circle",percentage:g(r).progress.percentage,width:150,"stroke-width":10},null,8,["percentage"]),s("div",os,[s("h3",null,c(dt.value),1),s("p",null,c(g(r).progress.message),1)])]),s("div",is,[t(aa,{active:ct.value,"align-center":""},{default:a(()=>[t(ke,{title:"分析文档"}),t(ke,{title:"识别风险"}),t(ke,{title:"生成建议"}),t(ke,{title:"完成"})]),_:1},8,["active"])])])):Te.value?(n(),d("div",rs,[t(We,{icon:"success",title:"审阅完成"},{"sub-title":a(()=>[g(r).reviewResult?(n(),d("p",us," 发现 "+c(g(r).reviewResult.summary.total_risks)+" 个风险点， 生成 "+c(g(r).reviewResult.summary.total_modifications)+" 条修改建议 ",1)):k("",!0)]),extra:a(()=>[t(p,{type:"primary",onClick:Mt},{default:a(()=>[...e[77]||(e[77]=[i(" 查看完整结果 ",-1)])]),_:1})]),_:1})])):rt.value?(n(),d("div",ds,[t(We,{icon:"error",title:"审阅失败"},{"sub-title":a(()=>{var Q;return[s("p",null,c(((Q=C.value)==null?void 0:Q.message)||"发生未知错误"),1)]}),extra:a(()=>[t(p,{type:"primary",onClick:Bt},{default:a(()=>[...e[78]||(e[78]=[i("重试",-1)])]),_:1})]),_:1})])):k("",!0)]),_:1})]),_:1})]),_:1}),t(Ta,{modelValue:F.value,"onUpdate:modelValue":e[17]||(e[17]=Q=>F.value=Q),parties:se.value,"document-preview":ne.value,onConfirm:mt,onCancel:ft},null,8,["modelValue","parties","document-preview"])])}}},fs=st(cs,[["__scopeId","data-v-35f64390"]]);export{fs as default};
