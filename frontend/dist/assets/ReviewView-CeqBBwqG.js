import{_ as mt,q as _t,u as vt,r as g,c as T,o as ft,E as m,s as gt,b as i,d as _,e as c,i as t,f as E,g as S,w as a,k as v,h as n,l as yt,t as d,T as wt,j as r,v as ae,F as W,m as G,x as H,y as kt,z as ht,A as Ce,B as bt,C as Ct}from"./index-BNaM8M1n.js";import{u as xt}from"./index-YsGGYywd.js";import{a as J}from"./index-BOy5KFeg.js";const St={class:"review-view"},Vt={key:0,class:"operation-status-bar"},Rt={key:0,class:"language-detection-hint"},zt={class:"upload-section"},$t={key:0,class:"uploaded-file"},Tt={key:1,class:"upload-placeholder"},Ut={class:"standard-section"},Lt={class:"standard-selection-entry"},Dt={key:0,class:"selected-standards-section"},Et={class:"selected-header"},Mt={class:"selected-tags"},Nt={key:0,class:"more-count"},Pt={class:"special-requirements"},qt={class:"special-content"},It={class:"special-actions"},Ft={key:1,class:"applied-standard"},At={key:0},Bt={class:"recommend-list"},jt=["onClick"],Xt={class:"recommend-content"},Ot={class:"recommend-header"},Wt={class:"recommend-title"},Gt={class:"recommend-reason"},Ht={class:"recommend-desc"},Jt={class:"library-selector"},Kt={class:"collection-list"},Qt=["onClick"],Yt={class:"collection-card-header"},Zt={class:"collection-info"},ea={class:"collection-name"},ta={class:"collection-meta"},aa={key:0,class:"collection-desc"},la={key:0,class:"selection-summary"},sa={class:"merge-preview"},na={class:"merge-summary"},oa={class:"summary-stats"},ra={class:"merge-standards-list"},ia={class:"standard-change-badge"},da={class:"standard-content"},ua={class:"standard-header"},ca={class:"standard-category"},pa={class:"standard-item"},ma={class:"standard-desc"},_a={key:0,class:"change-reason"},va={key:0,class:"waiting-state"},fa={key:1,class:"progress-state"},ga={class:"progress-content"},ya={class:"progress-info"},wa={class:"progress-steps"},ka={key:2,class:"completed-state"},ha={key:0},ba={key:3,class:"failed-state"},Ca={__name:"ReviewView",setup(xa){const le=_t(),M=vt(),u=xt(),se=g(null),ne=g(null),f=g(le.params.taskId||null),y=g({name:"",our_party:"",material_type:"contract",language:"zh-CN"}),K=g(null),oe=g(0),xe={name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],our_party:[{required:!0,message:"请输入我方身份",trigger:"blur"}]},Q=g([]),w=g(null),h=g([]),U=g(!1),F=g(""),N=g(!1),P=g(!1),A=g(!1),L=g(""),Y=g(!1),q=g(!1),z=g(null);g(!1);const Z=g(!1),re=g([]),Se=g([]),V=T(()=>u.currentTask),ie=T(()=>{var l;return((l=V.value)==null?void 0:l.status)==="completed"}),Ve=T(()=>{var l;return((l=V.value)==null?void 0:l.status)==="failed"}),Re=T(()=>f.value?u.canStartReview:!1),ze=T(()=>({idle:"准备中",analyzing:"分析文档",generating:"生成建议",completed:"已完成"})[u.progress.stage]||"处理中"),$e=T(()=>{const l=u.progress.stage;return l==="idle"?0:l==="analyzing"?1:l==="generating"?2:l==="completed"?4:1});ft(async()=>{try{const l=await J.getCollections();Q.value=l.data.map(e=>({id:e.id,name:e.name,description:e.description,material_type:e.material_type,standard_count:e.standard_count,is_preset:e.is_preset,standards:[]}))}catch(l){console.error("加载标准集合失败:",l)}if(f.value)try{await u.loadTask(f.value),y.value={name:V.value.name,our_party:V.value.our_party,material_type:V.value.material_type},V.value.status==="reviewing"&&(u.isReviewing=!0,u.startPolling(f.value))}catch{m.error("加载任务失败"),M.push("/")}}),gt(()=>le.params.taskId,async l=>{l&&l!==f.value&&(f.value=l,await u.loadTask(l))});async function Te(l){if(!f.value){if(!await se.value.validate().catch(()=>!1)){m.warning("请先填写基本信息");return}try{const o=await u.createTask({name:y.value.name,our_party:y.value.our_party,material_type:y.value.material_type,language:y.value.language});f.value=o.id,M.replace(`/review/${o.id}`)}catch{m.error("创建任务失败");return}}try{await u.uploadDocument(f.value,l.raw),m.success("文档上传成功"),await Ue(l.raw)}catch(e){m.error(e.message||"上传失败")}}async function Ue(l){try{const e=await Le(l);if(!e||e.length<50)return;const o=await J.detectLanguage(e.slice(0,5e3));o.data&&(K.value=o.data.detected_language,oe.value=o.data.confidence,o.data.confidence>.7&&y.value.language!==o.data.detected_language&&(y.value.language=o.data.detected_language,m.info(`已根据文档内容自动切换为${o.data.detected_language==="zh-CN"?"中文":"English"}审阅模式`)))}catch(e){console.log("语言检测失败，使用默认语言:",e)}}function Le(l){return new Promise((e,o)=>{const x=new FileReader;x.onload=C=>e(C.target.result),x.onerror=o,l.type==="application/pdf"||l.name.endsWith(".pdf")||l.name.endsWith(".docx")?e(""):x.readAsText(l)})}const de=T(()=>{if(!F.value)return Q.value;const l=F.value.toLowerCase();return Q.value.filter(e=>e.name.toLowerCase().includes(l)||e.description&&e.description.toLowerCase().includes(l))});function De(){w.value=null,U.value=!0}function Ee(){U.value=!1,M.push({name:"standards"})}async function Me(l){var e;if(((e=w.value)==null?void 0:e.id)===l.id)w.value=null;else{if(!l.standards||l.standards.length===0)try{const o=await J.getCollection(l.id);l.standards=o.data.standards||[],l.standard_count=l.standards.length}catch(o){console.error("获取集合详情失败:",o),m.error("获取标准详情失败");return}w.value=l}}async function Ne(){if(!f.value){m.warning("请先上传文档");return}if(!w.value){m.warning("请先选择标准集");return}h.value=w.value.standards.map(l=>({id:l.id,category:l.category,item:l.item,description:l.description,risk_level:l.risk_level,applicable_to:l.applicable_to||["contract"]})),U.value=!1,await Pe(h.value)}async function Pe(l){N.value=!0;try{const e=["审核分类,审核要点,详细说明,风险等级,适用材料类型",...l.map($=>`"${$.category}","${$.item}","${$.description}","${$.risk_level==="high"?"高":$.risk_level==="medium"?"中":"低"}","${($.applicable_to||["contract"]).join(",")}"`)].join(`
`),o=new Blob([e],{type:"text/csv;charset=utf-8"}),x=w.value?`${w.value.name}.csv`:"selected_standards.csv",C=new File([o],x,{type:"text/csv"});await u.uploadStandard(f.value,C),m.success(`已应用 ${l.length} 条审核标准`)}catch(e){m.error("应用标准失败: "+e.message)}finally{N.value=!1}}function qe(l){var e,o;if(l==="upload"){const x=(o=(e=ne.value)==null?void 0:e.$el)==null?void 0:o.querySelector('input[type="file"]');x&&x.click()}else l==="ai"&&M.push({name:"standards",query:{action:"ai-create"}})}async function Ie(l){if(!f.value){m.warning("请先上传文档");return}try{await u.uploadStandard(f.value,l.raw),selectedPresetTemplate.value=null,h.value=[],m.success("审核标准上传成功")}catch(e){m.error(e.message||"上传失败")}}function Fe(){w.value=null,h.value=[],L.value=""}async function Ae(){if(!f.value){m.warning("请先完成配置");return}try{await u.startReview(f.value)}catch(l){m.error(l.message||"启动审阅失败")}}function Be(){u.progress={stage:"idle",percentage:0,message:""},V.value&&(V.value.status="created")}function je(){M.push(`/result/${f.value}`)}function Xe(){u.operationState.lastError=null}function ue(l){return{high:"danger",medium:"warning",low:"success"}[l]||"info"}function ce(l){return{high:"高",medium:"中",low:"低"}[l]||l}function Oe(l){return{added:"success",modified:"warning",removed:"danger",unchanged:"info"}[l]||"info"}function We(l){return{added:"新增",modified:"修改",removed:"删除",unchanged:"未变"}[l]||l}async function Ge(){if(!h.value.length){m.warning("请先选择基础标准");return}if(!L.value.trim()){m.warning("请输入特殊要求");return}Y.value=!0;try{const l=await J.mergeSpecialRequirements({standards:h.value.map(e=>({category:e.category,item:e.item,description:e.description,risk_level:e.risk_level,applicable_to:e.applicable_to||["contract"]})),special_requirements:L.value.trim(),our_party:y.value.our_party,material_type:y.value.material_type});z.value=l.data,q.value=!0}catch(l){m.error("整合失败: "+(l.message||"请重试"))}finally{Y.value=!1}}function He(){q.value=!1,z.value=null}function Je(){z.value&&(h.value=z.value.merged_standards.filter(l=>l.change_type!=="removed").map(l=>({id:l.id,category:l.category,item:l.item,description:l.description,risk_level:l.risk_level,applicable_to:["contract"]})),q.value=!1,z.value=null,m.success("已应用到本次审核"))}async function Ke(){if(!f.value){m.warning("请先上传文档");return}if(!h.value.length){m.warning("请先选择标准");return}N.value=!0;try{const l=["审核分类,审核要点,详细说明,风险等级,适用材料类型",...h.value.map(C=>`"${C.category}","${C.item}","${C.description}","${C.risk_level==="high"?"高":C.risk_level==="medium"?"中":"低"}","${(C.applicable_to||["contract"]).join(",")}"`)].join(`
`),e=new Blob([l],{type:"text/csv;charset=utf-8"}),o=w.value?`${w.value.name}.csv`:"selected_standards.csv",x=new File([e],o,{type:"text/csv"});await u.uploadStandard(f.value,x),P.value=!1,m.success("标准应用成功")}catch(l){m.error("应用标准失败: "+l.message)}finally{N.value=!1}}return(l,e)=>{const o=i("el-icon"),x=i("el-alert"),C=i("el-input"),$=i("el-form-item"),B=i("el-radio"),pe=i("el-radio-group"),Qe=i("el-form"),ee=i("el-divider"),me=i("Document"),Ye=i("DocumentChecked"),k=i("el-button"),_e=i("UploadFilled"),ve=i("el-upload"),Ze=i("List"),et=i("Collection"),tt=i("Plus"),fe=i("ArrowDown"),ge=i("el-dropdown-item"),ye=i("MagicStick"),at=i("el-dropdown-menu"),lt=i("el-dropdown"),R=i("el-tag"),we=i("Edit"),st=i("el-collapse-transition"),nt=i("el-checkbox"),te=i("el-empty"),j=i("el-dialog"),X=i("el-table-column"),ot=i("el-table"),rt=i("CirclePlus"),it=i("Remove"),dt=i("Check"),ke=i("el-card"),he=i("el-col"),ut=i("el-progress"),O=i("el-step"),ct=i("el-steps"),be=i("el-result"),pt=i("el-row");return c(),_("div",St,[t(wt,{name:"fade"},{default:a(()=>[v(u).isOperationInProgress?(c(),_("div",Vt,[t(o,{class:"is-loading"},{default:a(()=>[t(v(yt))]),_:1}),n("span",null,d(v(u).currentOperationMessage),1)])):S("",!0)]),_:1}),v(u).operationError&&!v(u).isOperationInProgress?(c(),E(x,{key:0,type:"error",title:v(u).operationError.message,description:v(u).operationError.detail,"show-icon":"",closable:"",class:"error-alert",onClose:Xe},null,8,["title","description"])):S("",!0),t(pt,{gutter:24},{default:a(()=>[t(he,{span:10},{default:a(()=>[t(ke,{class:"config-card"},{header:a(()=>[...e[15]||(e[15]=[n("div",{class:"card-header"},[n("span",null,"审阅配置")],-1)])]),default:a(()=>{var I;return[t(Qe,{ref_key:"formRef",ref:se,model:y.value,rules:xe,"label-position":"top"},{default:a(()=>[t($,{label:"任务名称",prop:"name"},{default:a(()=>[t(C,{modelValue:y.value.name,"onUpdate:modelValue":e[0]||(e[0]=s=>y.value.name=s),placeholder:"例如：XX合同审阅",disabled:!!f.value},null,8,["modelValue","disabled"])]),_:1}),t($,{label:"我方身份",prop:"our_party"},{default:a(()=>[t(C,{modelValue:y.value.our_party,"onUpdate:modelValue":e[1]||(e[1]=s=>y.value.our_party=s),placeholder:"例如：XX科技有限公司",disabled:!!f.value},null,8,["modelValue","disabled"])]),_:1}),t($,{label:"材料类型",prop:"material_type"},{default:a(()=>[t(pe,{modelValue:y.value.material_type,"onUpdate:modelValue":e[2]||(e[2]=s=>y.value.material_type=s),disabled:!!f.value},{default:a(()=>[t(B,{value:"contract"},{default:a(()=>[...e[16]||(e[16]=[r("合同",-1)])]),_:1}),t(B,{value:"marketing"},{default:a(()=>[...e[17]||(e[17]=[r("营销材料",-1)])]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),t($,{label:"审阅语言",prop:"language"},{default:a(()=>[t(pe,{modelValue:y.value.language,"onUpdate:modelValue":e[3]||(e[3]=s=>y.value.language=s),disabled:!!f.value},{default:a(()=>[t(B,{value:"zh-CN"},{default:a(()=>[...e[18]||(e[18]=[r("中文（中国法律体系）",-1)])]),_:1}),t(B,{value:"en"},{default:a(()=>[...e[19]||(e[19]=[r("English (Common Law)",-1)])]),_:1})]),_:1},8,["modelValue","disabled"]),K.value?(c(),_("div",Rt,[t(o,null,{default:a(()=>[t(v(ae))]),_:1}),r(" 自动检测："+d(K.value==="zh-CN"?"中文":"English")+" (置信度 "+d(Math.round(oe.value*100))+"%) ",1)])):S("",!0)]),_:1})]),_:1},8,["model"]),t(ee),n("div",zt,[n("h4",null,[t(o,null,{default:a(()=>[t(me)]),_:1}),e[20]||(e[20]=r(" 上传待审阅文档 ",-1))]),t(ve,{class:"upload-box",drag:"","auto-upload":!1,"show-file-list":!1,"on-change":Te,accept:".md,.txt,.docx,.pdf"},{default:a(()=>{var s;return[(s=V.value)!=null&&s.document_filename?(c(),_("div",$t,[t(o,{size:40,color:"#67c23a"},{default:a(()=>[t(Ye)]),_:1}),n("span",null,d(V.value.document_filename),1),t(k,{type:"primary",text:"",size:"small"},{default:a(()=>[...e[21]||(e[21]=[r("重新上传",-1)])]),_:1})])):(c(),_("div",Tt,[t(o,{size:40},{default:a(()=>[t(_e)]),_:1}),e[22]||(e[22]=n("p",null,"拖拽文件到此处或点击上传",-1)),e[23]||(e[23]=n("span",null,"支持 .md, .txt, .docx, .pdf 格式",-1))]))]}),_:1})]),t(ee),n("div",Ut,[n("h4",null,[t(o,null,{default:a(()=>[t(Ze)]),_:1}),e[24]||(e[24]=r(" 审核标准 ",-1))]),n("div",Lt,[t(k,{type:"primary",onClick:De},{default:a(()=>[t(o,null,{default:a(()=>[t(et)]),_:1}),e[25]||(e[25]=r(" 选择审核标准 ",-1))]),_:1}),t(lt,{trigger:"click",onCommand:qe,style:{"margin-left":"12px"}},{dropdown:a(()=>[t(at,null,{default:a(()=>[t(ge,{command:"upload"},{default:a(()=>[t(o,null,{default:a(()=>[t(_e)]),_:1}),e[27]||(e[27]=r(" 上传新标准 ",-1))]),_:1}),t(ge,{command:"ai"},{default:a(()=>[t(o,null,{default:a(()=>[t(ye)]),_:1}),e[28]||(e[28]=r(" AI辅助制作 ",-1))]),_:1})]),_:1})]),default:a(()=>[t(k,null,{default:a(()=>[t(o,null,{default:a(()=>[t(tt)]),_:1}),e[26]||(e[26]=r(" 新建标准 ",-1)),t(o,{class:"el-icon--right"},{default:a(()=>[t(fe)]),_:1})]),_:1})]),_:1})]),t(ve,{ref_key:"standardUploadRef",ref:ne,"auto-upload":!1,"show-file-list":!1,"on-change":Ie,accept:".xlsx,.xls,.csv,.docx,.md,.txt",style:{display:"none"}},null,512),h.value.length>0?(c(),_("div",Dt,[n("div",Et,[e[30]||(e[30]=n("span",{class:"selected-label"},"已选标准",-1)),t(R,{type:"success",size:"small"},{default:a(()=>[r(d(h.value.length)+" 条",1)]),_:1}),t(k,{text:"",type:"primary",size:"small",onClick:e[4]||(e[4]=s=>P.value=!0)},{default:a(()=>[...e[29]||(e[29]=[r(" 查看详情 ",-1)])]),_:1})]),n("div",Mt,[(c(!0),_(W,null,G(h.value.slice(0,6),s=>(c(),E(R,{key:s.id||s.item,size:"small",style:{margin:"2px"}},{default:a(()=>[r(d(s.item),1)]),_:2},1024))),128)),h.value.length>6?(c(),_("span",Nt," +"+d(h.value.length-6)+" 条 ",1)):S("",!0)])])):S("",!0),n("div",Pt,[n("div",{class:"special-header",onClick:e[5]||(e[5]=s=>A.value=!A.value)},[t(o,null,{default:a(()=>[t(we)]),_:1}),e[32]||(e[32]=n("span",null,"本次特殊要求",-1)),t(R,{size:"small",type:"info"},{default:a(()=>[...e[31]||(e[31]=[r("可选",-1)])]),_:1}),t(o,{class:H(["expand-icon",{expanded:A.value}])},{default:a(()=>[t(fe)]),_:1},8,["class"])]),t(st,null,{default:a(()=>[kt(n("div",qt,[t(C,{modelValue:L.value,"onUpdate:modelValue":e[6]||(e[6]=s=>L.value=s),type:"textarea",rows:3,placeholder:`输入本次项目的特殊审核要求，例如：
• 本项目为政府采购，需特别关注合规要求
• 我方为乙方，重点关注付款条款和违约责任
• 涉及数据跨境，需审核数据安全条款`},null,8,["modelValue"]),n("div",It,[t(k,{type:"primary",size:"small",loading:Y.value,disabled:!L.value.trim()||!h.value.length,onClick:Ge},{default:a(()=>[t(o,null,{default:a(()=>[t(ye)]),_:1}),e[33]||(e[33]=r(" 整合到本次审核 ",-1))]),_:1},8,["loading","disabled"]),e[34]||(e[34]=n("span",{class:"special-tip"},"AI 将根据特殊要求调整本次审核使用的标准（不影响标准库）",-1))])],512),[[ht,A.value]])]),_:1})]),(I=V.value)!=null&&I.standard_filename?(c(),_("div",Ft,[t(o,{color:"#67c23a"},{default:a(()=>[t(v(Ce))]),_:1}),n("span",null,"已应用: "+d(V.value.standard_filename),1),t(k,{text:"",type:"primary",size:"small",onClick:Fe},{default:a(()=>[...e[35]||(e[35]=[r("重新选择",-1)])]),_:1})])):S("",!0)]),t(j,{modelValue:Z.value,"onUpdate:modelValue":e[8]||(e[8]=s=>Z.value=s),title:"智能推荐标准",width:"700px"},{footer:a(()=>[t(k,{onClick:e[7]||(e[7]=s=>Z.value=!1)},{default:a(()=>[...e[37]||(e[37]=[r("取消",-1)])]),_:1}),t(k,{type:"primary",onClick:l.confirmRecommendation},{default:a(()=>[r(" 确认选择 ("+d(Se.value.length)+") ",1)]),_:1},8,["onClick"])]),default:a(()=>[re.value.length?(c(),_("div",At,[t(x,{type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:a(()=>[...e[36]||(e[36]=[r(" 根据您上传的文档，推荐以下审核标准： ",-1)])]),_:1}),n("div",Bt,[(c(!0),_(W,null,G(re.value,s=>(c(),_("div",{key:s.standard_id,class:H(["recommend-item",{selected:l.isStandardSelected(s.standard_id)}]),onClick:D=>l.toggleStandard(s)},[t(nt,{"model-value":l.isStandardSelected(s.standard_id)},null,8,["model-value"]),n("div",Xt,[n("div",Ot,[n("span",Wt,d(s.standard.item),1),t(R,{size:"small",type:l.getRelevanceType(s.relevance_score)},{default:a(()=>[r(" 相关度 "+d(Math.round(s.relevance_score*100))+"% ",1)]),_:2},1032,["type"])]),n("p",Gt,d(s.match_reason),1),n("p",Ht,d(s.standard.description),1)])],10,jt))),128))])])):(c(),E(te,{key:1,description:"暂无推荐结果"}))]),_:1},8,["modelValue"]),t(j,{modelValue:U.value,"onUpdate:modelValue":e[11]||(e[11]=s=>U.value=s),title:"选择审核标准",width:"800px"},{footer:a(()=>[t(k,{onClick:e[10]||(e[10]=s=>U.value=!1)},{default:a(()=>[...e[40]||(e[40]=[r("取消",-1)])]),_:1}),t(k,{type:"primary",onClick:Ne,disabled:!w.value},{default:a(()=>[...e[41]||(e[41]=[r(" 确认选择 ",-1)])]),_:1},8,["disabled"])]),default:a(()=>[n("div",Jt,[t(C,{modelValue:F.value,"onUpdate:modelValue":e[9]||(e[9]=s=>F.value=s),placeholder:"搜索标准集...",clearable:"",style:{"margin-bottom":"16px"}},{prefix:a(()=>[t(o,null,{default:a(()=>[t(v(bt))]),_:1})]),_:1},8,["modelValue"]),n("div",Kt,[(c(!0),_(W,null,G(de.value,s=>{var D,p,b;return c(),_("div",{key:s.id,class:H(["collection-card-dialog",{selected:((D=w.value)==null?void 0:D.id)===s.id}]),onClick:Sa=>Me(s)},[n("div",Yt,[t(o,{size:24,color:((p=w.value)==null?void 0:p.id)===s.id?"#409eff":"#909399"},{default:a(()=>[t(v(Ct))]),_:1},8,["color"]),n("div",Zt,[n("span",ea,d(s.name),1),n("span",ta,[t(R,{size:"small",type:"info"},{default:a(()=>[r(d(s.standard_count)+" 条审核条目",1)]),_:2},1024),s.is_preset?(c(),E(R,{key:0,size:"small",type:"success"},{default:a(()=>[...e[38]||(e[38]=[r("预设",-1)])]),_:1})):S("",!0)])]),((b=w.value)==null?void 0:b.id)===s.id?(c(),E(o,{key:0,class:"check-icon",color:"#409eff"},{default:a(()=>[t(v(Ce))]),_:1})):S("",!0)]),s.description?(c(),_("p",aa,d(s.description),1)):S("",!0)],10,Qt)}),128)),de.value.length===0?(c(),E(te,{key:0,description:"暂无标准集"},{default:a(()=>[t(k,{type:"primary",onClick:Ee},{default:a(()=>[...e[39]||(e[39]=[r(" 前往标准管理 ",-1)])]),_:1})]),_:1})):S("",!0)]),w.value?(c(),_("div",la,[t(o,null,{default:a(()=>[t(v(ae))]),_:1}),n("span",null,"已选择「"+d(w.value.name)+"」，共 "+d(w.value.standard_count)+" 条审核条目",1)])):S("",!0)])]),_:1},8,["modelValue"]),t(j,{modelValue:P.value,"onUpdate:modelValue":e[13]||(e[13]=s=>P.value=s),title:"已选审核标准",width:"750px"},{footer:a(()=>[t(k,{onClick:e[12]||(e[12]=s=>P.value=!1)},{default:a(()=>[...e[42]||(e[42]=[r("关闭",-1)])]),_:1}),t(k,{type:"primary",onClick:Ke,loading:N.value},{default:a(()=>[...e[43]||(e[43]=[r(" 应用标准 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(ot,{data:h.value,"max-height":"450"},{default:a(()=>[t(X,{prop:"category",label:"分类",width:"100"}),t(X,{prop:"item",label:"审核要点",width:"150"}),t(X,{prop:"description",label:"详细说明","show-overflow-tooltip":""}),t(X,{label:"风险",width:"60",align:"center"},{default:a(({row:s})=>[t(R,{type:ue(s.risk_level),size:"small"},{default:a(()=>[r(d(ce(s.risk_level)),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),t(j,{modelValue:q.value,"onUpdate:modelValue":e[14]||(e[14]=s=>q.value=s),title:"标准整合预览",width:"850px","close-on-click-modal":!1},{footer:a(()=>[t(k,{onClick:He},{default:a(()=>[...e[44]||(e[44]=[r("取消，保留原标准",-1)])]),_:1}),t(k,{type:"primary",onClick:Je},{default:a(()=>[...e[45]||(e[45]=[r(" 应用整合后的标准 ",-1)])]),_:1})]),default:a(()=>{var s,D;return[n("div",sa,[n("div",na,[t(x,{title:(s=z.value)==null?void 0:s.merge_notes,type:"info",closable:!1,"show-icon":""},null,8,["title"]),n("div",oa,[t(R,{type:"success"},{default:a(()=>{var p,b;return[t(o,null,{default:a(()=>[t(rt)]),_:1}),r(" 新增 "+d(((b=(p=z.value)==null?void 0:p.summary)==null?void 0:b.added_count)||0)+" 条 ",1)]}),_:1}),t(R,{type:"warning"},{default:a(()=>{var p,b;return[t(o,null,{default:a(()=>[t(we)]),_:1}),r(" 修改 "+d(((b=(p=z.value)==null?void 0:p.summary)==null?void 0:b.modified_count)||0)+" 条 ",1)]}),_:1}),t(R,{type:"danger"},{default:a(()=>{var p,b;return[t(o,null,{default:a(()=>[t(it)]),_:1}),r(" 删除 "+d(((b=(p=z.value)==null?void 0:p.summary)==null?void 0:b.removed_count)||0)+" 条 ",1)]}),_:1}),t(R,{type:"info"},{default:a(()=>{var p,b;return[t(o,null,{default:a(()=>[t(dt)]),_:1}),r(" 未变 "+d(((b=(p=z.value)==null?void 0:p.summary)==null?void 0:b.unchanged_count)||0)+" 条 ",1)]}),_:1})])]),n("div",ra,[(c(!0),_(W,null,G(((D=z.value)==null?void 0:D.merged_standards)||[],(p,b)=>(c(),_("div",{key:b,class:H(["merge-standard-item",p.change_type])},[n("div",ia,[t(R,{type:Oe(p.change_type),size:"small"},{default:a(()=>[r(d(We(p.change_type)),1)]),_:2},1032,["type"])]),n("div",da,[n("div",ua,[n("span",ca,d(p.category),1),n("span",pa,d(p.item),1),t(R,{type:ue(p.risk_level),size:"small"},{default:a(()=>[r(d(ce(p.risk_level)),1)]),_:2},1032,["type"])]),n("p",ma,d(p.description),1),p.change_reason?(c(),_("p",_a,[t(o,null,{default:a(()=>[t(v(ae))]),_:1}),r(" "+d(p.change_reason),1)])):S("",!0)])],2))),128))])])]}),_:1},8,["modelValue"]),t(ee),t(k,{type:"primary",size:"large",class:"start-btn",loading:v(u).isReviewing,disabled:!Re.value,onClick:Ae},{default:a(()=>[r(d(v(u).isReviewing?"审阅中...":"开始审阅"),1)]),_:1},8,["loading","disabled"])]}),_:1})]),_:1}),t(he,{span:14},{default:a(()=>[t(ke,{class:"progress-card"},{header:a(()=>[...e[46]||(e[46]=[n("div",{class:"card-header"},[n("span",null,"审阅进度")],-1)])]),default:a(()=>[!v(u).isReviewing&&!ie.value?(c(),_("div",va,[t(te,{description:"完成配置后点击开始审阅"},{image:a(()=>[t(o,{size:80,color:"#909399"},{default:a(()=>[t(me)]),_:1})]),_:1})])):v(u).isReviewing?(c(),_("div",fa,[n("div",ga,[t(ut,{type:"circle",percentage:v(u).progress.percentage,width:150,"stroke-width":10},null,8,["percentage"]),n("div",ya,[n("h3",null,d(ze.value),1),n("p",null,d(v(u).progress.message),1)])]),n("div",wa,[t(ct,{active:$e.value,"align-center":""},{default:a(()=>[t(O,{title:"分析文档"}),t(O,{title:"识别风险"}),t(O,{title:"生成建议"}),t(O,{title:"完成"})]),_:1},8,["active"])])])):ie.value?(c(),_("div",ka,[t(be,{icon:"success",title:"审阅完成"},{"sub-title":a(()=>[v(u).reviewResult?(c(),_("p",ha," 发现 "+d(v(u).reviewResult.summary.total_risks)+" 个风险点， 生成 "+d(v(u).reviewResult.summary.total_modifications)+" 条修改建议 ",1)):S("",!0)]),extra:a(()=>[t(k,{type:"primary",onClick:je},{default:a(()=>[...e[47]||(e[47]=[r(" 查看完整结果 ",-1)])]),_:1})]),_:1})])):Ve.value?(c(),_("div",ba,[t(be,{icon:"error",title:"审阅失败"},{"sub-title":a(()=>{var I;return[n("p",null,d(((I=V.value)==null?void 0:I.message)||"发生未知错误"),1)]}),extra:a(()=>[t(k,{type:"primary",onClick:Be},{default:a(()=>[...e[48]||(e[48]=[r("重试",-1)])]),_:1})]),_:1})])):S("",!0)]),_:1})]),_:1})]),_:1})])}}},$a=mt(Ca,[["__scopeId","data-v-4a985008"]]);export{$a as default};
