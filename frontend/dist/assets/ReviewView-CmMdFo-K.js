import{q as kt,u as ht,r as _,c as L,o as bt,E as m,s as Re,b as o,d as v,e as c,i as t,f as Q,g as V,w as l,k as w,h as n,l as Ct,t as d,T as St,j as i,F as W,m as Y,v as Z,x as xt,y as Rt,z as Vt}from"./index-3m3pyuBw.js";import{u as $t}from"./index-C4ApD-ng.js";import{_ as zt,a as ee}from"./_plugin-vue_export-helper-CVWIpMOU.js";const Tt={class:"review-view"},Lt={key:0,class:"operation-status-bar"},Ut={class:"upload-section"},Dt={key:0,class:"uploaded-file"},It={key:1,class:"upload-placeholder"},Pt={class:"standard-section"},qt={class:"standard-selection-entry"},Et={key:0,class:"selected-standards-section"},Ft={class:"selected-header"},Mt={class:"selected-tags"},Nt={key:0,class:"more-count"},Bt={class:"special-requirements"},jt={class:"special-content"},At={class:"special-actions"},Xt={key:1,class:"applied-standard"},Ot={key:0},Gt={class:"recommend-list"},Ht=["onClick"],Jt={class:"recommend-content"},Kt={class:"recommend-header"},Qt={class:"recommend-title"},Wt={class:"recommend-reason"},Yt={class:"recommend-desc"},Zt={class:"library-selector"},el={class:"preset-section"},tl={class:"template-cards-dialog"},ll=["onClick"],al={class:"template-card-header"},sl={class:"template-name"},nl={class:"template-desc"},ol={class:"template-meta"},rl={class:"library-section-dialog"},il={key:0,class:"empty-tip"},dl={key:0,class:"selection-summary"},ul={class:"merge-preview"},cl={class:"merge-summary"},pl={class:"summary-stats"},ml={class:"merge-standards-list"},_l={class:"standard-change-badge"},vl={class:"standard-content"},fl={class:"standard-header"},gl={class:"standard-category"},yl={class:"standard-item"},wl={class:"standard-desc"},kl={key:0,class:"change-reason"},hl={key:0,class:"waiting-state"},bl={key:1,class:"progress-state"},Cl={class:"progress-content"},Sl={class:"progress-info"},xl={class:"progress-steps"},Rl={key:2,class:"completed-state"},Vl={key:0},$l={key:3,class:"failed-state"},zl={__name:"ReviewView",setup(Tl){const ne=kt(),A=ht(),u=$t(),oe=_(null),E=_(null),re=_(null),f=_(ne.params.taskId||null),b=_({name:"",our_party:"",material_type:"contract"}),Ve={name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],our_party:[{required:!0,message:"请输入我方身份",trigger:"blur"}]},ie=_([]),g=_(null),h=_([]),I=_(!1),F=_([]),X=_(""),U=_([]),M=_(!1),N=_(!1),O=_(!1),P=_(""),te=_(!1),B=_(!1),R=_(null);_(!1);const G=_(!1),de=_([]),D=_([]),S=L(()=>u.currentTask),ue=L(()=>{var a;return((a=S.value)==null?void 0:a.status)==="completed"}),$e=L(()=>{var a;return((a=S.value)==null?void 0:a.status)==="failed"}),ze=L(()=>f.value?u.canStartReview:!1),Te=L(()=>({idle:"准备中",analyzing:"分析文档",generating:"生成建议",completed:"已完成"})[u.progress.stage]||"处理中"),Le=L(()=>{const a=u.progress.stage;return a==="idle"?0:a==="analyzing"?1:a==="generating"?2:a==="completed"?4:1});bt(async()=>{try{const a=await ee.getCollections();ie.value=a.data.map(e=>({id:e.id,name:e.name,description:e.description,material_type:e.material_type,standard_count:e.standard_count,is_preset:e.is_preset,standards:e.standards||[]}))}catch(a){console.error("加载标准集合失败:",a)}if(f.value)try{await u.loadTask(f.value),b.value={name:S.value.name,our_party:S.value.our_party,material_type:S.value.material_type},S.value.status==="reviewing"&&(u.isReviewing=!0,u.startPolling(f.value))}catch{m.error("加载任务失败"),A.push("/")}}),Re(()=>ne.params.taskId,async a=>{a&&a!==f.value&&(f.value=a,await u.loadTask(a))});async function Ue(a){if(!f.value){if(!await oe.value.validate().catch(()=>!1)){m.warning("请先填写基本信息");return}try{const r=await u.createTask({name:b.value.name,our_party:b.value.our_party,material_type:b.value.material_type});f.value=r.id,A.replace(`/review/${r.id}`)}catch{m.error("创建任务失败");return}}try{await u.uploadDocument(f.value,a.raw),m.success("文档上传成功")}catch(e){m.error(e.message||"上传失败")}}function De(){g.value=null,U.value=[],E.value&&E.value.clearSelection(),I.value=!0}async function Ie(a){var e;if(E.value&&E.value.clearSelection(),U.value=[],((e=g.value)==null?void 0:e.id)===a.id)g.value=null;else{if(!a.standards||a.standards.length===0)try{const r=await ee.getCollection(a.id);a.standards=r.data.standards||[],a.standard_count=a.standards.length}catch(r){console.error("获取集合详情失败:",r),m.error("获取标准详情失败");return}g.value=a}}const ce=L(()=>g.value?`已选择模板「${g.value.name}」，共 ${g.value.standard_count} 条标准`:U.value.length>0?`已从标准库选择 ${U.value.length} 条标准`:""),Pe=L(()=>g.value!==null||U.value.length>0);async function qe(){if(!f.value){m.warning("请先上传文档");return}let a=[];if(g.value?a=g.value.standards.map(e=>({id:e.id,category:e.category,item:e.item,description:e.description,risk_level:e.risk_level,applicable_to:e.applicable_to||["contract"]})):U.value.length>0&&(a=U.value.map(e=>({id:e.id,category:e.category,item:e.item,description:e.description,risk_level:e.risk_level,applicable_to:e.applicable_to||["contract"]}))),a.length===0){m.warning("请先选择标准");return}h.value=a,I.value=!1,await Ee(a)}async function Ee(a){M.value=!0;try{const e=["审核分类,审核要点,详细说明,风险等级,适用材料类型",...a.map(z=>`"${z.category}","${z.item}","${z.description}","${z.risk_level==="high"?"高":z.risk_level==="medium"?"中":"低"}","${(z.applicable_to||["contract"]).join(",")}"`)].join(`
`),r=new Blob([e],{type:"text/csv;charset=utf-8"}),$=g.value?`${g.value.name}.csv`:"selected_standards.csv",x=new File([r],$,{type:"text/csv"});await u.uploadStandard(f.value,x),m.success(`已应用 ${a.length} 条审核标准`)}catch(e){m.error("应用标准失败: "+e.message)}finally{M.value=!1}}function Fe(a){var e,r;if(a==="upload"){const $=(r=(e=re.value)==null?void 0:e.$el)==null?void 0:r.querySelector('input[type="file"]');$&&$.click()}else a==="ai"&&A.push({name:"standards",query:{action:"ai-create"}})}async function Me(a){if(!f.value){m.warning("请先上传文档");return}try{await u.uploadStandard(f.value,a.raw),g.value=null,h.value=[],m.success("审核标准上传成功")}catch(e){m.error(e.message||"上传失败")}}function Ne(){g.value=null,h.value=[],P.value=""}async function Be(){if(!f.value){m.warning("请先完成配置");return}try{await u.startReview(f.value)}catch(a){m.error(a.message||"启动审阅失败")}}function je(){u.progress={stage:"idle",percentage:0,message:""},S.value&&(S.value.status="created")}function Ae(){A.push(`/result/${f.value}`)}function Xe(){u.operationState.lastError=null}async function Oe(){try{const a=await ee.getLibraryStandards({material_type:b.value.material_type});F.value=a.data}catch(a){console.error("加载标准库失败:",a)}}function pe(a){return D.value.some(e=>e.id===a)}function Ge(a){const e=D.value.findIndex(r=>r.id===a.standard_id);e>=0?D.value.splice(e,1):D.value.push(a.standard)}function He(){G.value=!1,D.value.length&&m.success(`已选择 ${D.value.length} 条标准`)}function Je(a){return a>=.8?"success":a>=.5?"warning":"info"}const Ke=L(()=>{if(!X.value)return F.value;const a=X.value.toLowerCase();return F.value.filter(e=>e.category.toLowerCase().includes(a)||e.item.toLowerCase().includes(a)||e.description.toLowerCase().includes(a))});function Qe(a){U.value=a,a.length>0&&(g.value=null)}function le(a){return{high:"danger",medium:"warning",low:"success"}[a]||"info"}function ae(a){return{high:"高",medium:"中",low:"低"}[a]||a}function We(a){return{added:"success",modified:"warning",removed:"danger",unchanged:"info"}[a]||"info"}function Ye(a){return{added:"新增",modified:"修改",removed:"删除",unchanged:"未变"}[a]||a}async function Ze(){if(!h.value.length){m.warning("请先选择基础标准");return}if(!P.value.trim()){m.warning("请输入特殊要求");return}te.value=!0;try{const a=await ee.mergeSpecialRequirements({standards:h.value.map(e=>({category:e.category,item:e.item,description:e.description,risk_level:e.risk_level,applicable_to:e.applicable_to||["contract"]})),special_requirements:P.value.trim(),our_party:b.value.our_party,material_type:b.value.material_type});R.value=a.data,B.value=!0}catch(a){m.error("整合失败: "+(a.message||"请重试"))}finally{te.value=!1}}function et(){B.value=!1,R.value=null}function tt(){R.value&&(h.value=R.value.merged_standards.filter(a=>a.change_type!=="removed").map(a=>({id:a.id,category:a.category,item:a.item,description:a.description,risk_level:a.risk_level,applicable_to:["contract"]})),B.value=!1,R.value=null,m.success("已应用整合后的标准"))}async function lt(){if(!f.value){m.warning("请先上传文档");return}if(!h.value.length){m.warning("请先选择标准");return}M.value=!0;try{const a=["审核分类,审核要点,详细说明,风险等级,适用材料类型",...h.value.map(x=>`"${x.category}","${x.item}","${x.description}","${x.risk_level==="high"?"高":x.risk_level==="medium"?"中":"低"}","${(x.applicable_to||["contract"]).join(",")}"`)].join(`
`),e=new Blob([a],{type:"text/csv;charset=utf-8"}),r=g.value?`${g.value.name}.csv`:"selected_standards.csv",$=new File([e],r,{type:"text/csv"});await u.uploadStandard(f.value,$),N.value=!1,m.success("标准应用成功")}catch(a){m.error("应用标准失败: "+a.message)}finally{M.value=!1}}return Re(I,a=>{a&&!F.value.length&&Oe()}),(a,e)=>{const r=o("el-icon"),$=o("el-alert"),x=o("el-input"),z=o("el-form-item"),me=o("el-radio"),at=o("el-radio-group"),st=o("el-form"),H=o("el-divider"),se=o("Document"),nt=o("DocumentChecked"),y=o("el-button"),_e=o("UploadFilled"),ve=o("el-upload"),ot=o("List"),rt=o("Collection"),it=o("Plus"),fe=o("ArrowDown"),ge=o("el-dropdown-item"),ye=o("MagicStick"),dt=o("el-dropdown-menu"),ut=o("el-dropdown"),C=o("el-tag"),we=o("Edit"),ct=o("el-collapse-transition"),pt=o("CircleCheck"),mt=o("el-checkbox"),ke=o("el-empty"),J=o("el-dialog"),T=o("el-table-column"),he=o("el-table"),be=o("InfoFilled"),_t=o("CirclePlus"),vt=o("Remove"),ft=o("Check"),Ce=o("el-card"),Se=o("el-col"),gt=o("el-progress"),K=o("el-step"),yt=o("el-steps"),xe=o("el-result"),wt=o("el-row");return c(),v("div",Tt,[t(St,{name:"fade"},{default:l(()=>[w(u).isOperationInProgress?(c(),v("div",Lt,[t(r,{class:"is-loading"},{default:l(()=>[t(w(Ct))]),_:1}),n("span",null,d(w(u).currentOperationMessage),1)])):V("",!0)]),_:1}),w(u).operationError&&!w(u).isOperationInProgress?(c(),Q($,{key:0,type:"error",title:w(u).operationError.message,description:w(u).operationError.detail,"show-icon":"",closable:"",class:"error-alert",onClose:Xe},null,8,["title","description"])):V("",!0),t(wt,{gutter:24},{default:l(()=>[t(Se,{span:10},{default:l(()=>[t(Ce,{class:"config-card"},{header:l(()=>[...e[14]||(e[14]=[n("div",{class:"card-header"},[n("span",null,"审阅配置")],-1)])]),default:l(()=>{var j;return[t(st,{ref_key:"formRef",ref:oe,model:b.value,rules:Ve,"label-position":"top"},{default:l(()=>[t(z,{label:"任务名称",prop:"name"},{default:l(()=>[t(x,{modelValue:b.value.name,"onUpdate:modelValue":e[0]||(e[0]=s=>b.value.name=s),placeholder:"例如：XX合同审阅",disabled:!!f.value},null,8,["modelValue","disabled"])]),_:1}),t(z,{label:"我方身份",prop:"our_party"},{default:l(()=>[t(x,{modelValue:b.value.our_party,"onUpdate:modelValue":e[1]||(e[1]=s=>b.value.our_party=s),placeholder:"例如：XX科技有限公司",disabled:!!f.value},null,8,["modelValue","disabled"])]),_:1}),t(z,{label:"材料类型",prop:"material_type"},{default:l(()=>[t(at,{modelValue:b.value.material_type,"onUpdate:modelValue":e[2]||(e[2]=s=>b.value.material_type=s),disabled:!!f.value},{default:l(()=>[t(me,{value:"contract"},{default:l(()=>[...e[15]||(e[15]=[i("合同",-1)])]),_:1}),t(me,{value:"marketing"},{default:l(()=>[...e[16]||(e[16]=[i("营销材料",-1)])]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1},8,["model"]),t(H),n("div",Ut,[n("h4",null,[t(r,null,{default:l(()=>[t(se)]),_:1}),e[17]||(e[17]=i(" 上传待审阅文档 ",-1))]),t(ve,{class:"upload-box",drag:"","auto-upload":!1,"show-file-list":!1,"on-change":Ue,accept:".md,.txt,.docx,.pdf"},{default:l(()=>{var s;return[(s=S.value)!=null&&s.document_filename?(c(),v("div",Dt,[t(r,{size:40,color:"#67c23a"},{default:l(()=>[t(nt)]),_:1}),n("span",null,d(S.value.document_filename),1),t(y,{type:"primary",text:"",size:"small"},{default:l(()=>[...e[18]||(e[18]=[i("重新上传",-1)])]),_:1})])):(c(),v("div",It,[t(r,{size:40},{default:l(()=>[t(_e)]),_:1}),e[19]||(e[19]=n("p",null,"拖拽文件到此处或点击上传",-1)),e[20]||(e[20]=n("span",null,"支持 .md, .txt, .docx, .pdf 格式",-1))]))]}),_:1})]),t(H),n("div",Pt,[n("h4",null,[t(r,null,{default:l(()=>[t(ot)]),_:1}),e[21]||(e[21]=i(" 审核标准 ",-1))]),n("div",qt,[t(y,{type:"primary",onClick:De},{default:l(()=>[t(r,null,{default:l(()=>[t(rt)]),_:1}),e[22]||(e[22]=i(" 选择审核标准 ",-1))]),_:1}),t(ut,{trigger:"click",onCommand:Fe,style:{"margin-left":"12px"}},{dropdown:l(()=>[t(dt,null,{default:l(()=>[t(ge,{command:"upload"},{default:l(()=>[t(r,null,{default:l(()=>[t(_e)]),_:1}),e[24]||(e[24]=i(" 上传新标准 ",-1))]),_:1}),t(ge,{command:"ai"},{default:l(()=>[t(r,null,{default:l(()=>[t(ye)]),_:1}),e[25]||(e[25]=i(" AI辅助制作 ",-1))]),_:1})]),_:1})]),default:l(()=>[t(y,null,{default:l(()=>[t(r,null,{default:l(()=>[t(it)]),_:1}),e[23]||(e[23]=i(" 新建标准 ",-1)),t(r,{class:"el-icon--right"},{default:l(()=>[t(fe)]),_:1})]),_:1})]),_:1})]),t(ve,{ref_key:"standardUploadRef",ref:re,"auto-upload":!1,"show-file-list":!1,"on-change":Me,accept:".xlsx,.xls,.csv,.docx,.md,.txt",style:{display:"none"}},null,512),h.value.length>0?(c(),v("div",Et,[n("div",Ft,[e[27]||(e[27]=n("span",{class:"selected-label"},"已选标准",-1)),t(C,{type:"success",size:"small"},{default:l(()=>[i(d(h.value.length)+" 条",1)]),_:1}),t(y,{text:"",type:"primary",size:"small",onClick:e[3]||(e[3]=s=>N.value=!0)},{default:l(()=>[...e[26]||(e[26]=[i(" 查看详情 ",-1)])]),_:1})]),n("div",Mt,[(c(!0),v(W,null,Y(h.value.slice(0,6),s=>(c(),Q(C,{key:s.id||s.item,size:"small",style:{margin:"2px"}},{default:l(()=>[i(d(s.item),1)]),_:2},1024))),128)),h.value.length>6?(c(),v("span",Nt," +"+d(h.value.length-6)+" 条 ",1)):V("",!0)])])):V("",!0),n("div",Bt,[n("div",{class:"special-header",onClick:e[4]||(e[4]=s=>O.value=!O.value)},[t(r,null,{default:l(()=>[t(we)]),_:1}),e[29]||(e[29]=n("span",null,"本次特殊要求",-1)),t(C,{size:"small",type:"info"},{default:l(()=>[...e[28]||(e[28]=[i("可选",-1)])]),_:1}),t(r,{class:Z(["expand-icon",{expanded:O.value}])},{default:l(()=>[t(fe)]),_:1},8,["class"])]),t(ct,null,{default:l(()=>[xt(n("div",jt,[t(x,{modelValue:P.value,"onUpdate:modelValue":e[5]||(e[5]=s=>P.value=s),type:"textarea",rows:3,placeholder:`输入本次项目的特殊审核要求，例如：
• 本项目为政府采购，需特别关注合规要求
• 我方为乙方，重点关注付款条款和违约责任
• 涉及数据跨境，需审核数据安全条款`},null,8,["modelValue"]),n("div",At,[t(y,{type:"primary",size:"small",loading:te.value,disabled:!P.value.trim()||!h.value.length,onClick:Ze},{default:l(()=>[t(r,null,{default:l(()=>[t(ye)]),_:1}),e[30]||(e[30]=i(" 整合到标准 ",-1))]),_:1},8,["loading","disabled"]),e[31]||(e[31]=n("span",{class:"special-tip"},"AI 将根据特殊要求调整审核标准",-1))])],512),[[Rt,O.value]])]),_:1})]),(j=S.value)!=null&&j.standard_filename?(c(),v("div",Xt,[t(r,{color:"#67c23a"},{default:l(()=>[t(pt)]),_:1}),n("span",null,"已应用: "+d(S.value.standard_filename),1),t(y,{text:"",type:"primary",size:"small",onClick:Ne},{default:l(()=>[...e[32]||(e[32]=[i("重新选择",-1)])]),_:1})])):V("",!0)]),t(J,{modelValue:G.value,"onUpdate:modelValue":e[7]||(e[7]=s=>G.value=s),title:"智能推荐标准",width:"700px"},{footer:l(()=>[t(y,{onClick:e[6]||(e[6]=s=>G.value=!1)},{default:l(()=>[...e[34]||(e[34]=[i("取消",-1)])]),_:1}),t(y,{type:"primary",onClick:He},{default:l(()=>[i(" 确认选择 ("+d(D.value.length)+") ",1)]),_:1})]),default:l(()=>[de.value.length?(c(),v("div",Ot,[t($,{type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:l(()=>[...e[33]||(e[33]=[i(" 根据您上传的文档，推荐以下审核标准： ",-1)])]),_:1}),n("div",Gt,[(c(!0),v(W,null,Y(de.value,s=>(c(),v("div",{key:s.standard_id,class:Z(["recommend-item",{selected:pe(s.standard_id)}]),onClick:q=>Ge(s)},[t(mt,{"model-value":pe(s.standard_id)},null,8,["model-value"]),n("div",Jt,[n("div",Kt,[n("span",Qt,d(s.standard.item),1),t(C,{size:"small",type:Je(s.relevance_score)},{default:l(()=>[i(" 相关度 "+d(Math.round(s.relevance_score*100))+"% ",1)]),_:2},1032,["type"])]),n("p",Wt,d(s.match_reason),1),n("p",Yt,d(s.standard.description),1)])],10,Ht))),128))])])):(c(),Q(ke,{key:1,description:"暂无推荐结果"}))]),_:1},8,["modelValue"]),t(J,{modelValue:I.value,"onUpdate:modelValue":e[10]||(e[10]=s=>I.value=s),title:"选择审核标准",width:"900px"},{footer:l(()=>[t(y,{onClick:e[9]||(e[9]=s=>I.value=!1)},{default:l(()=>[...e[39]||(e[39]=[i("取消",-1)])]),_:1}),t(y,{type:"primary",onClick:qe,disabled:!Pe.value},{default:l(()=>[...e[40]||(e[40]=[i(" 确认选择 ",-1)])]),_:1},8,["disabled"])]),default:l(()=>[n("div",Zt,[n("div",el,[e[36]||(e[36]=n("p",{class:"section-title"},"预设标准模板",-1)),e[37]||(e[37]=n("p",{class:"section-desc"},"选择系统预设的标准模板，快速开始审阅",-1)),n("div",tl,[(c(!0),v(W,null,Y(ie.value,s=>{var q,p,k;return c(),v("div",{key:s.id,class:Z(["template-card-dialog",{selected:((q=g.value)==null?void 0:q.id)===s.id}]),onClick:Ll=>Ie(s)},[n("div",al,[t(r,{size:20,color:((p=g.value)==null?void 0:p.id)===s.id?"#409eff":"#909399"},{default:l(()=>[t(se)]),_:1},8,["color"]),n("span",sl,d(s.name),1),((k=g.value)==null?void 0:k.id)===s.id?(c(),Q(C,{key:0,type:"primary",size:"small"},{default:l(()=>[...e[35]||(e[35]=[i("已选",-1)])]),_:1})):V("",!0)]),n("p",nl,d(s.description),1),n("div",ol,[t(C,{size:"small",type:"info"},{default:l(()=>[i(d(s.standard_count)+" 条标准",1)]),_:2},1024)])],10,ll)}),128))])]),t(H,null,{default:l(()=>[...e[38]||(e[38]=[i("或从标准库自由选择",-1)])]),_:1}),n("div",rl,[t(x,{modelValue:X.value,"onUpdate:modelValue":e[8]||(e[8]=s=>X.value=s),placeholder:"搜索标准...",clearable:"",style:{"margin-bottom":"12px"}},{prefix:l(()=>[t(r,null,{default:l(()=>[t(w(Vt))]),_:1})]),_:1},8,["modelValue"]),t(he,{ref_key:"libraryTableRef",ref:E,data:Ke.value,"max-height":"280",onSelectionChange:Qe},{default:l(()=>[t(T,{type:"selection",width:"50"}),t(T,{prop:"category",label:"分类",width:"100"}),t(T,{prop:"item",label:"审核要点",width:"150"}),t(T,{prop:"description",label:"说明","show-overflow-tooltip":""}),t(T,{label:"风险",width:"60"},{default:l(({row:s})=>[t(C,{type:le(s.risk_level),size:"small"},{default:l(()=>[i(d(ae(s.risk_level)),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"]),F.value.length===0?(c(),v("p",il," 标准库为空，请先在标准管理中添加标准 ")):V("",!0)]),ce.value?(c(),v("div",dl,[t(r,null,{default:l(()=>[t(be)]),_:1}),n("span",null,d(ce.value),1)])):V("",!0)])]),_:1},8,["modelValue"]),t(J,{modelValue:N.value,"onUpdate:modelValue":e[12]||(e[12]=s=>N.value=s),title:"已选审核标准",width:"750px"},{footer:l(()=>[t(y,{onClick:e[11]||(e[11]=s=>N.value=!1)},{default:l(()=>[...e[41]||(e[41]=[i("关闭",-1)])]),_:1}),t(y,{type:"primary",onClick:lt,loading:M.value},{default:l(()=>[...e[42]||(e[42]=[i(" 应用标准 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(he,{data:h.value,"max-height":"450"},{default:l(()=>[t(T,{prop:"category",label:"分类",width:"100"}),t(T,{prop:"item",label:"审核要点",width:"150"}),t(T,{prop:"description",label:"详细说明","show-overflow-tooltip":""}),t(T,{label:"风险",width:"60",align:"center"},{default:l(({row:s})=>[t(C,{type:le(s.risk_level),size:"small"},{default:l(()=>[i(d(ae(s.risk_level)),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),t(J,{modelValue:B.value,"onUpdate:modelValue":e[13]||(e[13]=s=>B.value=s),title:"标准整合预览",width:"850px","close-on-click-modal":!1},{footer:l(()=>[t(y,{onClick:et},{default:l(()=>[...e[43]||(e[43]=[i("取消，保留原标准",-1)])]),_:1}),t(y,{type:"primary",onClick:tt},{default:l(()=>[...e[44]||(e[44]=[i(" 应用整合后的标准 ",-1)])]),_:1})]),default:l(()=>{var s,q;return[n("div",ul,[n("div",cl,[t($,{title:(s=R.value)==null?void 0:s.merge_notes,type:"info",closable:!1,"show-icon":""},null,8,["title"]),n("div",pl,[t(C,{type:"success"},{default:l(()=>{var p,k;return[t(r,null,{default:l(()=>[t(_t)]),_:1}),i(" 新增 "+d(((k=(p=R.value)==null?void 0:p.summary)==null?void 0:k.added_count)||0)+" 条 ",1)]}),_:1}),t(C,{type:"warning"},{default:l(()=>{var p,k;return[t(r,null,{default:l(()=>[t(we)]),_:1}),i(" 修改 "+d(((k=(p=R.value)==null?void 0:p.summary)==null?void 0:k.modified_count)||0)+" 条 ",1)]}),_:1}),t(C,{type:"danger"},{default:l(()=>{var p,k;return[t(r,null,{default:l(()=>[t(vt)]),_:1}),i(" 删除 "+d(((k=(p=R.value)==null?void 0:p.summary)==null?void 0:k.removed_count)||0)+" 条 ",1)]}),_:1}),t(C,{type:"info"},{default:l(()=>{var p,k;return[t(r,null,{default:l(()=>[t(ft)]),_:1}),i(" 未变 "+d(((k=(p=R.value)==null?void 0:p.summary)==null?void 0:k.unchanged_count)||0)+" 条 ",1)]}),_:1})])]),n("div",ml,[(c(!0),v(W,null,Y(((q=R.value)==null?void 0:q.merged_standards)||[],(p,k)=>(c(),v("div",{key:k,class:Z(["merge-standard-item",p.change_type])},[n("div",_l,[t(C,{type:We(p.change_type),size:"small"},{default:l(()=>[i(d(Ye(p.change_type)),1)]),_:2},1032,["type"])]),n("div",vl,[n("div",fl,[n("span",gl,d(p.category),1),n("span",yl,d(p.item),1),t(C,{type:le(p.risk_level),size:"small"},{default:l(()=>[i(d(ae(p.risk_level)),1)]),_:2},1032,["type"])]),n("p",wl,d(p.description),1),p.change_reason?(c(),v("p",kl,[t(r,null,{default:l(()=>[t(be)]),_:1}),i(" "+d(p.change_reason),1)])):V("",!0)])],2))),128))])])]}),_:1},8,["modelValue"]),t(H),t(y,{type:"primary",size:"large",class:"start-btn",loading:w(u).isReviewing,disabled:!ze.value,onClick:Be},{default:l(()=>[i(d(w(u).isReviewing?"审阅中...":"开始审阅"),1)]),_:1},8,["loading","disabled"])]}),_:1})]),_:1}),t(Se,{span:14},{default:l(()=>[t(Ce,{class:"progress-card"},{header:l(()=>[...e[45]||(e[45]=[n("div",{class:"card-header"},[n("span",null,"审阅进度")],-1)])]),default:l(()=>[!w(u).isReviewing&&!ue.value?(c(),v("div",hl,[t(ke,{description:"完成配置后点击开始审阅"},{image:l(()=>[t(r,{size:80,color:"#909399"},{default:l(()=>[t(se)]),_:1})]),_:1})])):w(u).isReviewing?(c(),v("div",bl,[n("div",Cl,[t(gt,{type:"circle",percentage:w(u).progress.percentage,width:150,"stroke-width":10},null,8,["percentage"]),n("div",Sl,[n("h3",null,d(Te.value),1),n("p",null,d(w(u).progress.message),1)])]),n("div",xl,[t(yt,{active:Le.value,"align-center":""},{default:l(()=>[t(K,{title:"分析文档"}),t(K,{title:"识别风险"}),t(K,{title:"生成建议"}),t(K,{title:"完成"})]),_:1},8,["active"])])])):ue.value?(c(),v("div",Rl,[t(xe,{icon:"success",title:"审阅完成"},{"sub-title":l(()=>[w(u).reviewResult?(c(),v("p",Vl," 发现 "+d(w(u).reviewResult.summary.total_risks)+" 个风险点， 生成 "+d(w(u).reviewResult.summary.total_modifications)+" 条修改建议 ",1)):V("",!0)]),extra:l(()=>[t(y,{type:"primary",onClick:Ae},{default:l(()=>[...e[46]||(e[46]=[i(" 查看完整结果 ",-1)])]),_:1})]),_:1})])):$e.value?(c(),v("div",$l,[t(xe,{icon:"error",title:"审阅失败"},{"sub-title":l(()=>{var j;return[n("p",null,d(((j=S.value)==null?void 0:j.message)||"发生未知错误"),1)]}),extra:l(()=>[t(y,{type:"primary",onClick:je},{default:l(()=>[...e[47]||(e[47]=[i("重试",-1)])]),_:1})]),_:1})])):V("",!0)]),_:1})]),_:1})]),_:1})])}}},Pl=zt(zl,[["__scopeId","data-v-c7fdf6ff"]]);export{Pl as default};
