import{_ as Y,u as Z,r as f,c as ee,o as te,a as se,E as v,b as r,d as h,e as i,f as d,g,h as t,w as s,i as n,j as l,k as ne,l as oe,t as m,F as le,m as ae,n as R,p as ie}from"./index-BNaM8M1n.js";import{u as re}from"./index-YsGGYywd.js";import"./index-BOy5KFeg.js";const ue={class:"home-view"},ce={class:"alert-content"},de={class:"alert-detail"},fe={class:"welcome-section"},me={class:"welcome-card"},pe={class:"welcome-content"},_e={key:0,class:"backend-hint"},ve={class:"welcome-features"},ye={class:"feature-item"},ge={class:"feature-item"},ke={class:"feature-item"},we={class:"recent-section"},Ce={class:"section-header"},he={key:1,class:"task-list"},Te={class:"task-header"},ze={class:"task-name"},be={class:"task-meta"},xe={class:"task-files"},Se={class:"task-actions"},$e={__name:"HomeView",setup(Ee){const k=Z(),p=re(),T=f(!1),w=f([]),u=f("unknown"),z=f(""),B=f(""),b=f(!1),C=f(!1);let x=null;const y=f(!1),M=f("");ee(()=>p.isOperationInProgress),te(async()=>{await N()}),se(()=>{x&&clearTimeout(x)});async function N(){var e;u.value="connecting",z.value="正在连接后端服务...",await p.checkBackendStatus(c=>{z.value=c.message})?(u.value="ready",C.value=!0,x=setTimeout(()=>{C.value=!1},3e3),await V()):(u.value="error",B.value=((e=p.operationError)==null?void 0:e.message)||"无法连接到后端服务")}async function P(){b.value=!0,await N(),b.value=!1}async function V(){T.value=!0;try{await p.fetchTasks(),w.value=p.tasks}catch(o){const e=o.errorInfo;e!=null&&e.retryable?v.warning({message:e.message,duration:5e3}):v.error((e==null?void 0:e.message)||"获取任务列表失败")}finally{T.value=!1}}async function L(){if(u.value!=="ready"){v.warning("请等待后端服务就绪");return}y.value=!0,M.value="正在准备...";try{p.resetState(),k.push("/review")}catch{v.error("跳转失败，请重试")}finally{y.value=!1}}function A(o){o.status==="completed"?k.push(`/result/${o.id}`):k.push(`/review/${o.id}`)}function U(o){k.push(`/result/${o.id}`)}async function D(o){try{await ie.confirm(`确定要删除任务 "${o.name}" 吗？`,"确认删除",{type:"warning"}),await p.deleteTask(o.id),w.value=p.tasks,v.success("删除成功")}catch(e){e!=="cancel"&&v.error("删除失败")}}function F(o){return{created:"info",uploading:"info",reviewing:"warning",completed:"success",failed:"danger"}[o]||"info"}function H(o){return{created:"已创建",uploading:"上传中",reviewing:"审阅中",completed:"已完成",failed:"失败"}[o]||o}function j(o){return new Date(o).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}return(o,e)=>{const c=r("el-icon"),S=r("el-alert"),_=r("el-button"),I=r("Plus"),O=r("Search"),q=r("Edit"),G=r("List"),J=r("Refresh"),K=r("el-empty"),$=r("el-tag"),Q=r("User"),W=r("Clock"),X=r("el-card");return i(),h("div",ue,[u.value==="connecting"?(i(),d(S,{key:0,type:"info",closable:!1,"show-icon":"",class:"status-alert"},{title:s(()=>[t("span",null,[n(c,{class:"is-loading"},{default:s(()=>[n(ne(oe))]),_:1}),l(" "+m(z.value||"正在连接后端服务..."),1)])]),default:s(()=>[...e[1]||(e[1]=[t("span",{class:"alert-detail"},"Render 免费版服务在空闲后会休眠，首次访问可能需要等待 30-60 秒",-1)])]),_:1})):g("",!0),u.value==="error"?(i(),d(S,{key:1,type:"error",closable:!1,"show-icon":"",class:"status-alert"},{title:s(()=>[...e[2]||(e[2]=[l("后端服务连接失败",-1)])]),default:s(()=>[t("div",ce,[t("span",de,m(B.value),1),n(_,{type:"primary",size:"small",onClick:P,loading:b.value},{default:s(()=>[...e[3]||(e[3]=[l(" 重试连接 ",-1)])]),_:1},8,["loading"])])]),_:1})):g("",!0),u.value==="ready"&&C.value?(i(),d(S,{key:2,type:"success",closable:"","show-icon":"",class:"status-alert",onClose:e[0]||(e[0]=a=>C.value=!1)},{title:s(()=>[...e[4]||(e[4]=[l("后端服务已就绪",-1)])]),_:1})):g("",!0),t("div",fe,[t("div",me,[t("div",pe,[e[5]||(e[5]=t("h1",null,"法务文本审阅系统",-1)),e[6]||(e[6]=t("p",null,"使用 AI 技术从法务角度审阅合同、营销材料等文本，自动识别风险点并提供专业的修改建议。",-1)),n(_,{type:"primary",size:"large",onClick:L,loading:y.value,disabled:u.value!=="ready"},{default:s(()=>[y.value?g("",!0):(i(),d(c,{key:0},{default:s(()=>[n(I)]),_:1})),l(" "+m(y.value?M.value:"新建审阅任务"),1)]),_:1},8,["loading","disabled"]),u.value!=="ready"?(i(),h("div",_e,m(u.value==="connecting"?"等待后端服务就绪...":"请先连接后端服务"),1)):g("",!0)]),t("div",ve,[t("div",ye,[n(c,{size:32,color:"#667eea"},{default:s(()=>[n(O)]),_:1}),e[7]||(e[7]=t("h3",null,"智能风险识别",-1)),e[8]||(e[8]=t("p",null,"基于审核标准自动识别文本中的法务风险点",-1))]),t("div",ge,[n(c,{size:32,color:"#667eea"},{default:s(()=>[n(q)]),_:1}),e[9]||(e[9]=t("h3",null,"修改建议",-1)),e[10]||(e[10]=t("p",null,"针对每个风险点提供具体的文本修改建议",-1))]),t("div",ke,[n(c,{size:32,color:"#667eea"},{default:s(()=>[n(G)]),_:1}),e[11]||(e[11]=t("h3",null,"行动建议",-1)),e[12]||(e[12]=t("p",null,"除文本修改外还应采取的其他措施",-1))])])])]),t("div",we,[t("div",Ce,[e[14]||(e[14]=t("h2",null,"最近任务",-1)),n(_,{text:"",onClick:V,loading:T.value},{default:s(()=>[n(c,null,{default:s(()=>[n(J)]),_:1}),e[13]||(e[13]=l(" 刷新 ",-1))]),_:1},8,["loading"])]),w.value.length===0?(i(),d(K,{key:0,description:"暂无任务"},{default:s(()=>[n(_,{type:"primary",onClick:L},{default:s(()=>[...e[15]||(e[15]=[l("创建第一个任务",-1)])]),_:1})]),_:1})):(i(),h("div",he,[(i(!0),h(le,null,ae(w.value.slice(0,6),a=>(i(),d(X,{key:a.id,class:"task-card",shadow:"hover",onClick:E=>A(a)},{default:s(()=>[t("div",Te,[t("div",ze,m(a.name),1),n($,{type:F(a.status),size:"small"},{default:s(()=>[l(m(H(a.status)),1)]),_:2},1032,["type"])]),t("div",be,[t("span",null,[n(c,null,{default:s(()=>[n(Q)]),_:1}),l(" "+m(a.our_party),1)]),t("span",null,[n(c,null,{default:s(()=>[n(W)]),_:1}),l(" "+m(j(a.created_at)),1)])]),t("div",xe,[a.document_filename?(i(),d($,{key:0,type:"info",size:"small"},{default:s(()=>[l(m(a.document_filename),1)]),_:2},1024)):(i(),d($,{key:1,type:"warning",size:"small"},{default:s(()=>[...e[16]||(e[16]=[l("未上传文档",-1)])]),_:1}))]),t("div",Se,[a.status==="completed"?(i(),d(_,{key:0,type:"primary",size:"small",onClick:R(E=>U(a),["stop"])},{default:s(()=>[...e[17]||(e[17]=[l(" 查看结果 ",-1)])]),_:1},8,["onClick"])):(i(),d(_,{key:1,type:"primary",size:"small",onClick:R(E=>A(a),["stop"])},{default:s(()=>[...e[18]||(e[18]=[l(" 继续审阅 ",-1)])]),_:1},8,["onClick"])),n(_,{type:"danger",size:"small",text:"",onClick:R(E=>D(a),["stop"])},{default:s(()=>[...e[19]||(e[19]=[l(" 删除 ",-1)])]),_:1},8,["onClick"])])]),_:2},1032,["onClick"]))),128))]))])])}}},Ne=Y($e,[["__scopeId","data-v-5ad543d0"]]);export{Ne as default};
