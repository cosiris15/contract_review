import{q as dt,u as ut,r as f,c as T,o as ct,E as m,s as pt,b as o,d as _,e as c,i as t,f as q,g as R,w as l,k as g,h as n,l as mt,t as d,T as _t,j as i,F as O,m as G,v as H,x as vt,y as ft,z as ke,A as gt,B as yt}from"./index-CbWVtMyN.js";import{u as wt}from"./index-zL4C_JG0.js";import{_ as kt,a as Z}from"./_plugin-vue_export-helper-D3ac76j0.js";const ht={class:"review-view"},bt={key:0,class:"operation-status-bar"},Ct={class:"upload-section"},xt={key:0,class:"uploaded-file"},St={key:1,class:"upload-placeholder"},Rt={class:"standard-section"},Vt={class:"standard-selection-entry"},$t={key:0,class:"selected-standards-section"},zt={class:"selected-header"},Tt={class:"selected-tags"},Ut={key:0,class:"more-count"},Dt={class:"special-requirements"},It={class:"special-content"},qt={class:"special-actions"},Et={key:1,class:"applied-standard"},Lt={key:0},Mt={class:"recommend-list"},Pt=["onClick"],Ft={class:"recommend-content"},Bt={class:"recommend-header"},Nt={class:"recommend-title"},jt={class:"recommend-reason"},At={class:"recommend-desc"},Xt={class:"library-selector"},Ot={class:"collection-list"},Gt=["onClick"],Ht={class:"collection-card-header"},Jt={class:"collection-info"},Kt={class:"collection-name"},Qt={class:"collection-meta"},Wt={key:0,class:"collection-desc"},Yt={key:0,class:"selection-summary"},Zt={class:"merge-preview"},el={class:"merge-summary"},tl={class:"summary-stats"},ll={class:"merge-standards-list"},al={class:"standard-change-badge"},sl={class:"standard-content"},nl={class:"standard-header"},ol={class:"standard-category"},rl={class:"standard-item"},il={class:"standard-desc"},dl={key:0,class:"change-reason"},ul={key:0,class:"waiting-state"},cl={key:1,class:"progress-state"},pl={class:"progress-content"},ml={class:"progress-info"},_l={class:"progress-steps"},vl={key:2,class:"completed-state"},fl={key:0},gl={key:3,class:"failed-state"},yl={__name:"ReviewView",setup(wl){const ee=dt(),E=ut(),u=wt(),te=f(null),le=f(null),v=f(ee.params.taskId||null),b=f({name:"",our_party:"",material_type:"contract"}),he={name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],our_party:[{required:!0,message:"请输入我方身份",trigger:"blur"}]},J=f([]),y=f(null),k=f([]),U=f(!1),B=f(""),L=f(!1),M=f(!1),N=f(!1),D=f(""),K=f(!1),P=f(!1),V=f(null);f(!1);const Q=f(!1),ae=f([]),be=f([]),C=T(()=>u.currentTask),se=T(()=>{var a;return((a=C.value)==null?void 0:a.status)==="completed"}),Ce=T(()=>{var a;return((a=C.value)==null?void 0:a.status)==="failed"}),xe=T(()=>v.value?u.canStartReview:!1),Se=T(()=>({idle:"准备中",analyzing:"分析文档",generating:"生成建议",completed:"已完成"})[u.progress.stage]||"处理中"),Re=T(()=>{const a=u.progress.stage;return a==="idle"?0:a==="analyzing"?1:a==="generating"?2:a==="completed"?4:1});ct(async()=>{try{const a=await Z.getCollections();J.value=a.data.map(e=>({id:e.id,name:e.name,description:e.description,material_type:e.material_type,standard_count:e.standard_count,is_preset:e.is_preset,standards:[]}))}catch(a){console.error("加载标准集合失败:",a)}if(v.value)try{await u.loadTask(v.value),b.value={name:C.value.name,our_party:C.value.our_party,material_type:C.value.material_type},C.value.status==="reviewing"&&(u.isReviewing=!0,u.startPolling(v.value))}catch{m.error("加载任务失败"),E.push("/")}}),pt(()=>ee.params.taskId,async a=>{a&&a!==v.value&&(v.value=a,await u.loadTask(a))});async function Ve(a){if(!v.value){if(!await te.value.validate().catch(()=>!1)){m.warning("请先填写基本信息");return}try{const r=await u.createTask({name:b.value.name,our_party:b.value.our_party,material_type:b.value.material_type});v.value=r.id,E.replace(`/review/${r.id}`)}catch{m.error("创建任务失败");return}}try{await u.uploadDocument(v.value,a.raw),m.success("文档上传成功")}catch(e){m.error(e.message||"上传失败")}}const ne=T(()=>{if(!B.value)return J.value;const a=B.value.toLowerCase();return J.value.filter(e=>e.name.toLowerCase().includes(a)||e.description&&e.description.toLowerCase().includes(a))});function $e(){y.value=null,U.value=!0}function ze(){U.value=!1,E.push({name:"standards"})}async function Te(a){var e;if(((e=y.value)==null?void 0:e.id)===a.id)y.value=null;else{if(!a.standards||a.standards.length===0)try{const r=await Z.getCollection(a.id);a.standards=r.data.standards||[],a.standard_count=a.standards.length}catch(r){console.error("获取集合详情失败:",r),m.error("获取标准详情失败");return}y.value=a}}async function Ue(){if(!v.value){m.warning("请先上传文档");return}if(!y.value){m.warning("请先选择标准集");return}k.value=y.value.standards.map(a=>({id:a.id,category:a.category,item:a.item,description:a.description,risk_level:a.risk_level,applicable_to:a.applicable_to||["contract"]})),U.value=!1,await De(k.value)}async function De(a){L.value=!0;try{const e=["审核分类,审核要点,详细说明,风险等级,适用材料类型",...a.map(z=>`"${z.category}","${z.item}","${z.description}","${z.risk_level==="high"?"高":z.risk_level==="medium"?"中":"低"}","${(z.applicable_to||["contract"]).join(",")}"`)].join(`
`),r=new Blob([e],{type:"text/csv;charset=utf-8"}),$=y.value?`${y.value.name}.csv`:"selected_standards.csv",x=new File([r],$,{type:"text/csv"});await u.uploadStandard(v.value,x),m.success(`已应用 ${a.length} 条审核标准`)}catch(e){m.error("应用标准失败: "+e.message)}finally{L.value=!1}}function Ie(a){var e,r;if(a==="upload"){const $=(r=(e=le.value)==null?void 0:e.$el)==null?void 0:r.querySelector('input[type="file"]');$&&$.click()}else a==="ai"&&E.push({name:"standards",query:{action:"ai-create"}})}async function qe(a){if(!v.value){m.warning("请先上传文档");return}try{await u.uploadStandard(v.value,a.raw),selectedPresetTemplate.value=null,k.value=[],m.success("审核标准上传成功")}catch(e){m.error(e.message||"上传失败")}}function Ee(){y.value=null,k.value=[],D.value=""}async function Le(){if(!v.value){m.warning("请先完成配置");return}try{await u.startReview(v.value)}catch(a){m.error(a.message||"启动审阅失败")}}function Me(){u.progress={stage:"idle",percentage:0,message:""},C.value&&(C.value.status="created")}function Pe(){E.push(`/result/${v.value}`)}function Fe(){u.operationState.lastError=null}function oe(a){return{high:"danger",medium:"warning",low:"success"}[a]||"info"}function re(a){return{high:"高",medium:"中",low:"低"}[a]||a}function Be(a){return{added:"success",modified:"warning",removed:"danger",unchanged:"info"}[a]||"info"}function Ne(a){return{added:"新增",modified:"修改",removed:"删除",unchanged:"未变"}[a]||a}async function je(){if(!k.value.length){m.warning("请先选择基础标准");return}if(!D.value.trim()){m.warning("请输入特殊要求");return}K.value=!0;try{const a=await Z.mergeSpecialRequirements({standards:k.value.map(e=>({category:e.category,item:e.item,description:e.description,risk_level:e.risk_level,applicable_to:e.applicable_to||["contract"]})),special_requirements:D.value.trim(),our_party:b.value.our_party,material_type:b.value.material_type});V.value=a.data,P.value=!0}catch(a){m.error("整合失败: "+(a.message||"请重试"))}finally{K.value=!1}}function Ae(){P.value=!1,V.value=null}function Xe(){V.value&&(k.value=V.value.merged_standards.filter(a=>a.change_type!=="removed").map(a=>({id:a.id,category:a.category,item:a.item,description:a.description,risk_level:a.risk_level,applicable_to:["contract"]})),P.value=!1,V.value=null,m.success("已应用整合后的标准"))}async function Oe(){if(!v.value){m.warning("请先上传文档");return}if(!k.value.length){m.warning("请先选择标准");return}L.value=!0;try{const a=["审核分类,审核要点,详细说明,风险等级,适用材料类型",...k.value.map(x=>`"${x.category}","${x.item}","${x.description}","${x.risk_level==="high"?"高":x.risk_level==="medium"?"中":"低"}","${(x.applicable_to||["contract"]).join(",")}"`)].join(`
`),e=new Blob([a],{type:"text/csv;charset=utf-8"}),r=y.value?`${y.value.name}.csv`:"selected_standards.csv",$=new File([e],r,{type:"text/csv"});await u.uploadStandard(v.value,$),M.value=!1,m.success("标准应用成功")}catch(a){m.error("应用标准失败: "+a.message)}finally{L.value=!1}}return(a,e)=>{const r=o("el-icon"),$=o("el-alert"),x=o("el-input"),z=o("el-form-item"),ie=o("el-radio"),Ge=o("el-radio-group"),He=o("el-form"),W=o("el-divider"),de=o("Document"),Je=o("DocumentChecked"),w=o("el-button"),ue=o("UploadFilled"),ce=o("el-upload"),Ke=o("List"),Qe=o("Collection"),We=o("Plus"),pe=o("ArrowDown"),me=o("el-dropdown-item"),_e=o("MagicStick"),Ye=o("el-dropdown-menu"),Ze=o("el-dropdown"),S=o("el-tag"),ve=o("Edit"),et=o("el-collapse-transition"),tt=o("el-checkbox"),Y=o("el-empty"),j=o("el-dialog"),fe=o("InfoFilled"),A=o("el-table-column"),lt=o("el-table"),at=o("CirclePlus"),st=o("Remove"),nt=o("Check"),ge=o("el-card"),ye=o("el-col"),ot=o("el-progress"),X=o("el-step"),rt=o("el-steps"),we=o("el-result"),it=o("el-row");return c(),_("div",ht,[t(_t,{name:"fade"},{default:l(()=>[g(u).isOperationInProgress?(c(),_("div",bt,[t(r,{class:"is-loading"},{default:l(()=>[t(g(mt))]),_:1}),n("span",null,d(g(u).currentOperationMessage),1)])):R("",!0)]),_:1}),g(u).operationError&&!g(u).isOperationInProgress?(c(),q($,{key:0,type:"error",title:g(u).operationError.message,description:g(u).operationError.detail,"show-icon":"",closable:"",class:"error-alert",onClose:Fe},null,8,["title","description"])):R("",!0),t(it,{gutter:24},{default:l(()=>[t(ye,{span:10},{default:l(()=>[t(ge,{class:"config-card"},{header:l(()=>[...e[14]||(e[14]=[n("div",{class:"card-header"},[n("span",null,"审阅配置")],-1)])]),default:l(()=>{var F;return[t(He,{ref_key:"formRef",ref:te,model:b.value,rules:he,"label-position":"top"},{default:l(()=>[t(z,{label:"任务名称",prop:"name"},{default:l(()=>[t(x,{modelValue:b.value.name,"onUpdate:modelValue":e[0]||(e[0]=s=>b.value.name=s),placeholder:"例如：XX合同审阅",disabled:!!v.value},null,8,["modelValue","disabled"])]),_:1}),t(z,{label:"我方身份",prop:"our_party"},{default:l(()=>[t(x,{modelValue:b.value.our_party,"onUpdate:modelValue":e[1]||(e[1]=s=>b.value.our_party=s),placeholder:"例如：XX科技有限公司",disabled:!!v.value},null,8,["modelValue","disabled"])]),_:1}),t(z,{label:"材料类型",prop:"material_type"},{default:l(()=>[t(Ge,{modelValue:b.value.material_type,"onUpdate:modelValue":e[2]||(e[2]=s=>b.value.material_type=s),disabled:!!v.value},{default:l(()=>[t(ie,{value:"contract"},{default:l(()=>[...e[15]||(e[15]=[i("合同",-1)])]),_:1}),t(ie,{value:"marketing"},{default:l(()=>[...e[16]||(e[16]=[i("营销材料",-1)])]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1},8,["model"]),t(W),n("div",Ct,[n("h4",null,[t(r,null,{default:l(()=>[t(de)]),_:1}),e[17]||(e[17]=i(" 上传待审阅文档 ",-1))]),t(ce,{class:"upload-box",drag:"","auto-upload":!1,"show-file-list":!1,"on-change":Ve,accept:".md,.txt,.docx,.pdf"},{default:l(()=>{var s;return[(s=C.value)!=null&&s.document_filename?(c(),_("div",xt,[t(r,{size:40,color:"#67c23a"},{default:l(()=>[t(Je)]),_:1}),n("span",null,d(C.value.document_filename),1),t(w,{type:"primary",text:"",size:"small"},{default:l(()=>[...e[18]||(e[18]=[i("重新上传",-1)])]),_:1})])):(c(),_("div",St,[t(r,{size:40},{default:l(()=>[t(ue)]),_:1}),e[19]||(e[19]=n("p",null,"拖拽文件到此处或点击上传",-1)),e[20]||(e[20]=n("span",null,"支持 .md, .txt, .docx, .pdf 格式",-1))]))]}),_:1})]),t(W),n("div",Rt,[n("h4",null,[t(r,null,{default:l(()=>[t(Ke)]),_:1}),e[21]||(e[21]=i(" 审核标准 ",-1))]),n("div",Vt,[t(w,{type:"primary",onClick:$e},{default:l(()=>[t(r,null,{default:l(()=>[t(Qe)]),_:1}),e[22]||(e[22]=i(" 选择审核标准 ",-1))]),_:1}),t(Ze,{trigger:"click",onCommand:Ie,style:{"margin-left":"12px"}},{dropdown:l(()=>[t(Ye,null,{default:l(()=>[t(me,{command:"upload"},{default:l(()=>[t(r,null,{default:l(()=>[t(ue)]),_:1}),e[24]||(e[24]=i(" 上传新标准 ",-1))]),_:1}),t(me,{command:"ai"},{default:l(()=>[t(r,null,{default:l(()=>[t(_e)]),_:1}),e[25]||(e[25]=i(" AI辅助制作 ",-1))]),_:1})]),_:1})]),default:l(()=>[t(w,null,{default:l(()=>[t(r,null,{default:l(()=>[t(We)]),_:1}),e[23]||(e[23]=i(" 新建标准 ",-1)),t(r,{class:"el-icon--right"},{default:l(()=>[t(pe)]),_:1})]),_:1})]),_:1})]),t(ce,{ref_key:"standardUploadRef",ref:le,"auto-upload":!1,"show-file-list":!1,"on-change":qe,accept:".xlsx,.xls,.csv,.docx,.md,.txt",style:{display:"none"}},null,512),k.value.length>0?(c(),_("div",$t,[n("div",zt,[e[27]||(e[27]=n("span",{class:"selected-label"},"已选标准",-1)),t(S,{type:"success",size:"small"},{default:l(()=>[i(d(k.value.length)+" 条",1)]),_:1}),t(w,{text:"",type:"primary",size:"small",onClick:e[3]||(e[3]=s=>M.value=!0)},{default:l(()=>[...e[26]||(e[26]=[i(" 查看详情 ",-1)])]),_:1})]),n("div",Tt,[(c(!0),_(O,null,G(k.value.slice(0,6),s=>(c(),q(S,{key:s.id||s.item,size:"small",style:{margin:"2px"}},{default:l(()=>[i(d(s.item),1)]),_:2},1024))),128)),k.value.length>6?(c(),_("span",Ut," +"+d(k.value.length-6)+" 条 ",1)):R("",!0)])])):R("",!0),n("div",Dt,[n("div",{class:"special-header",onClick:e[4]||(e[4]=s=>N.value=!N.value)},[t(r,null,{default:l(()=>[t(ve)]),_:1}),e[29]||(e[29]=n("span",null,"本次特殊要求",-1)),t(S,{size:"small",type:"info"},{default:l(()=>[...e[28]||(e[28]=[i("可选",-1)])]),_:1}),t(r,{class:H(["expand-icon",{expanded:N.value}])},{default:l(()=>[t(pe)]),_:1},8,["class"])]),t(et,null,{default:l(()=>[vt(n("div",It,[t(x,{modelValue:D.value,"onUpdate:modelValue":e[5]||(e[5]=s=>D.value=s),type:"textarea",rows:3,placeholder:`输入本次项目的特殊审核要求，例如：
• 本项目为政府采购，需特别关注合规要求
• 我方为乙方，重点关注付款条款和违约责任
• 涉及数据跨境，需审核数据安全条款`},null,8,["modelValue"]),n("div",qt,[t(w,{type:"primary",size:"small",loading:K.value,disabled:!D.value.trim()||!k.value.length,onClick:je},{default:l(()=>[t(r,null,{default:l(()=>[t(_e)]),_:1}),e[30]||(e[30]=i(" 整合到标准 ",-1))]),_:1},8,["loading","disabled"]),e[31]||(e[31]=n("span",{class:"special-tip"},"AI 将根据特殊要求调整审核标准",-1))])],512),[[ft,N.value]])]),_:1})]),(F=C.value)!=null&&F.standard_filename?(c(),_("div",Et,[t(r,{color:"#67c23a"},{default:l(()=>[t(g(ke))]),_:1}),n("span",null,"已应用: "+d(C.value.standard_filename),1),t(w,{text:"",type:"primary",size:"small",onClick:Ee},{default:l(()=>[...e[32]||(e[32]=[i("重新选择",-1)])]),_:1})])):R("",!0)]),t(j,{modelValue:Q.value,"onUpdate:modelValue":e[7]||(e[7]=s=>Q.value=s),title:"智能推荐标准",width:"700px"},{footer:l(()=>[t(w,{onClick:e[6]||(e[6]=s=>Q.value=!1)},{default:l(()=>[...e[34]||(e[34]=[i("取消",-1)])]),_:1}),t(w,{type:"primary",onClick:a.confirmRecommendation},{default:l(()=>[i(" 确认选择 ("+d(be.value.length)+") ",1)]),_:1},8,["onClick"])]),default:l(()=>[ae.value.length?(c(),_("div",Lt,[t($,{type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:l(()=>[...e[33]||(e[33]=[i(" 根据您上传的文档，推荐以下审核标准： ",-1)])]),_:1}),n("div",Mt,[(c(!0),_(O,null,G(ae.value,s=>(c(),_("div",{key:s.standard_id,class:H(["recommend-item",{selected:a.isStandardSelected(s.standard_id)}]),onClick:I=>a.toggleStandard(s)},[t(tt,{"model-value":a.isStandardSelected(s.standard_id)},null,8,["model-value"]),n("div",Ft,[n("div",Bt,[n("span",Nt,d(s.standard.item),1),t(S,{size:"small",type:a.getRelevanceType(s.relevance_score)},{default:l(()=>[i(" 相关度 "+d(Math.round(s.relevance_score*100))+"% ",1)]),_:2},1032,["type"])]),n("p",jt,d(s.match_reason),1),n("p",At,d(s.standard.description),1)])],10,Pt))),128))])])):(c(),q(Y,{key:1,description:"暂无推荐结果"}))]),_:1},8,["modelValue"]),t(j,{modelValue:U.value,"onUpdate:modelValue":e[10]||(e[10]=s=>U.value=s),title:"选择审核标准",width:"800px"},{footer:l(()=>[t(w,{onClick:e[9]||(e[9]=s=>U.value=!1)},{default:l(()=>[...e[37]||(e[37]=[i("取消",-1)])]),_:1}),t(w,{type:"primary",onClick:Ue,disabled:!y.value},{default:l(()=>[...e[38]||(e[38]=[i(" 确认选择 ",-1)])]),_:1},8,["disabled"])]),default:l(()=>[n("div",Xt,[t(x,{modelValue:B.value,"onUpdate:modelValue":e[8]||(e[8]=s=>B.value=s),placeholder:"搜索标准集...",clearable:"",style:{"margin-bottom":"16px"}},{prefix:l(()=>[t(r,null,{default:l(()=>[t(g(gt))]),_:1})]),_:1},8,["modelValue"]),n("div",Ot,[(c(!0),_(O,null,G(ne.value,s=>{var I,p,h;return c(),_("div",{key:s.id,class:H(["collection-card-dialog",{selected:((I=y.value)==null?void 0:I.id)===s.id}]),onClick:kl=>Te(s)},[n("div",Ht,[t(r,{size:24,color:((p=y.value)==null?void 0:p.id)===s.id?"#409eff":"#909399"},{default:l(()=>[t(g(yt))]),_:1},8,["color"]),n("div",Jt,[n("span",Kt,d(s.name),1),n("span",Qt,[t(S,{size:"small",type:"info"},{default:l(()=>[i(d(s.standard_count)+" 条风险点",1)]),_:2},1024),s.is_preset?(c(),q(S,{key:0,size:"small",type:"success"},{default:l(()=>[...e[35]||(e[35]=[i("预设",-1)])]),_:1})):R("",!0)])]),((h=y.value)==null?void 0:h.id)===s.id?(c(),q(r,{key:0,class:"check-icon",color:"#409eff"},{default:l(()=>[t(g(ke))]),_:1})):R("",!0)]),s.description?(c(),_("p",Wt,d(s.description),1)):R("",!0)],10,Gt)}),128)),ne.value.length===0?(c(),q(Y,{key:0,description:"暂无标准集"},{default:l(()=>[t(w,{type:"primary",onClick:ze},{default:l(()=>[...e[36]||(e[36]=[i(" 前往标准管理 ",-1)])]),_:1})]),_:1})):R("",!0)]),y.value?(c(),_("div",Yt,[t(r,null,{default:l(()=>[t(fe)]),_:1}),n("span",null,"已选择「"+d(y.value.name)+"」，共 "+d(y.value.standard_count)+" 条风险点",1)])):R("",!0)])]),_:1},8,["modelValue"]),t(j,{modelValue:M.value,"onUpdate:modelValue":e[12]||(e[12]=s=>M.value=s),title:"已选审核标准",width:"750px"},{footer:l(()=>[t(w,{onClick:e[11]||(e[11]=s=>M.value=!1)},{default:l(()=>[...e[39]||(e[39]=[i("关闭",-1)])]),_:1}),t(w,{type:"primary",onClick:Oe,loading:L.value},{default:l(()=>[...e[40]||(e[40]=[i(" 应用标准 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(lt,{data:k.value,"max-height":"450"},{default:l(()=>[t(A,{prop:"category",label:"分类",width:"100"}),t(A,{prop:"item",label:"审核要点",width:"150"}),t(A,{prop:"description",label:"详细说明","show-overflow-tooltip":""}),t(A,{label:"风险",width:"60",align:"center"},{default:l(({row:s})=>[t(S,{type:oe(s.risk_level),size:"small"},{default:l(()=>[i(d(re(s.risk_level)),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),t(j,{modelValue:P.value,"onUpdate:modelValue":e[13]||(e[13]=s=>P.value=s),title:"标准整合预览",width:"850px","close-on-click-modal":!1},{footer:l(()=>[t(w,{onClick:Ae},{default:l(()=>[...e[41]||(e[41]=[i("取消，保留原标准",-1)])]),_:1}),t(w,{type:"primary",onClick:Xe},{default:l(()=>[...e[42]||(e[42]=[i(" 应用整合后的标准 ",-1)])]),_:1})]),default:l(()=>{var s,I;return[n("div",Zt,[n("div",el,[t($,{title:(s=V.value)==null?void 0:s.merge_notes,type:"info",closable:!1,"show-icon":""},null,8,["title"]),n("div",tl,[t(S,{type:"success"},{default:l(()=>{var p,h;return[t(r,null,{default:l(()=>[t(at)]),_:1}),i(" 新增 "+d(((h=(p=V.value)==null?void 0:p.summary)==null?void 0:h.added_count)||0)+" 条 ",1)]}),_:1}),t(S,{type:"warning"},{default:l(()=>{var p,h;return[t(r,null,{default:l(()=>[t(ve)]),_:1}),i(" 修改 "+d(((h=(p=V.value)==null?void 0:p.summary)==null?void 0:h.modified_count)||0)+" 条 ",1)]}),_:1}),t(S,{type:"danger"},{default:l(()=>{var p,h;return[t(r,null,{default:l(()=>[t(st)]),_:1}),i(" 删除 "+d(((h=(p=V.value)==null?void 0:p.summary)==null?void 0:h.removed_count)||0)+" 条 ",1)]}),_:1}),t(S,{type:"info"},{default:l(()=>{var p,h;return[t(r,null,{default:l(()=>[t(nt)]),_:1}),i(" 未变 "+d(((h=(p=V.value)==null?void 0:p.summary)==null?void 0:h.unchanged_count)||0)+" 条 ",1)]}),_:1})])]),n("div",ll,[(c(!0),_(O,null,G(((I=V.value)==null?void 0:I.merged_standards)||[],(p,h)=>(c(),_("div",{key:h,class:H(["merge-standard-item",p.change_type])},[n("div",al,[t(S,{type:Be(p.change_type),size:"small"},{default:l(()=>[i(d(Ne(p.change_type)),1)]),_:2},1032,["type"])]),n("div",sl,[n("div",nl,[n("span",ol,d(p.category),1),n("span",rl,d(p.item),1),t(S,{type:oe(p.risk_level),size:"small"},{default:l(()=>[i(d(re(p.risk_level)),1)]),_:2},1032,["type"])]),n("p",il,d(p.description),1),p.change_reason?(c(),_("p",dl,[t(r,null,{default:l(()=>[t(fe)]),_:1}),i(" "+d(p.change_reason),1)])):R("",!0)])],2))),128))])])]}),_:1},8,["modelValue"]),t(W),t(w,{type:"primary",size:"large",class:"start-btn",loading:g(u).isReviewing,disabled:!xe.value,onClick:Le},{default:l(()=>[i(d(g(u).isReviewing?"审阅中...":"开始审阅"),1)]),_:1},8,["loading","disabled"])]}),_:1})]),_:1}),t(ye,{span:14},{default:l(()=>[t(ge,{class:"progress-card"},{header:l(()=>[...e[43]||(e[43]=[n("div",{class:"card-header"},[n("span",null,"审阅进度")],-1)])]),default:l(()=>[!g(u).isReviewing&&!se.value?(c(),_("div",ul,[t(Y,{description:"完成配置后点击开始审阅"},{image:l(()=>[t(r,{size:80,color:"#909399"},{default:l(()=>[t(de)]),_:1})]),_:1})])):g(u).isReviewing?(c(),_("div",cl,[n("div",pl,[t(ot,{type:"circle",percentage:g(u).progress.percentage,width:150,"stroke-width":10},null,8,["percentage"]),n("div",ml,[n("h3",null,d(Se.value),1),n("p",null,d(g(u).progress.message),1)])]),n("div",_l,[t(rt,{active:Re.value,"align-center":""},{default:l(()=>[t(X,{title:"分析文档"}),t(X,{title:"识别风险"}),t(X,{title:"生成建议"}),t(X,{title:"完成"})]),_:1},8,["active"])])])):se.value?(c(),_("div",vl,[t(we,{icon:"success",title:"审阅完成"},{"sub-title":l(()=>[g(u).reviewResult?(c(),_("p",fl," 发现 "+d(g(u).reviewResult.summary.total_risks)+" 个风险点， 生成 "+d(g(u).reviewResult.summary.total_modifications)+" 条修改建议 ",1)):R("",!0)]),extra:l(()=>[t(w,{type:"primary",onClick:Pe},{default:l(()=>[...e[44]||(e[44]=[i(" 查看完整结果 ",-1)])]),_:1})]),_:1})])):Ce.value?(c(),_("div",gl,[t(we,{icon:"error",title:"审阅失败"},{"sub-title":l(()=>{var F;return[n("p",null,d(((F=C.value)==null?void 0:F.message)||"发生未知错误"),1)]}),extra:l(()=>[t(w,{type:"primary",onClick:Me},{default:l(()=>[...e[45]||(e[45]=[i("重试",-1)])]),_:1})]),_:1})])):R("",!0)]),_:1})]),_:1})]),_:1})])}}},xl=kt(yl,[["__scopeId","data-v-58873ba3"]]);export{xl as default};
