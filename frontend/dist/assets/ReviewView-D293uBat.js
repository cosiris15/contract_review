import{q as vt,u as _t,r as _,c as T,o as ft,E as m,s as be,b as r,d as v,e as c,i as t,f as K,g as V,w as l,k as w,h as n,l as gt,t as i,T as yt,j as o,F as Q,m as W,v as Y,x as wt,y as kt,z as ht}from"./index-eg14bdFL.js";import{u as bt}from"./index-BKNeYC4H.js";import{_ as Ct,a as se}from"./_plugin-vue_export-helper-BLVKql58.js";const xt={class:"review-view"},St={key:0,class:"operation-status-bar"},Rt={class:"upload-section"},Vt={key:0,class:"uploaded-file"},$t={key:1,class:"upload-placeholder"},zt={class:"standard-section"},Tt={class:"standard-selection-entry"},Lt={key:0,class:"selected-standards-section"},Dt={class:"selected-header"},Ut={class:"selected-tags"},Et={key:0,class:"more-count"},It={class:"special-requirements"},Pt={class:"special-content"},Ft={class:"special-actions"},Mt={key:1,class:"applied-standard"},qt={key:0},Bt={class:"recommend-list"},Nt=["onClick"],jt={class:"recommend-content"},At={class:"recommend-header"},Xt={class:"recommend-title"},Ot={class:"recommend-reason"},Gt={class:"recommend-desc"},Ht={class:"library-selector"},Jt={class:"preset-section"},Kt={class:"template-cards-dialog"},Qt=["onClick"],Wt={class:"template-card-header"},Yt={class:"template-name"},Zt={class:"template-desc"},el={class:"template-meta"},tl={class:"library-section-dialog"},ll={key:0,class:"empty-tip"},al={key:0,class:"selection-summary"},sl={class:"merge-preview"},nl={class:"merge-summary"},ol={class:"summary-stats"},rl={class:"merge-standards-list"},il={class:"standard-change-badge"},dl={class:"standard-content"},ul={class:"standard-header"},cl={class:"standard-category"},pl={class:"standard-item"},ml={class:"standard-desc"},vl={key:0,class:"change-reason"},_l={key:0,class:"waiting-state"},fl={key:1,class:"progress-state"},gl={class:"progress-content"},yl={class:"progress-info"},wl={class:"progress-steps"},kl={key:2,class:"completed-state"},hl={key:0},bl={key:3,class:"failed-state"},Cl={__name:"ReviewView",setup(xl){const ne=vt(),Z=_t(),d=bt(),oe=_(null),F=_(null),f=_(ne.params.taskId||null),b=_({name:"",our_party:"",material_type:"contract"}),Ce={name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],our_party:[{required:!0,message:"请输入我方身份",trigger:"blur"}]},re=_([]),g=_(null),h=_([]),E=_(!1),M=_([]),A=_(""),L=_([]),q=_(!1),B=_(!1),X=_(!1),I=_(""),ee=_(!1),N=_(!1),R=_(null);_(!1);const O=_(!1),ie=_([]),D=_([]),x=T(()=>d.currentTask),de=T(()=>{var a;return((a=x.value)==null?void 0:a.status)==="completed"}),xe=T(()=>{var a;return((a=x.value)==null?void 0:a.status)==="failed"}),Se=T(()=>f.value?d.canStartReview:!1),Re=T(()=>({idle:"准备中",analyzing:"分析文档",generating:"生成建议",completed:"已完成"})[d.progress.stage]||"处理中"),Ve=T(()=>{const a=d.progress.stage;return a==="idle"?0:a==="analyzing"?1:a==="generating"?2:a==="completed"?4:1});ft(async()=>{try{const a=await se.getPresetTemplates();re.value=a.data}catch(a){console.error("加载预设模板失败:",a)}if(f.value)try{await d.loadTask(f.value),b.value={name:x.value.name,our_party:x.value.our_party,material_type:x.value.material_type},x.value.status==="reviewing"&&(d.isReviewing=!0,d.startPolling(f.value))}catch{m.error("加载任务失败"),Z.push("/")}}),be(()=>ne.params.taskId,async a=>{a&&a!==f.value&&(f.value=a,await d.loadTask(a))});async function $e(a){if(!f.value){if(!await oe.value.validate().catch(()=>!1)){m.warning("请先填写基本信息");return}try{const u=await d.createTask({name:b.value.name,our_party:b.value.our_party,material_type:b.value.material_type});f.value=u.id,Z.replace(`/review/${u.id}`)}catch{m.error("创建任务失败");return}}try{await d.uploadDocument(f.value,a.raw),m.success("文档上传成功")}catch(e){m.error(e.message||"上传失败")}}function ze(){g.value=null,L.value=[],F.value&&F.value.clearSelection(),E.value=!0}function Te(a){var e;F.value&&F.value.clearSelection(),L.value=[],((e=g.value)==null?void 0:e.id)===a.id?g.value=null:g.value=a}const ue=T(()=>g.value?`已选择模板「${g.value.name}」，共 ${g.value.standard_count} 条标准`:L.value.length>0?`已从标准库选择 ${L.value.length} 条标准`:""),Le=T(()=>g.value!==null||L.value.length>0);async function De(){if(!f.value){m.warning("请先上传文档");return}let a=[];if(g.value?a=g.value.standards.map(e=>({id:e.id,category:e.category,item:e.item,description:e.description,risk_level:e.risk_level,applicable_to:e.applicable_to||["contract"]})):L.value.length>0&&(a=L.value.map(e=>({id:e.id,category:e.category,item:e.item,description:e.description,risk_level:e.risk_level,applicable_to:e.applicable_to||["contract"]}))),a.length===0){m.warning("请先选择标准");return}h.value=a,E.value=!1,await Ue(a)}async function Ue(a){q.value=!0;try{const e=["审核分类,审核要点,详细说明,风险等级,适用材料类型",...a.map($=>`"${$.category}","${$.item}","${$.description}","${$.risk_level==="high"?"高":$.risk_level==="medium"?"中":"低"}","${($.applicable_to||["contract"]).join(",")}"`)].join(`
`),u=new Blob([e],{type:"text/csv;charset=utf-8"}),U=g.value?`${g.value.name}.csv`:"selected_standards.csv",S=new File([u],U,{type:"text/csv"});await d.uploadStandard(f.value,S),m.success(`已应用 ${a.length} 条审核标准`)}catch(e){m.error("应用标准失败: "+e.message)}finally{q.value=!1}}async function Ee(a){if(!f.value){m.warning("请先上传文档");return}try{await d.uploadStandard(f.value,a.raw),g.value=null,h.value=[],m.success("审核标准上传成功")}catch(e){m.error(e.message||"上传失败")}}function Ie(){g.value=null,h.value=[],I.value=""}async function Pe(){if(!f.value){m.warning("请先完成配置");return}try{await d.startReview(f.value)}catch(a){m.error(a.message||"启动审阅失败")}}function Fe(){d.progress={stage:"idle",percentage:0,message:""},x.value&&(x.value.status="created")}function Me(){Z.push(`/result/${f.value}`)}function qe(){d.operationState.lastError=null}async function Be(){try{const a=await se.getLibraryStandards({material_type:b.value.material_type});M.value=a.data}catch(a){console.error("加载标准库失败:",a)}}function ce(a){return D.value.some(e=>e.id===a)}function Ne(a){const e=D.value.findIndex(u=>u.id===a.standard_id);e>=0?D.value.splice(e,1):D.value.push(a.standard)}function je(){O.value=!1,D.value.length&&m.success(`已选择 ${D.value.length} 条标准`)}function Ae(a){return a>=.8?"success":a>=.5?"warning":"info"}const Xe=T(()=>{if(!A.value)return M.value;const a=A.value.toLowerCase();return M.value.filter(e=>e.category.toLowerCase().includes(a)||e.item.toLowerCase().includes(a)||e.description.toLowerCase().includes(a))});function Oe(a){L.value=a,a.length>0&&(g.value=null)}function te(a){return{high:"danger",medium:"warning",low:"success"}[a]||"info"}function le(a){return{high:"高",medium:"中",low:"低"}[a]||a}function Ge(a){return{added:"success",modified:"warning",removed:"danger",unchanged:"info"}[a]||"info"}function He(a){return{added:"新增",modified:"修改",removed:"删除",unchanged:"未变"}[a]||a}async function Je(){if(!h.value.length){m.warning("请先选择基础标准");return}if(!I.value.trim()){m.warning("请输入特殊要求");return}ee.value=!0;try{const a=await se.mergeSpecialRequirements({standards:h.value.map(e=>({category:e.category,item:e.item,description:e.description,risk_level:e.risk_level,applicable_to:e.applicable_to||["contract"]})),special_requirements:I.value.trim(),our_party:b.value.our_party,material_type:b.value.material_type});R.value=a.data,N.value=!0}catch(a){m.error("整合失败: "+(a.message||"请重试"))}finally{ee.value=!1}}function Ke(){N.value=!1,R.value=null}function Qe(){R.value&&(h.value=R.value.merged_standards.filter(a=>a.change_type!=="removed").map(a=>({id:a.id,category:a.category,item:a.item,description:a.description,risk_level:a.risk_level,applicable_to:["contract"]})),N.value=!1,R.value=null,m.success("已应用整合后的标准"))}async function We(){if(!f.value){m.warning("请先上传文档");return}if(!h.value.length){m.warning("请先选择标准");return}q.value=!0;try{const a=["审核分类,审核要点,详细说明,风险等级,适用材料类型",...h.value.map(S=>`"${S.category}","${S.item}","${S.description}","${S.risk_level==="high"?"高":S.risk_level==="medium"?"中":"低"}","${(S.applicable_to||["contract"]).join(",")}"`)].join(`
`),e=new Blob([a],{type:"text/csv;charset=utf-8"}),u=g.value?`${g.value.name}.csv`:"selected_standards.csv",U=new File([e],u,{type:"text/csv"});await d.uploadStandard(f.value,U),B.value=!1,m.success("标准应用成功")}catch(a){m.error("应用标准失败: "+a.message)}finally{q.value=!1}}return be(E,a=>{a&&!M.value.length&&Be()}),(a,e)=>{const u=r("el-icon"),U=r("el-alert"),S=r("el-input"),$=r("el-form-item"),pe=r("el-radio"),Ye=r("el-radio-group"),Ze=r("el-form"),G=r("el-divider"),ae=r("Document"),et=r("DocumentChecked"),y=r("el-button"),me=r("UploadFilled"),ve=r("el-upload"),tt=r("List"),lt=r("Collection"),C=r("el-tag"),_e=r("Edit"),at=r("ArrowDown"),st=r("MagicStick"),nt=r("el-collapse-transition"),ot=r("CircleCheck"),rt=r("el-checkbox"),fe=r("el-empty"),H=r("el-dialog"),z=r("el-table-column"),ge=r("el-table"),ye=r("InfoFilled"),it=r("CirclePlus"),dt=r("Remove"),ut=r("Check"),we=r("el-card"),ke=r("el-col"),ct=r("el-progress"),J=r("el-step"),pt=r("el-steps"),he=r("el-result"),mt=r("el-row");return c(),v("div",xt,[t(yt,{name:"fade"},{default:l(()=>[w(d).isOperationInProgress?(c(),v("div",St,[t(u,{class:"is-loading"},{default:l(()=>[t(w(gt))]),_:1}),n("span",null,i(w(d).currentOperationMessage),1)])):V("",!0)]),_:1}),w(d).operationError&&!w(d).isOperationInProgress?(c(),K(U,{key:0,type:"error",title:w(d).operationError.message,description:w(d).operationError.detail,"show-icon":"",closable:"",class:"error-alert",onClose:qe},null,8,["title","description"])):V("",!0),t(mt,{gutter:24},{default:l(()=>[t(ke,{span:10},{default:l(()=>[t(we,{class:"config-card"},{header:l(()=>[...e[14]||(e[14]=[n("div",{class:"card-header"},[n("span",null,"审阅配置")],-1)])]),default:l(()=>{var j;return[t(Ze,{ref_key:"formRef",ref:oe,model:b.value,rules:Ce,"label-position":"top"},{default:l(()=>[t($,{label:"任务名称",prop:"name"},{default:l(()=>[t(S,{modelValue:b.value.name,"onUpdate:modelValue":e[0]||(e[0]=s=>b.value.name=s),placeholder:"例如：XX合同审阅",disabled:!!f.value},null,8,["modelValue","disabled"])]),_:1}),t($,{label:"我方身份",prop:"our_party"},{default:l(()=>[t(S,{modelValue:b.value.our_party,"onUpdate:modelValue":e[1]||(e[1]=s=>b.value.our_party=s),placeholder:"例如：XX科技有限公司",disabled:!!f.value},null,8,["modelValue","disabled"])]),_:1}),t($,{label:"材料类型",prop:"material_type"},{default:l(()=>[t(Ye,{modelValue:b.value.material_type,"onUpdate:modelValue":e[2]||(e[2]=s=>b.value.material_type=s),disabled:!!f.value},{default:l(()=>[t(pe,{value:"contract"},{default:l(()=>[...e[15]||(e[15]=[o("合同",-1)])]),_:1}),t(pe,{value:"marketing"},{default:l(()=>[...e[16]||(e[16]=[o("营销材料",-1)])]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1},8,["model"]),t(G),n("div",Rt,[n("h4",null,[t(u,null,{default:l(()=>[t(ae)]),_:1}),e[17]||(e[17]=o(" 上传待审阅文档 ",-1))]),t(ve,{class:"upload-box",drag:"","auto-upload":!1,"show-file-list":!1,"on-change":$e,accept:".md,.txt,.docx,.pdf"},{default:l(()=>{var s;return[(s=x.value)!=null&&s.document_filename?(c(),v("div",Vt,[t(u,{size:40,color:"#67c23a"},{default:l(()=>[t(et)]),_:1}),n("span",null,i(x.value.document_filename),1),t(y,{type:"primary",text:"",size:"small"},{default:l(()=>[...e[18]||(e[18]=[o("重新上传",-1)])]),_:1})])):(c(),v("div",$t,[t(u,{size:40},{default:l(()=>[t(me)]),_:1}),e[19]||(e[19]=n("p",null,"拖拽文件到此处或点击上传",-1)),e[20]||(e[20]=n("span",null,"支持 .md, .txt, .docx, .pdf 格式",-1))]))]}),_:1})]),t(G),n("div",zt,[n("h4",null,[t(u,null,{default:l(()=>[t(tt)]),_:1}),e[21]||(e[21]=o(" 审核标准 ",-1))]),n("div",Tt,[t(y,{type:"primary",onClick:ze},{default:l(()=>[t(u,null,{default:l(()=>[t(lt)]),_:1}),e[22]||(e[22]=o(" 选择审核标准 ",-1))]),_:1}),t(ve,{"auto-upload":!1,"show-file-list":!1,"on-change":Ee,accept:".xlsx,.xls,.csv,.docx,.md,.txt",style:{"margin-left":"12px"}},{default:l(()=>[t(y,null,{default:l(()=>[t(u,null,{default:l(()=>[t(me)]),_:1}),e[23]||(e[23]=o(" 上传自定义标准 ",-1))]),_:1})]),_:1})]),h.value.length>0?(c(),v("div",Lt,[n("div",Dt,[e[25]||(e[25]=n("span",{class:"selected-label"},"已选标准",-1)),t(C,{type:"success",size:"small"},{default:l(()=>[o(i(h.value.length)+" 条",1)]),_:1}),t(y,{text:"",type:"primary",size:"small",onClick:e[3]||(e[3]=s=>B.value=!0)},{default:l(()=>[...e[24]||(e[24]=[o(" 查看详情 ",-1)])]),_:1})]),n("div",Ut,[(c(!0),v(Q,null,W(h.value.slice(0,6),s=>(c(),K(C,{key:s.id||s.item,size:"small",style:{margin:"2px"}},{default:l(()=>[o(i(s.item),1)]),_:2},1024))),128)),h.value.length>6?(c(),v("span",Et," +"+i(h.value.length-6)+" 条 ",1)):V("",!0)])])):V("",!0),n("div",It,[n("div",{class:"special-header",onClick:e[4]||(e[4]=s=>X.value=!X.value)},[t(u,null,{default:l(()=>[t(_e)]),_:1}),e[27]||(e[27]=n("span",null,"本次特殊要求",-1)),t(C,{size:"small",type:"info"},{default:l(()=>[...e[26]||(e[26]=[o("可选",-1)])]),_:1}),t(u,{class:Y(["expand-icon",{expanded:X.value}])},{default:l(()=>[t(at)]),_:1},8,["class"])]),t(nt,null,{default:l(()=>[wt(n("div",Pt,[t(S,{modelValue:I.value,"onUpdate:modelValue":e[5]||(e[5]=s=>I.value=s),type:"textarea",rows:3,placeholder:`输入本次项目的特殊审核要求，例如：
• 本项目为政府采购，需特别关注合规要求
• 我方为乙方，重点关注付款条款和违约责任
• 涉及数据跨境，需审核数据安全条款`},null,8,["modelValue"]),n("div",Ft,[t(y,{type:"primary",size:"small",loading:ee.value,disabled:!I.value.trim()||!h.value.length,onClick:Je},{default:l(()=>[t(u,null,{default:l(()=>[t(st)]),_:1}),e[28]||(e[28]=o(" 整合到标准 ",-1))]),_:1},8,["loading","disabled"]),e[29]||(e[29]=n("span",{class:"special-tip"},"AI 将根据特殊要求调整审核标准",-1))])],512),[[kt,X.value]])]),_:1})]),(j=x.value)!=null&&j.standard_filename?(c(),v("div",Mt,[t(u,{color:"#67c23a"},{default:l(()=>[t(ot)]),_:1}),n("span",null,"已应用: "+i(x.value.standard_filename),1),t(y,{text:"",type:"primary",size:"small",onClick:Ie},{default:l(()=>[...e[30]||(e[30]=[o("重新选择",-1)])]),_:1})])):V("",!0)]),t(H,{modelValue:O.value,"onUpdate:modelValue":e[7]||(e[7]=s=>O.value=s),title:"智能推荐标准",width:"700px"},{footer:l(()=>[t(y,{onClick:e[6]||(e[6]=s=>O.value=!1)},{default:l(()=>[...e[32]||(e[32]=[o("取消",-1)])]),_:1}),t(y,{type:"primary",onClick:je},{default:l(()=>[o(" 确认选择 ("+i(D.value.length)+") ",1)]),_:1})]),default:l(()=>[ie.value.length?(c(),v("div",qt,[t(U,{type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:l(()=>[...e[31]||(e[31]=[o(" 根据您上传的文档，推荐以下审核标准： ",-1)])]),_:1}),n("div",Bt,[(c(!0),v(Q,null,W(ie.value,s=>(c(),v("div",{key:s.standard_id,class:Y(["recommend-item",{selected:ce(s.standard_id)}]),onClick:P=>Ne(s)},[t(rt,{"model-value":ce(s.standard_id)},null,8,["model-value"]),n("div",jt,[n("div",At,[n("span",Xt,i(s.standard.item),1),t(C,{size:"small",type:Ae(s.relevance_score)},{default:l(()=>[o(" 相关度 "+i(Math.round(s.relevance_score*100))+"% ",1)]),_:2},1032,["type"])]),n("p",Ot,i(s.match_reason),1),n("p",Gt,i(s.standard.description),1)])],10,Nt))),128))])])):(c(),K(fe,{key:1,description:"暂无推荐结果"}))]),_:1},8,["modelValue"]),t(H,{modelValue:E.value,"onUpdate:modelValue":e[10]||(e[10]=s=>E.value=s),title:"选择审核标准",width:"900px"},{footer:l(()=>[t(y,{onClick:e[9]||(e[9]=s=>E.value=!1)},{default:l(()=>[...e[37]||(e[37]=[o("取消",-1)])]),_:1}),t(y,{type:"primary",onClick:De,disabled:!Le.value},{default:l(()=>[...e[38]||(e[38]=[o(" 确认选择 ",-1)])]),_:1},8,["disabled"])]),default:l(()=>[n("div",Ht,[n("div",Jt,[e[34]||(e[34]=n("p",{class:"section-title"},"预设标准模板",-1)),e[35]||(e[35]=n("p",{class:"section-desc"},"选择系统预设的标准模板，快速开始审阅",-1)),n("div",Kt,[(c(!0),v(Q,null,W(re.value,s=>{var P,p,k;return c(),v("div",{key:s.id,class:Y(["template-card-dialog",{selected:((P=g.value)==null?void 0:P.id)===s.id}]),onClick:Sl=>Te(s)},[n("div",Wt,[t(u,{size:20,color:((p=g.value)==null?void 0:p.id)===s.id?"#409eff":"#909399"},{default:l(()=>[t(ae)]),_:1},8,["color"]),n("span",Yt,i(s.name),1),((k=g.value)==null?void 0:k.id)===s.id?(c(),K(C,{key:0,type:"primary",size:"small"},{default:l(()=>[...e[33]||(e[33]=[o("已选",-1)])]),_:1})):V("",!0)]),n("p",Zt,i(s.description),1),n("div",el,[t(C,{size:"small",type:"info"},{default:l(()=>[o(i(s.standard_count)+" 条标准",1)]),_:2},1024)])],10,Qt)}),128))])]),t(G,null,{default:l(()=>[...e[36]||(e[36]=[o("或从标准库自由选择",-1)])]),_:1}),n("div",tl,[t(S,{modelValue:A.value,"onUpdate:modelValue":e[8]||(e[8]=s=>A.value=s),placeholder:"搜索标准...",clearable:"",style:{"margin-bottom":"12px"}},{prefix:l(()=>[t(u,null,{default:l(()=>[t(w(ht))]),_:1})]),_:1},8,["modelValue"]),t(ge,{ref_key:"libraryTableRef",ref:F,data:Xe.value,"max-height":"280",onSelectionChange:Oe},{default:l(()=>[t(z,{type:"selection",width:"50"}),t(z,{prop:"category",label:"分类",width:"100"}),t(z,{prop:"item",label:"审核要点",width:"150"}),t(z,{prop:"description",label:"说明","show-overflow-tooltip":""}),t(z,{label:"风险",width:"60"},{default:l(({row:s})=>[t(C,{type:te(s.risk_level),size:"small"},{default:l(()=>[o(i(le(s.risk_level)),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"]),M.value.length===0?(c(),v("p",ll," 标准库为空，请先在标准管理中添加标准 ")):V("",!0)]),ue.value?(c(),v("div",al,[t(u,null,{default:l(()=>[t(ye)]),_:1}),n("span",null,i(ue.value),1)])):V("",!0)])]),_:1},8,["modelValue"]),t(H,{modelValue:B.value,"onUpdate:modelValue":e[12]||(e[12]=s=>B.value=s),title:"已选审核标准",width:"750px"},{footer:l(()=>[t(y,{onClick:e[11]||(e[11]=s=>B.value=!1)},{default:l(()=>[...e[39]||(e[39]=[o("关闭",-1)])]),_:1}),t(y,{type:"primary",onClick:We,loading:q.value},{default:l(()=>[...e[40]||(e[40]=[o(" 应用标准 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(ge,{data:h.value,"max-height":"450"},{default:l(()=>[t(z,{prop:"category",label:"分类",width:"100"}),t(z,{prop:"item",label:"审核要点",width:"150"}),t(z,{prop:"description",label:"详细说明","show-overflow-tooltip":""}),t(z,{label:"风险",width:"60",align:"center"},{default:l(({row:s})=>[t(C,{type:te(s.risk_level),size:"small"},{default:l(()=>[o(i(le(s.risk_level)),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"]),t(H,{modelValue:N.value,"onUpdate:modelValue":e[13]||(e[13]=s=>N.value=s),title:"标准整合预览",width:"850px","close-on-click-modal":!1},{footer:l(()=>[t(y,{onClick:Ke},{default:l(()=>[...e[41]||(e[41]=[o("取消，保留原标准",-1)])]),_:1}),t(y,{type:"primary",onClick:Qe},{default:l(()=>[...e[42]||(e[42]=[o(" 应用整合后的标准 ",-1)])]),_:1})]),default:l(()=>{var s,P;return[n("div",sl,[n("div",nl,[t(U,{title:(s=R.value)==null?void 0:s.merge_notes,type:"info",closable:!1,"show-icon":""},null,8,["title"]),n("div",ol,[t(C,{type:"success"},{default:l(()=>{var p,k;return[t(u,null,{default:l(()=>[t(it)]),_:1}),o(" 新增 "+i(((k=(p=R.value)==null?void 0:p.summary)==null?void 0:k.added_count)||0)+" 条 ",1)]}),_:1}),t(C,{type:"warning"},{default:l(()=>{var p,k;return[t(u,null,{default:l(()=>[t(_e)]),_:1}),o(" 修改 "+i(((k=(p=R.value)==null?void 0:p.summary)==null?void 0:k.modified_count)||0)+" 条 ",1)]}),_:1}),t(C,{type:"danger"},{default:l(()=>{var p,k;return[t(u,null,{default:l(()=>[t(dt)]),_:1}),o(" 删除 "+i(((k=(p=R.value)==null?void 0:p.summary)==null?void 0:k.removed_count)||0)+" 条 ",1)]}),_:1}),t(C,{type:"info"},{default:l(()=>{var p,k;return[t(u,null,{default:l(()=>[t(ut)]),_:1}),o(" 未变 "+i(((k=(p=R.value)==null?void 0:p.summary)==null?void 0:k.unchanged_count)||0)+" 条 ",1)]}),_:1})])]),n("div",rl,[(c(!0),v(Q,null,W(((P=R.value)==null?void 0:P.merged_standards)||[],(p,k)=>(c(),v("div",{key:k,class:Y(["merge-standard-item",p.change_type])},[n("div",il,[t(C,{type:Ge(p.change_type),size:"small"},{default:l(()=>[o(i(He(p.change_type)),1)]),_:2},1032,["type"])]),n("div",dl,[n("div",ul,[n("span",cl,i(p.category),1),n("span",pl,i(p.item),1),t(C,{type:te(p.risk_level),size:"small"},{default:l(()=>[o(i(le(p.risk_level)),1)]),_:2},1032,["type"])]),n("p",ml,i(p.description),1),p.change_reason?(c(),v("p",vl,[t(u,null,{default:l(()=>[t(ye)]),_:1}),o(" "+i(p.change_reason),1)])):V("",!0)])],2))),128))])])]}),_:1},8,["modelValue"]),t(G),t(y,{type:"primary",size:"large",class:"start-btn",loading:w(d).isReviewing,disabled:!Se.value,onClick:Pe},{default:l(()=>[o(i(w(d).isReviewing?"审阅中...":"开始审阅"),1)]),_:1},8,["loading","disabled"])]}),_:1})]),_:1}),t(ke,{span:14},{default:l(()=>[t(we,{class:"progress-card"},{header:l(()=>[...e[43]||(e[43]=[n("div",{class:"card-header"},[n("span",null,"审阅进度")],-1)])]),default:l(()=>[!w(d).isReviewing&&!de.value?(c(),v("div",_l,[t(fe,{description:"完成配置后点击开始审阅"},{image:l(()=>[t(u,{size:80,color:"#909399"},{default:l(()=>[t(ae)]),_:1})]),_:1})])):w(d).isReviewing?(c(),v("div",fl,[n("div",gl,[t(ct,{type:"circle",percentage:w(d).progress.percentage,width:150,"stroke-width":10},null,8,["percentage"]),n("div",yl,[n("h3",null,i(Re.value),1),n("p",null,i(w(d).progress.message),1)])]),n("div",wl,[t(pt,{active:Ve.value,"align-center":""},{default:l(()=>[t(J,{title:"分析文档"}),t(J,{title:"识别风险"}),t(J,{title:"生成建议"}),t(J,{title:"完成"})]),_:1},8,["active"])])])):de.value?(c(),v("div",kl,[t(he,{icon:"success",title:"审阅完成"},{"sub-title":l(()=>[w(d).reviewResult?(c(),v("p",hl," 发现 "+i(w(d).reviewResult.summary.total_risks)+" 个风险点， 生成 "+i(w(d).reviewResult.summary.total_modifications)+" 条修改建议 ",1)):V("",!0)]),extra:l(()=>[t(y,{type:"primary",onClick:Me},{default:l(()=>[...e[44]||(e[44]=[o(" 查看完整结果 ",-1)])]),_:1})]),_:1})])):xe.value?(c(),v("div",bl,[t(he,{icon:"error",title:"审阅失败"},{"sub-title":l(()=>{var j;return[n("p",null,i(((j=x.value)==null?void 0:j.message)||"发生未知错误"),1)]}),extra:l(()=>[t(y,{type:"primary",onClick:Fe},{default:l(()=>[...e[45]||(e[45]=[o("重试",-1)])]),_:1})]),_:1})])):V("",!0)]),_:1})]),_:1})]),_:1})])}}},zl=Ct(Cl,[["__scopeId","data-v-4c80cd6a"]]);export{zl as default};
